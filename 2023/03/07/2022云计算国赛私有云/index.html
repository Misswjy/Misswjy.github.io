<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>2022云计算国赛私有云 | Misswjy&#39;Blog</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="2022 年全国职业院校技能大赛高职组云计算赛项试卷">
<meta property="og:type" content="article">
<meta property="og:title" content="2022云计算国赛私有云">
<meta property="og:url" content="http://example.com/2023/03/07/2022%E4%BA%91%E8%AE%A1%E7%AE%97%E5%9B%BD%E8%B5%9B%E7%A7%81%E6%9C%89%E4%BA%91/index.html">
<meta property="og:site_name" content="Misswjy&#39;Blog">
<meta property="og:description" content="2022 年全国职业院校技能大赛高职组云计算赛项试卷">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-03-07T01:57:41.000Z">
<meta property="article:modified_time" content="2023-04-23T01:32:59.493Z">
<meta property="article:author" content="Miss">
<meta property="article:tag" content="私有云">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="Misswjy&#39;Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
<meta name="generator" content="Hexo 6.1.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
				<img lazy-src="/img/avatar.png" class="js-avatar">
			
		</a>

		<hgroup>
			<h1 class="header-author"><a href="/">Miss</a></h1>
		</hgroup>

		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">Home</a></li>
				        
							<li><a href="/archives">Archives</a></li>
				        
						</ul>
					</nav>
					<nav class="half-header-menu">
						<a class="hide">Home</a>
						<a>Tags</a>
						<a>Links</a>
						<a>About</a>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/Misswjy" title="github">github</a>
					        
								<a class="mail" target="_blank" href="/dockery@foxmail.com" title="mail">mail</a>
					        
								<a class="bilibili" target="_blank" href="https://space.bilibili.com/292671654" title="bilibili">bilibili</a>
					        
						</div>
						<!-- music -->
						
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/k8s/" style="font-size: 15px;">k8s</a> <a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 12.5px;">云计算</a> <a href="/tags/%E5%AE%B9%E5%99%A8%E4%BA%91/" style="font-size: 17.5px;">容器云</a> <a href="/tags/%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2%E5%92%8C%E8%BF%90%E7%BB%B4/" style="font-size: 10px;">应用部署和运维</a> <a href="/tags/%E7%A7%81%E6%9C%89%E4%BA%91/" style="font-size: 20px;">私有云</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/">github</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">I&#39;m a developer.</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/avatar.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">Home</a></li>
		        
					<li><a href="/archives">Archives</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Misswjy" title="github">github</a>
			        
						<a class="mail" target="_blank" href="/dockery@foxmail.com" title="mail">mail</a>
			        
						<a class="bilibili" target="_blank" href="https://space.bilibili.com/292671654" title="bilibili">bilibili</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-2022云计算国赛私有云" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2023/03/07/2022%E4%BA%91%E8%AE%A1%E7%AE%97%E5%9B%BD%E8%B5%9B%E7%A7%81%E6%9C%89%E4%BA%91/" class="article-date">
  	<time datetime="2023-03-07T01:57:41.000Z" itemprop="datePublished">2023-03-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      2022云计算国赛私有云
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%A7%81%E6%9C%89%E4%BA%91/" rel="tag">私有云</a></li></ul>
	</div>

        

        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="2022-年全国职业院校技能大赛高职组云计算赛项试卷"><a href="#2022-年全国职业院校技能大赛高职组云计算赛项试卷" class="headerlink" title="2022 年全国职业院校技能大赛高职组云计算赛项试卷"></a>2022 年全国职业院校技能大赛高职组云计算赛项试卷<span id="more"></span></h1><h2 id="云计算赛项第一场-私有云"><a href="#云计算赛项第一场-私有云" class="headerlink" title="云计算赛项第一场-私有云"></a>云计算赛项第一场-私有云</h2><h3 id="【任务-1】私有云服务搭建-10-分"><a href="#【任务-1】私有云服务搭建-10-分" class="headerlink" title="【任务 1】私有云服务搭建[10 分]"></a>【任务 1】私有云服务搭建[10 分]</h3><h4 id="【题目-1】基础环境配置-0-5-分"><a href="#【题目-1】基础环境配置-0-5-分" class="headerlink" title="【题目 1】基础环境配置[0.5 分]"></a>【题目 1】基础环境配置[0.5 分]</h4><p>使用提供的用户名密码，登录提供的 OpenStack 私有云平台，在当前租户下，使用CentOS7.9 镜像，创建两台云主机，云主机类型使用 4vCPU&#x2F;12G&#x2F;100G_50G 类型。当前租户下默认存在一张网卡，自行创建第二张网卡并连接至 controller 和 compute 节点（第二张网卡的网段为 10.10.X.0&#x2F;24，X 为工位号，不需要创建路由）。自行检查安全组策略，以确保网络正常通信与 ssh 连接，然后按以下要求配置服务器：<br>（1）设置控制节点主机名为 controller，设置计算节点主机名为 compute；<br>（2）修改 hosts 文件将 IP 地址映射为主机名；<br>完成后提交控制节点的用户名、密码和 IP 地址到答题框。<br>1.查看控制节点名字为 controller 正确计 0.2 分<br>2.查看 hosts 文件中有正确的主机名和 IP 映射计 0.2 分<br>3.控制节点正确使用两块网卡计 0.1 分</p>
<p><strong>controller</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# hostnamectl set-hostname controller</span><br><span class="line">[root@controller ~]# su</span><br><span class="line">[root@controller ~]# hostnamectl </span><br><span class="line">   Static hostname: controller</span><br><span class="line">         Icon name: computer-vm</span><br><span class="line">           Chassis: vm</span><br><span class="line">        Machine ID: cc2c86fe566741e6a2ff6d399c5d5daa</span><br><span class="line">           Boot ID: 214933a71db6473cb11d2c126d890cdf</span><br><span class="line">    Virtualization: kvm</span><br><span class="line">  Operating System: CentOS Linux 7 (Core)</span><br><span class="line">       CPE OS Name: cpe:/o:centos:centos:7</span><br><span class="line">            Kernel: Linux 3.10.0-1160.el7.x86_64</span><br><span class="line">      Architecture: x86-64</span><br></pre></td></tr></table></figure>

<p><strong>compute</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~]# hostnamectl set-hostname compute</span><br><span class="line">[root@compute ~]# su</span><br><span class="line">[root@compute ~]# hostnamectl </span><br><span class="line">   Static hostname: compute</span><br><span class="line">         Icon name: computer-vm</span><br><span class="line">           Chassis: vm</span><br><span class="line">        Machine ID: cc2c86fe566741e6a2ff6d399c5d5daa</span><br><span class="line">           Boot ID: 3f03732ccb29461b9a4f3772d76ea5c3</span><br><span class="line">    Virtualization: kvm</span><br><span class="line">  Operating System: CentOS Linux 7 (Core)</span><br><span class="line">       CPE OS Name: cpe:/o:centos:centos:7</span><br><span class="line">            Kernel: Linux 3.10.0-1160.el7.x86_64</span><br><span class="line">      Architecture: x86-64</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# cat /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"></span><br><span class="line">192.168.20.161	controller</span><br><span class="line">192.168.20.195	compute</span><br></pre></td></tr></table></figure>

<h4 id="【题目-2】Yum-源配置-0-5-分"><a href="#【题目-2】Yum-源配置-0-5-分" class="headerlink" title="【题目 2】Yum 源配置[0.5 分]"></a>【题目 2】Yum 源配置[0.5 分]</h4><p>使用提供的 http 服务地址，在 http 服务下，存在 centos7.9 和 iaas 的网络 yum 源，使用该 http 源作为安装 iaas 平台的网络源。分别设置 controller 节点和 compute 节点的 yum 源文件 http.repo。完成后提交控制节点的用户名、密码和 IP 地址到答题框。<br>1.查看&#x2F;etc&#x2F;yum.repos.d&#x2F;http.repo 文件，有正确的 baseurl 路径，计 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# rm -rf /etc/yum.repos.d/*</span><br><span class="line">[root@controller ~]# cat /etc/yum.repos.d/http.repo </span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=http://172.19.25.11/centos</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[iaas]</span><br><span class="line">name=iaas</span><br><span class="line">baseurl=http://172.19.25.11/iaas/iaas-repo</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[root@controller ~]# yum repolist</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Determining fastest mirrors</span><br><span class="line">centos                                                                                                                           | 3.6 kB  00:00:00     </span><br><span class="line">iaas                                                                                                                             | 2.9 kB  00:00:00     </span><br><span class="line">(1/3): centos/group_gz                                                                                                           | 153 kB  00:00:00     </span><br><span class="line">(2/3): iaas/primary_db                                                                                                           | 597 kB  00:00:00     </span><br><span class="line">(3/3): centos/primary_db                                                                                                         | 3.3 MB  00:00:00     </span><br><span class="line">repo id                                                                  repo name                                                                status</span><br><span class="line">centos                                                                   centos                                                                   4,070</span><br><span class="line">iaas                                                                     iaas                                                                       954</span><br><span class="line">repolist: 5,024</span><br></pre></td></tr></table></figure>

<h4 id="【题目-3】配置无秘钥-ssh-0-5-分"><a href="#【题目-3】配置无秘钥-ssh-0-5-分" class="headerlink" title="【题目 3】配置无秘钥 ssh[0.5 分]"></a>【题目 3】配置无秘钥 ssh[0.5 分]</h4><p>配置 controller 节点可以无秘钥访问 compute 节点，配置完成后，尝试 ssh 连接 compute节点的 hostname 进行测试。完成后提交 controller 节点的用户名、密码和 IP 地址到答题框。</p>
<p>1.查看控制节点允许计算节点无秘钥登录计 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# ssh-keygen </span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/root/.ssh/id_rsa): </span><br><span class="line">Enter passphrase (empty for no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:eMrYvgTXlKEoQ4SVWEeZlTiVZMtbt2H5Z/LAjwq9K18 root@controller</span><br><span class="line">The key&#x27;s randomart image is:</span><br><span class="line">+---[RSA 2048]----+</span><br><span class="line">| *=ooB=o.        |</span><br><span class="line">|o...=+oo o .     |</span><br><span class="line">|  o ..+ + =      |</span><br><span class="line">|   o   * o =     |</span><br><span class="line">|    . + S . = o  |</span><br><span class="line">|     * o .   O   |</span><br><span class="line">|    . = . . E o  |</span><br><span class="line">|     o  .. +     |</span><br><span class="line">|      o. o=.     |</span><br><span class="line">+----[SHA256]-----+</span><br><span class="line">[root@controller ~]# ssh-copy-id root@compute </span><br><span class="line">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/root/.ssh/id_rsa.pub&quot;</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span><br><span class="line">root@compute&#x27;s password: </span><br><span class="line"></span><br><span class="line">Number of key(s) added: 1</span><br><span class="line"></span><br><span class="line">Now try logging into the machine, with:   &quot;ssh &#x27;root@compute&#x27;&quot;</span><br><span class="line">and check to make sure that only the key(s) you wanted were added.</span><br><span class="line"></span><br><span class="line">[root@controller ~]# ssh root@compute </span><br><span class="line">Last login: Tue Mar  7 02:18:21 2023</span><br><span class="line">[root@compute ~]#                     #无密钥连接成功</span><br></pre></td></tr></table></figure>

<h4 id="【题目-4】基础安装-0-5-分"><a href="#【题目-4】基础安装-0-5-分" class="headerlink" title="【题目 4】基础安装[0.5 分]"></a>【题目 4】基础安装[0.5 分]</h4><p>在控制节点和计算节点上分别安装 openstack-iaas 软件包，根据表 2 配置两个节点脚本文件中的基本变量（配置脚本文件为&#x2F;etc&#x2F;openstack&#x2F;openrc.sh）。<br>完成后提交控制节点的用户名、密码和 IP 地址到答题框。<br>1.检查环境变量文件配置正确计 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# yum install -y openstack-iaas</span><br><span class="line">[root@controller ~]# cat /etc/openstack/openrc.sh </span><br><span class="line">#--------------------system Config--------------------##</span><br><span class="line">#Controller Server Manager IP. example:x.x.x.x</span><br><span class="line">HOST_IP=192.168.20.161</span><br><span class="line"></span><br><span class="line">#Controller HOST Password. example:000000 </span><br><span class="line">HOST_PASS=000000</span><br><span class="line"></span><br><span class="line">#Controller Server hostname. example:controller</span><br><span class="line">HOST_NAME=controller</span><br><span class="line"></span><br><span class="line">#Compute Node Manager IP. example:x.x.x.x</span><br><span class="line">HOST_IP_NODE=192.168.20.195</span><br><span class="line"></span><br><span class="line">#Compute HOST Password. example:000000 </span><br><span class="line">HOST_PASS_NODE=000000</span><br><span class="line"></span><br><span class="line">#Compute Node hostname. example:compute</span><br><span class="line">HOST_NAME_NODE=compute</span><br><span class="line"></span><br><span class="line">#--------------------Chrony Config-------------------##</span><br><span class="line">#Controller network segment IP.  example:x.x.0.0/16(x.x.x.0/24)</span><br><span class="line">network_segment_IP=192.168.20.0/24</span><br><span class="line"></span><br><span class="line">#--------------------Rabbit Config ------------------##</span><br><span class="line">#user for rabbit. example:openstack</span><br><span class="line">RABBIT_USER=openstack</span><br><span class="line"></span><br><span class="line">#Password for rabbit user .example:000000</span><br><span class="line">RABBIT_PASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------MySQL Config---------------------##</span><br><span class="line">#Password for MySQL root user . exmaple:000000</span><br><span class="line">DB_PASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------Keystone Config------------------##</span><br><span class="line">#Password for Keystore admin user. exmaple:000000</span><br><span class="line">DOMAIN_NAME=demo</span><br><span class="line">ADMIN_PASS=000000</span><br><span class="line">DEMO_PASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Mysql keystore user. exmaple:000000</span><br><span class="line">KEYSTONE_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------Glance Config--------------------##</span><br><span class="line">#Password for Mysql glance user. exmaple:000000</span><br><span class="line">GLANCE_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore glance user. exmaple:000000</span><br><span class="line">GLANCE_PASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------Placement Config----------------------##</span><br><span class="line">#Password for Mysql placement user. exmaple:000000</span><br><span class="line">PLACEMENT_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore placement user. exmaple:000000</span><br><span class="line">PLACEMENT_PASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------Nova Config----------------------##</span><br><span class="line">#Password for Mysql nova user. exmaple:000000</span><br><span class="line">NOVA_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore nova user. exmaple:000000</span><br><span class="line">NOVA_PASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------Neutron Config-------------------##</span><br><span class="line">#Password for Mysql neutron user. exmaple:000000</span><br><span class="line">NEUTRON_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore neutron user. exmaple:000000</span><br><span class="line">NEUTRON_PASS=000000</span><br><span class="line"></span><br><span class="line">#metadata secret for neutron. exmaple:000000</span><br><span class="line">METADATA_SECRET=000000</span><br><span class="line"></span><br><span class="line">#External Network Interface. example:eth1</span><br><span class="line">INTERFACE_NAME=eth0</span><br><span class="line"></span><br><span class="line">#External Network The Physical Adapter. example:provider</span><br><span class="line">Physical_NAME=provider</span><br><span class="line"></span><br><span class="line">#First Vlan ID in VLAN RANGE for VLAN Network. exmaple:101</span><br><span class="line">minvlan=101</span><br><span class="line"></span><br><span class="line">#Last Vlan ID in VLAN RANGE for VLAN Network. example:200</span><br><span class="line">maxvlan=200</span><br><span class="line"></span><br><span class="line">#--------------------Cinder Config--------------------##</span><br><span class="line">#Password for Mysql cinder user. exmaple:000000</span><br><span class="line">CINDER_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore cinder user. exmaple:000000</span><br><span class="line">CINDER_PASS=000000</span><br><span class="line"></span><br><span class="line">#Cinder Block Disk. example:md126p3</span><br><span class="line">BLOCK_DISK=vdb1</span><br><span class="line"></span><br><span class="line">#--------------------Swift Config---------------------##</span><br><span class="line">#Password for Keystore swift user. exmaple:000000</span><br><span class="line">SWIFT_PASS=000000</span><br><span class="line"></span><br><span class="line">#The NODE Object Disk for Swift. example:md126p4.</span><br><span class="line">OBJECT_DISK=vdb2</span><br><span class="line"></span><br><span class="line">#The NODE IP for Swift Storage Network. example:x.x.x.x.</span><br><span class="line">STORAGE_LOCAL_NET_IP=192.168.20.195</span><br><span class="line"></span><br><span class="line">#--------------------Trove Config----------------------##</span><br><span class="line">#Password for Mysql trove user. exmaple:000000</span><br><span class="line">TROVE_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore trove user. exmaple:000000</span><br><span class="line">TROVE_PASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------Heat Config----------------------##</span><br><span class="line">#Password for Mysql heat user. exmaple:000000</span><br><span class="line">HEAT_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore heat user. exmaple:000000</span><br><span class="line">HEAT_PASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------Ceilometer Config----------------##</span><br><span class="line">#Password for Gnocchi ceilometer user. exmaple:000000</span><br><span class="line">CEILOMETER_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore ceilometer user. exmaple:000000</span><br><span class="line">CEILOMETER_PASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------AODH Config----------------##</span><br><span class="line">#Password for Mysql AODH user. exmaple:000000</span><br><span class="line">AODH_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore AODH user. exmaple:000000</span><br><span class="line">AODH_PASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------ZUN Config----------------##</span><br><span class="line">#Password for Mysql ZUN user. exmaple:000000</span><br><span class="line">ZUN_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore ZUN user. exmaple:000000</span><br><span class="line">ZUN_PASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore KURYR user. exmaple:000000</span><br><span class="line">KURYR_PASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------OCTAVIA Config----------------##</span><br><span class="line">#Password for Mysql OCTAVIA user. exmaple:000000</span><br><span class="line">OCTAVIA_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore OCTAVIA user. exmaple:000000</span><br><span class="line">OCTAVIA_PASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------Manila Config----------------##</span><br><span class="line">#Password for Mysql Manila user. exmaple:000000</span><br><span class="line">MANILA_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore Manila user. exmaple:000000</span><br><span class="line">MANILA_PASS=000000</span><br><span class="line"></span><br><span class="line">#The NODE Object Disk for Manila. example:md126p5.</span><br><span class="line">SHARE_DISK=vdb3</span><br><span class="line"></span><br><span class="line">#--------------------Cloudkitty Config----------------##</span><br><span class="line">#Password for Mysql Cloudkitty user. exmaple:000000</span><br><span class="line">CLOUDKITTY_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore Cloudkitty user. exmaple:000000</span><br><span class="line">CLOUDKITTY_PASS=000000</span><br><span class="line"></span><br><span class="line">#--------------------Barbican Config----------------##</span><br><span class="line">#Password for Mysql Barbican user. exmaple:000000</span><br><span class="line">BARBICAN_DBPASS=000000</span><br><span class="line"></span><br><span class="line">#Password for Keystore Barbican user. exmaple:000000</span><br><span class="line">BARBICAN_PASS=000000</span><br><span class="line">###############################################################</span><br><span class="line">#####在vi编辑器中执行:%s/^.\&#123;1\&#125;//  删除每行前1个字符(#号)#####</span><br><span class="line">###############################################################</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# iaas-pre-host.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~]# iaas-pre-host.sh</span><br></pre></td></tr></table></figure>

<h4 id="【题目-5】数据库安装与调优-0-5-分"><a href="#【题目-5】数据库安装与调优-0-5-分" class="headerlink" title="【题目 5】数据库安装与调优[0.5 分]"></a>【题目 5】数据库安装与调优[0.5 分]</h4><p>在 controller 节点上使用 iaas-install-mysql.sh 脚本安装 Mariadb、Memcached、RabbitMQ等服务。安装服务完毕后，修改&#x2F;etc&#x2F;my.cnf 文件，完成下列要求：<br>1.设置数据库支持大小写；<br>2.设置数据库缓存 innodb 表的索引，数据，插入数据时的缓冲为 4G；<br>3.设置数据库的 log buffer 为 64MB；<br>4.设置数据库的 redo log 大小为 256MB；</p>
<p>5.设置数据库的 redo log 文件组为 2。<br>完成后提交控制节点的用户名、密码和 IP 地址到答题框。<br>1.检查数据库配置正确计 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# iaas-install-mysql.sh</span><br><span class="line">[root@controller ~]# cat /etc/my.cnf</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># This group is read both both by the client and the server</span><br><span class="line"></span><br><span class="line"># use it for options that affect everything</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line">[client-server]</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># This group is read by the server</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line"># Disabling symbolic-links is recommended to prevent assorted security risks</span><br><span class="line"></span><br><span class="line">symbolic-links=0</span><br><span class="line">default-storage-engine = innodb</span><br><span class="line">innodb_file_per_table</span><br><span class="line">collation-server = utf8_general_ci</span><br><span class="line">init-connect = &#x27;SET NAMES utf8&#x27;</span><br><span class="line">character-set-server = utf8</span><br><span class="line">max_connections=10000</span><br><span class="line">lower_case_table_names = 1 #数据库支持大小写</span><br><span class="line">innodb_buffer_pool_size = 4G #数据库缓存</span><br><span class="line">innodb_log_buffer_size = 64MB #设置数据库的log buffer为64mb</span><br><span class="line">innodb_log_file_size = 256MB #设置数据库的redo log大小为256mb</span><br><span class="line">innodb_log_files_in_group = 2 #设置数据库的redo log文件组为2</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># include all files from the config directory</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line">!includedir /etc/my.cnf.d</span><br><span class="line"></span><br><span class="line">[root@controller ~]# systemctl restart mariadb</span><br></pre></td></tr></table></figure>

<h4 id="【题目-6】Keystone-服务安装与使用-0-5-分"><a href="#【题目-6】Keystone-服务安装与使用-0-5-分" class="headerlink" title="【题目 6】Keystone 服务安装与使用[0.5 分]"></a>【题目 6】Keystone 服务安装与使用[0.5 分]</h4><p>在 controller 节点上使用 iaas-install-keystone.sh 脚本安装 Keystone 服务。安装完成后，使用相关命令，创建用户 chinaskill，密码为 000000。完成后提交控制节点的用户名、密码和 IP 地址到答题框。<br>1.检查 keystone 服务安装正确计 0.2 分<br>2.检查 chinaskill 用户创建正确计 0.3 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# iaas-install-keystone.sh </span><br><span class="line">[root@controller ~]# source /etc/keystone/admin-openrc.sh </span><br><span class="line">[root@controller ~]# openstack user create --domain demo chinaskill --password 000000</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | 916f69a6dc5d462c8743799c33d6cd8b |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | ce30ed9e337b4441acbb5947ce95b9ee |</span><br><span class="line">| name                | chinaskill                       |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">[root@controller ~]# openstack user list</span><br><span class="line">+----------------------------------+------------+</span><br><span class="line">| ID                               | Name       |</span><br><span class="line">+----------------------------------+------------+</span><br><span class="line">| e5bcdce7fc39415693bd84a44f6d6373 | admin      |</span><br><span class="line">| c6c1bf4fad804eca9eed9515bcf16d78 | demo       |</span><br><span class="line">| ce30ed9e337b4441acbb5947ce95b9ee | chinaskill |</span><br><span class="line">+----------------------------------+------------+</span><br></pre></td></tr></table></figure>

<h4 id="【题目-7】Glance-安装与使用-0-5-分"><a href="#【题目-7】Glance-安装与使用-0-5-分" class="headerlink" title="【题目 7】Glance 安装与使用[0.5 分]"></a>【题目 7】Glance 安装与使用[0.5 分]</h4><p>在 controller 节点上使用 iaas-install-glance.sh 脚本安装 glance 服务。使用命令将提供的 cirros-0.3.4-x86_64-disk.img 镜像（该镜像在 HTTP 服务中，可自行下载）上传至平台，命名为 cirros，并设置最小启动需要的硬盘为 10G，最小启动需要的内存为 1G。完成后提交控制节点的用户名、密码和 IP 地址到答题框。<br>1.检查 glance 服务安装正确计 0.1 分<br>2.检查 cirros 镜像最小启动硬盘与内存配置正确计 0.4 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# iaas-install-glance.sh</span><br><span class="line">[root@controller ~]# openstack image create cirros --disk qcow2 --container bare --min-disk 10 --min-ram 1024 &lt; cirros-0.3.4-x86_64-disk.img </span><br><span class="line">+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field            | Value                                                                                                                                                                                      |</span><br><span class="line">+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| checksum         | ee1eca47dc88f4879d8a229cc70a07c6                                                                                                                                                           |</span><br><span class="line">| container_format | bare                                                                                                                                                                                       |</span><br><span class="line">| created_at       | 2023-03-07T03:08:17Z                                                                                                                                                                       |</span><br><span class="line">| disk_format      | qcow2                                                                                                                                                                                      |</span><br><span class="line">| file             | /v2/images/da9fee49-f9a7-45e6-a830-f749e87b404b/file                                                                                                                                       |</span><br><span class="line">| id               | da9fee49-f9a7-45e6-a830-f749e87b404b                                                                                                                                                       |</span><br><span class="line">| min_disk         | 10                                                                                                                                                                                         |</span><br><span class="line">| min_ram          | 1024                                                                                                                                                                                       |</span><br><span class="line">| name             | cirros                                                                                                                                                                                     |</span><br><span class="line">| owner            | 5a824a04c09c4ba4b75767019900dc98                                                                                                                                                           |</span><br><span class="line">| properties       | os_hash_algo=&#x27;sha512&#x27;, os_hash_value=&#x27;1b03ca1bc3fafe448b90583c12f367949f8b0e665685979d95b004e48574b953316799e23240f4f739d1b5eb4c4ca24d38fdc6f4f9d8247a2bc64db25d6bbdb2&#x27;, os_hidden=&#x27;False&#x27; |</span><br><span class="line">| protected        | False                                                                                                                                                                                      |</span><br><span class="line">| schema           | /v2/schemas/image                                                                                                                                                                          |</span><br><span class="line">| size             | 13287936                                                                                                                                                                                   |</span><br><span class="line">| status           | active                                                                                                                                                                                     |</span><br><span class="line">| tags             |                                                                                                                                                                                            |</span><br><span class="line">| updated_at       | 2023-03-07T03:08:18Z                                                                                                                                                                       |</span><br><span class="line">| virtual_size     | None                                                                                                                                                                                       |</span><br><span class="line">| visibility       | shared                                                                                                                                                                                     |</span><br><span class="line">+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<h4 id="【题目-8】Nova-安装与优化-0-5-分"><a href="#【题目-8】Nova-安装与优化-0-5-分" class="headerlink" title="【题目 8】Nova 安装与优化[0.5 分]"></a>【题目 8】Nova 安装与优化[0.5 分]</h4><p>在 controller 节 点 和 compute 节 点 上 分 别 使 用 iaas-install-placement.sh 脚 本 、iaas-install-nova -controller.sh 脚本、iaas-install-nova-compute.sh 脚本安装 Nova 服务。安装完成后，请修改 nova 相关配置文件，解决因等待时间过长而导致虚拟机启动超时从而获取不到 IP 地址而报错失败的问题。配置完成后提交 controller 点的用户名、密码和 IP 地址到答题框。<br>1.检查 nova 服务解决超时问题配置正确计 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# iaas-install-placement.sh </span><br><span class="line">[root@controller ~]# iaas-install-nova-controller.sh </span><br><span class="line">[root@controller ~]# cat /etc/nova/nova.conf  | grep vif_plugging_is_fatal=false</span><br><span class="line">vif_plugging_is_fatal=false</span><br><span class="line">[root@controller ~]# systemctl restart *nova*</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~]# iaas-install-nova-compute.sh </span><br></pre></td></tr></table></figure>

<h4 id="【题目-9】Neutron-安装-0-5-分"><a href="#【题目-9】Neutron-安装-0-5-分" class="headerlink" title="【题目 9】Neutron 安装[0.5 分]"></a>【题目 9】Neutron 安装[0.5 分]</h4><p>使用提供的脚本 iaas-install-neutron-controller.sh 和 iaas-install-neutron-compute.sh，在controller 和 compute 节点上安装 neutron 服务。完成后提交控制节点的用户名、密码和 IP地址到答题框。<br>1.检查 neutron 服务安装正确计 0.2 分<br>2.检查 neutron 服务的 linuxbridge 网桥服务启动正确计 0.3 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# iaas-install-neutron-controller.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~]# iaas-install-neutron-compute.sh </span><br></pre></td></tr></table></figure>

<h4 id="【题目-10】Doshboard-安装-0-5-分"><a href="#【题目-10】Doshboard-安装-0-5-分" class="headerlink" title="【题目 10】Doshboard 安装[0.5 分]"></a>【题目 10】Doshboard 安装[0.5 分]</h4><p>在 controller 节点上使用 iaas-install-dashboad.sh 脚本安装 dashboad 服务。安装完成后，将 Dashboard 中的 Djingo 数据修改为存储在文件中（此种修改解决了 ALL-in-one 快照在其他云平台 Dashboard 不能访问的问题）。完成后提交控制节点的用户名、密码和 IP 地址到答题框。<br>1.检查 Dashboard 服务安装正确计 0.2 分<br>2.检查 Dashboard 服务中 Djingo 数据修改为存储在文件中配置正确计 0.3 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# iaas-install-dashboard.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# cat /etc/openstack-dashboard/local_settings | grep SESSION_ENGINE</span><br><span class="line"># SESSION_ENGINE to django.contrib.sessions.backends.signed_cookies</span><br><span class="line">SESSION_ENGINE = &#x27;django.contrib.sessions.backends.file&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="【题目-11】Swift-安装-0-5-分"><a href="#【题目-11】Swift-安装-0-5-分" class="headerlink" title="【题目 11】Swift 安装[0.5 分]"></a>【题目 11】Swift 安装[0.5 分]</h4><p>在 控 制 节 点 和 计 算 节 点 上 分 别 使 用 iaas-install-swift-controller.sh 和iaas-install-swift-compute.sh 脚本安装 Swift 服务。安装完成后，使用命令创建一个名叫examcontainer 的容器，将 cirros-0.3.4-x86_64-disk.img 镜像上传到 examcontainer 容器中，并设置分段存放，每一段大小为 10M。完成后提交控制节点的用户名、密码和 IP 地址到答题框。<br>1.检查 swift 服务安装正确计 0.3 分<br>2.分段上传 cirros 镜像正确计 0.2 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# iaas-install-swift-controller.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~]# iaas-install-swift-compute.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack container create examcontaienr</span><br><span class="line">+---------------------------------------+---------------+------------------------------------+</span><br><span class="line">| account                               | container     | x-trans-id                         |</span><br><span class="line">+---------------------------------------+---------------+------------------------------------+</span><br><span class="line">| AUTH_5a824a04c09c4ba4b75767019900dc98 | examcontaienr | tx453b000251d94847a87e7-006406d19d |</span><br><span class="line">+---------------------------------------+---------------+------------------------------------+</span><br><span class="line">[root@controller ~]# swift upload examcontainer -S 10000000 cirros-0.3.4-x86_64-disk.img </span><br><span class="line">cirros-0.3.4-x86_64-disk.img segment 1</span><br><span class="line">cirros-0.3.4-x86_64-disk.img segment 0</span><br><span class="line">cirros-0.3.4-x86_64-disk.img</span><br></pre></td></tr></table></figure>

<h4 id="【题目-12】Cinder-创建硬盘-0-5-分"><a href="#【题目-12】Cinder-创建硬盘-0-5-分" class="headerlink" title="【题目 12】Cinder 创建硬盘[0.5 分]"></a>【题目 12】Cinder 创建硬盘[0.5 分]</h4><p>在 控 制 节 点 和 计 算 节 点 分 别 使 用 iaas-install-cinder-controller.sh 、iaas-install-cinder-compute.sh 脚本安装 Cinder 服务，请在计算节点，对块存储进行扩容操作，即在计算节点再分出一个 5G 的分区，加入到 cinder 块存储的后端存储中去。完成后提交计算节点的用户名、密码和 IP 地址到答题框。</p>
<p>1.检查 cinder 后端存储扩容成功计 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# iaas-install-cinder-controller.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~]# iaas-install-cinder-compute.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~]# vgextend cinder-volumes /dev/vdb4</span><br><span class="line">[root@compute ~]# vgdisplay </span><br><span class="line">  --- Volume group ---</span><br><span class="line">  VG Name               cinder-volumes</span><br><span class="line">  System ID             </span><br><span class="line">  Format                lvm2</span><br><span class="line">  Metadata Areas        2</span><br><span class="line">  Metadata Sequence No  5</span><br><span class="line">  VG Access             read/write</span><br><span class="line">  VG Status             resizable</span><br><span class="line">  MAX LV                0</span><br><span class="line">  Cur LV                1</span><br><span class="line">  Open LV               0</span><br><span class="line">  Max PV                0</span><br><span class="line">  Cur PV                2</span><br><span class="line">  Act PV                2</span><br><span class="line">  VG Size               24.99 GiB</span><br><span class="line">  PE Size               4.00 MiB</span><br><span class="line">  Total PE              6398</span><br><span class="line">  Alloc PE / Size       4874 / &lt;19.04 GiB</span><br><span class="line">  Free  PE / Size       1524 / 5.95 GiB</span><br><span class="line">  VG UUID               nM28QF-pGdI-Q1Nh-LvoZ-F6aV-GuDh-2rey4k</span><br></pre></td></tr></table></figure>

<h4 id="【题目-13】Manila-服务安装与使用-0-5-分"><a href="#【题目-13】Manila-服务安装与使用-0-5-分" class="headerlink" title="【题目 13】Manila 服务安装与使用[0.5 分]"></a>【题目 13】Manila 服务安装与使用[0.5 分]</h4><p>在 控 制 和 计 算 节 点 上 分 别 使 用 iaas-install-manila-controller.sh 和iaas-install-manila-compute.sh 脚本安装 manila 服务。安装服务后创建 default_share_type 共享类型（不使用驱动程序支持），接着创建一个大小为 2G 的共享存储名为 share01 并开放share01 目录对 OpenStack 管理网段使用权限。最后提交控制节点的用户名、密码和 IP 地址到答题框。<br>1.检查 share01 共享存储正确创建并赋予权限计 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# iaas-install-manila-controller.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~]# iaas-install-manila-compute.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# manila type-create default_share_type false    #创建 default_share_type 共享类型（不使用驱动程序支持）</span><br><span class="line">+----------------------+--------------------------------------+</span><br><span class="line">| Property             | Value                                |</span><br><span class="line">+----------------------+--------------------------------------+</span><br><span class="line">| required_extra_specs | driver_handles_share_servers : False |</span><br><span class="line">| Name                 | default_share_type                   |</span><br><span class="line">| Visibility           | public                               |</span><br><span class="line">| is_default           | YES                                  |</span><br><span class="line">| ID                   | 6cfdc0f1-bfca-4f77-8012-57f07b3a53e1 |</span><br><span class="line">| optional_extra_specs |                                      |</span><br><span class="line">| Description          | None                                 |</span><br><span class="line">+----------------------+--------------------------------------+</span><br><span class="line">[root@controller ~]# manila create NFS 2 --name share01    #创建一个大小为 2G 的共享存储名为 share01</span><br><span class="line">+---------------------------------------+--------------------------------------+</span><br><span class="line">| Property                              | Value                                |</span><br><span class="line">+---------------------------------------+--------------------------------------+</span><br><span class="line">| status                                | creating                             |</span><br><span class="line">| share_type_name                       | default_share_type                   |</span><br><span class="line">| description                           | None                                 |</span><br><span class="line">| availability_zone                     | None                                 |</span><br><span class="line">| share_network_id                      | None                                 |</span><br><span class="line">| share_server_id                       | None                                 |</span><br><span class="line">| share_group_id                        | None                                 |</span><br><span class="line">| host                                  |                                      |</span><br><span class="line">| revert_to_snapshot_support            | False                                |</span><br><span class="line">| access_rules_status                   | active                               |</span><br><span class="line">| snapshot_id                           | None                                 |</span><br><span class="line">| create_share_from_snapshot_support    | False                                |</span><br><span class="line">| is_public                             | False                                |</span><br><span class="line">| task_state                            | None                                 |</span><br><span class="line">| snapshot_support                      | False                                |</span><br><span class="line">| id                                    | 39a379b3-2874-486d-9a04-b4e5daadb9ed |</span><br><span class="line">| size                                  | 2                                    |</span><br><span class="line">| source_share_group_snapshot_member_id | None                                 |</span><br><span class="line">| user_id                               | e5bcdce7fc39415693bd84a44f6d6373     |</span><br><span class="line">| name                                  | share01                              |</span><br><span class="line">| share_type                            | 6cfdc0f1-bfca-4f77-8012-57f07b3a53e1 |</span><br><span class="line">| has_replicas                          | False                                |</span><br><span class="line">| replication_type                      | None                                 |</span><br><span class="line">| created_at                            | 2023-03-07T06:21:59.000000           |</span><br><span class="line">| share_proto                           | NFS                                  |</span><br><span class="line">| mount_snapshot_support                | False                                |</span><br><span class="line">| project_id                            | 5a824a04c09c4ba4b75767019900dc98     |</span><br><span class="line">| metadata                              | &#123;&#125;                                   |</span><br><span class="line">+---------------------------------------+--------------------------------------+</span><br><span class="line">[root@controller ~]# manila access-allow share01 ip 192.168.20.0/24 --access-level rw    #开放share01 目录对 OpenStack 管理网段使用权限</span><br><span class="line">+--------------+--------------------------------------+</span><br><span class="line">| Property     | Value                                |</span><br><span class="line">+--------------+--------------------------------------+</span><br><span class="line">| access_key   | None                                 |</span><br><span class="line">| share_id     | 39a379b3-2874-486d-9a04-b4e5daadb9ed |</span><br><span class="line">| created_at   | 2023-03-07T06:22:54.000000           |</span><br><span class="line">| updated_at   | None                                 |</span><br><span class="line">| access_type  | ip                                   |</span><br><span class="line">| access_to    | 192.168.20.0/24                      |</span><br><span class="line">| access_level | rw                                   |</span><br><span class="line">| state        | queued_to_apply                      |</span><br><span class="line">| id           | 0a57e84a-7b61-4adf-b422-d76f0af111be |</span><br><span class="line">| metadata     | &#123;&#125;                                   |</span><br><span class="line">+--------------+--------------------------------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# manila type-list</span><br><span class="line">+--------------------------------------+--------------------+------------+------------+--------------------------------------+----------------------+-------------+</span><br><span class="line">| ID                                   | Name               | visibility | is_default | required_extra_specs                 | optional_extra_specs | Description |</span><br><span class="line">+--------------------------------------+--------------------+------------+------------+--------------------------------------+----------------------+-------------+</span><br><span class="line">| 6cfdc0f1-bfca-4f77-8012-57f07b3a53e1 | default_share_type | public     | YES        | driver_handles_share_servers : False |                      | None        |</span><br><span class="line">+--------------------------------------+--------------------+------------+------------+--------------------------------------+----------------------+-------------+</span><br><span class="line">[root@controller ~]# manila list</span><br><span class="line">+--------------------------------------+---------+------+-------------+-----------+-----------+--------------------+-----------------------------+-------------------+</span><br><span class="line">| ID                                   | Name    | Size | Share Proto | Status    | Is Public | Share Type Name    | Host                        | Availability Zone |</span><br><span class="line">+--------------------------------------+---------+------+-------------+-----------+-----------+--------------------+-----------------------------+-------------------+</span><br><span class="line">| 39a379b3-2874-486d-9a04-b4e5daadb9ed | share01 | 2    | NFS         | available | False     | default_share_type | compute@lvm#lvm-single-pool | nova              |</span><br><span class="line">+--------------------------------------+---------+------+-------------+-----------+-----------+--------------------+-----------------------------+-------------------+</span><br></pre></td></tr></table></figure>

<h4 id="【题目-14】Barbican-服务安装与使用-0-5-分"><a href="#【题目-14】Barbican-服务安装与使用-0-5-分" class="headerlink" title="【题目 14】Barbican 服务安装与使用[0.5 分]"></a>【题目 14】Barbican 服务安装与使用[0.5 分]</h4><p>使用 iaas-install-barbican.sh 脚本安装 barbican 服务，安装服务完毕后，使用 openstack命令创建一个名为 secret01 的密钥，创建完成后提交控制节点的用户名、密码和 IP 地址到答题框。<br>1.检查 secret01 密钥创建正确计 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# iaas-install-barbican.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack secret store --name secret01 --payload secretkey</span><br><span class="line">+---------------+------------------------------------------------------------------------+</span><br><span class="line">| Field         | Value                                                                  |</span><br><span class="line">+---------------+------------------------------------------------------------------------+</span><br><span class="line">| Secret href   | http://controller:9311/v1/secrets/40500d87-2c4d-4a14-8c75-5eeb8c9c9bc1 |</span><br><span class="line">| Name          | secret01                                                               |</span><br><span class="line">| Created       | None                                                                   |</span><br><span class="line">| Status        | None                                                                   |</span><br><span class="line">| Content types | None                                                                   |</span><br><span class="line">| Algorithm     | aes                                                                    |</span><br><span class="line">| Bit length    | 256                                                                    |</span><br><span class="line">| Secret type   | opaque                                                                 |</span><br><span class="line">| Mode          | cbc                                                                    |</span><br><span class="line">| Expiration    | None                                                                   |</span><br><span class="line">+---------------+------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<h4 id="【题目-15】Cloudkitty-服务安装与使用-1-分"><a href="#【题目-15】Cloudkitty-服务安装与使用-1-分" class="headerlink" title="【题目 15】Cloudkitty 服务安装与使用[1 分]"></a>【题目 15】Cloudkitty 服务安装与使用[1 分]</h4><p>使用 iaas-install-cloudkitty.sh 脚本安装 cloudkitty 服务，安装完毕后，启用 hashmap 评级模块，接着创建 volume_thresholds 组，创建服务匹配规则 volume.size，并设置每 GB 的价格为 0.01。接下来对应大量数据设置应用折扣，在组 volume_thresholds 中创建阈值，设置若超过 50GB 的阈值，应用 2%的折扣（0.98）。设置完成后提交控制节点的用户名、密码和 IP 地址到答题框。<br>1.检查 hashmap 评级模块启用成功计 0.2 分<br>2.检查服务匹配规则 volume.size 创建成功 0.8 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# iaas-install-cloudkitty.sh </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack rating module enable hashmap  #启用hashmap评级模块</span><br><span class="line">+---------+---------+----------+</span><br><span class="line">| Module  | Enabled | Priority |</span><br><span class="line">+---------+---------+----------+</span><br><span class="line">| hashmap | True    |        1 |</span><br><span class="line">+---------+---------+----------+</span><br><span class="line">[root@controller ~]# openstack rating hashmap group create volume_thresholds   #创建volume_thresholds组</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| Name              | Group ID                             |</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| volume_thresholds | ea44607d-a9a2-4cfd-ac56-aabd88ba007f |</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">[root@controller ~]# openstack rating hashmap service create volume.size     #创建服务匹配规则volume.size</span><br><span class="line">+-------------+--------------------------------------+</span><br><span class="line">| Name        | Service ID                           |</span><br><span class="line">+-------------+--------------------------------------+</span><br><span class="line">| volume.size | 54ef69c0-6000-4713-9518-2e02a67adbbe |</span><br><span class="line">+-------------+--------------------------------------+</span><br><span class="line">[root@controller ~]# openstack rating hashmap mapping create -s 54ef69c0-6000-4713-9518-2e02a67adbbe -g ea44607d-a9a2-4cfd-ac56-aabd88ba007f -t flat 0.01     #设置每GB的价格为0.01</span><br><span class="line">+--------------------------------------+-------+------------+------+----------+--------------------------------------+--------------------------------------+------------+</span><br><span class="line">| Mapping ID                           | Value | Cost       | Type | Field ID | Service ID                           | Group ID                             | Project ID |</span><br><span class="line">+--------------------------------------+-------+------------+------+----------+--------------------------------------+--------------------------------------+------------+</span><br><span class="line">| e2f9a6f9-bc27-4c49-953a-77dfa04df597 | None  | 0.01000000 | flat | None     | 54ef69c0-6000-4713-9518-2e02a67adbbe | ea44607d-a9a2-4cfd-ac56-aabd88ba007f | None       |</span><br><span class="line">+--------------------------------------+-------+------------+------+----------+--------------------------------------+--------------------------------------+------------+</span><br><span class="line">[root@controller ~]# openstack rating hashmap threshold  create -s 54ef69c0-6000-4713-9518-2e02a67adbbe -g ea44607d-a9a2-4cfd-ac56-aabd88ba007f -t rate 50 0.98    #在组 volume_thresholds 中创建阈值，设置若超过 50GB 的阈值，应用 2%的折扣（0.98）</span><br><span class="line">+--------------------------------------+-------------+------------+------+----------+--------------------------------------+--------------------------------------+------------+</span><br><span class="line">| Threshold ID                         | Level       | Cost       | Type | Field ID | Service ID                           | Group ID                             | Project ID |</span><br><span class="line">+--------------------------------------+-------------+------------+------+----------+--------------------------------------+--------------------------------------+------------+</span><br><span class="line">| f0def644-3b5b-45a8-a5d5-2ebd76aa7266 | 50.00000000 | 0.98000000 | rate | None     | 54ef69c0-6000-4713-9518-2e02a67adbbe | ea44607d-a9a2-4cfd-ac56-aabd88ba007f | None       |</span><br><span class="line">+--------------------------------------+-------------+------------+------+----------+--------------------------------------+--------------------------------------+------------+</span><br></pre></td></tr></table></figure>

<h4 id="【题目-16】OpenStack-平台内存优化-0-5-分"><a href="#【题目-16】OpenStack-平台内存优化-0-5-分" class="headerlink" title="【题目 16】OpenStack 平台内存优化[0.5 分]"></a>【题目 16】OpenStack 平台内存优化[0.5 分]</h4><p>搭建完 OpenStack 平台后，关闭系统的内存共享，打开透明大页。完成后提交控制节点的用户名、密码和 IP 地址到答题框。<br>1.检查系统内存优化成功计 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# cat /sys/kernel/mm/transparent_hugepage/defrag </span><br><span class="line">[always] madvise never</span><br><span class="line">[root@controller ~]# echo never &gt;&gt; /sys/kernel/mm/transparent_hugepage/defrag </span><br><span class="line">[root@controller ~]# cat /sys/kernel/mm/transparent_hugepage/defrag </span><br><span class="line">always madvise [never]</span><br></pre></td></tr></table></figure>

<h4 id="【题目-17】修改文件句柄数-0-5-分"><a href="#【题目-17】修改文件句柄数-0-5-分" class="headerlink" title="【题目 17】修改文件句柄数[0.5 分]"></a>【题目 17】修改文件句柄数[0.5 分]</h4><p>Linux 服务器大并发时，往往需要预先调优 Linux 参数。默认情况下，Linux 最大文件句柄数为 1024 个。当你的服务器在大并发达到极限时，就会报出“too many open files”。创建一台云主机，修改相关配置，将控制节点的最大文件句柄数永久修改为 65535。配置完成后提交 controller 点的用户名、密码和 IP 地址到答题框。<br>1.检查配置 linux 系统句柄数为 65535 成功计 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# cat /etc/security/limits.conf </span><br><span class="line"></span><br><span class="line">*		 hard    nofile		 65535</span><br><span class="line">*		 soft    nofile		 65535</span><br></pre></td></tr></table></figure>

<h4 id="【题目-18】Linux-系统调优-防止-SYN-攻击-1-分"><a href="#【题目-18】Linux-系统调优-防止-SYN-攻击-1-分" class="headerlink" title="【题目 18】Linux 系统调优-防止 SYN 攻击[1 分]"></a>【题目 18】Linux 系统调优-防止 SYN 攻击[1 分]</h4><p>修改 controller 节点的相关配置文件，开启 SYN cookie，防止 SYN 洪水攻击。完成后提交 controller 节点的用户名、密码和 IP 地址到答题框。<br>1.检查开启 SYN cookie 配置计 1 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# cat /etc/sysctl.conf </span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">[root@controller ~]# sysctl -p</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br></pre></td></tr></table></figure>

<h3 id="【任务-2】私有云服务运维-10-分"><a href="#【任务-2】私有云服务运维-10-分" class="headerlink" title="【任务 2】私有云服务运维[10 分]"></a>【任务 2】私有云服务运维[10 分]</h3><h4 id="【题目-1】OpenStack-开放镜像权限-0-5-分"><a href="#【题目-1】OpenStack-开放镜像权限-0-5-分" class="headerlink" title="【题目 1】OpenStack 开放镜像权限[0.5 分]"></a>【题目 1】OpenStack 开放镜像权限[0.5 分]</h4><p>使 用 OpenStack 私 有 云 平 台 ， 在 OpenStack 平 台 的 admin 项 目 中 使 用cirros-0.3.4-x86_64-disk.img 镜像文件创建名为 glance-cirros 的镜像，通过 OpenStack 命令将glance-cirros 镜像指定 demo 项目进行共享使用。配置完成后提交 controller 点的用户名、密码和 IP 地址到答题框。<br>1.检查 glance-cirros 镜像权限开放正确计 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack image create glance-cirros &lt; cirros-0.3.4-x86_64-disk.img </span><br><span class="line">+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field            | Value                                                                                                                                                                                      |</span><br><span class="line">+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| checksum         | ee1eca47dc88f4879d8a229cc70a07c6                                                                                                                                                           |</span><br><span class="line">| container_format | bare                                                                                                                                                                                       |</span><br><span class="line">| created_at       | 2023-03-07T07:05:58Z                                                                                                                                                                       |</span><br><span class="line">| disk_format      | raw                                                                                                                                                                                        |</span><br><span class="line">| file             | /v2/images/54b116cf-e941-403c-9fa3-082e767712f6/file                                                                                                                                       |</span><br><span class="line">| id               | 54b116cf-e941-403c-9fa3-082e767712f6                                                                                                                                                       |</span><br><span class="line">| min_disk         | 0                                                                                                                                                                                          |</span><br><span class="line">| min_ram          | 0                                                                                                                                                                                          |</span><br><span class="line">| name             | glance-cirros                                                                                                                                                                              |</span><br><span class="line">| owner            | 5a824a04c09c4ba4b75767019900dc98                                                                                                                                                           |</span><br><span class="line">| properties       | os_hash_algo=&#x27;sha512&#x27;, os_hash_value=&#x27;1b03ca1bc3fafe448b90583c12f367949f8b0e665685979d95b004e48574b953316799e23240f4f739d1b5eb4c4ca24d38fdc6f4f9d8247a2bc64db25d6bbdb2&#x27;, os_hidden=&#x27;False&#x27; |</span><br><span class="line">| protected        | False                                                                                                                                                                                      |</span><br><span class="line">| schema           | /v2/schemas/image                                                                                                                                                                          |</span><br><span class="line">| size             | 13287936                                                                                                                                                                                   |</span><br><span class="line">| status           | active                                                                                                                                                                                     |</span><br><span class="line">| tags             |                                                                                                                                                                                            |</span><br><span class="line">| updated_at       | 2023-03-07T07:05:59Z                                                                                                                                                                       |</span><br><span class="line">| virtual_size     | None                                                                                                                                                                                       |</span><br><span class="line">| visibility       | shared                                                                                                                                                                                     |</span><br><span class="line">+------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">[root@controller ~]# openstack project list</span><br><span class="line">+----------------------------------+---------+</span><br><span class="line">| ID                               | Name    |</span><br><span class="line">+----------------------------------+---------+</span><br><span class="line">| 5a824a04c09c4ba4b75767019900dc98 | admin   |</span><br><span class="line">| a580b951935c454595e36921e15b4781 | service |</span><br><span class="line">| b8d9637523374f939026d268e033a77b | demo    |</span><br><span class="line">+----------------------------------+---------+</span><br><span class="line">[root@controller ~]# glance member-create 54b116cf-e941-403c-9fa3-082e767712f6 b8d9637523374f939026d268e033a77b</span><br><span class="line">+--------------------------------------+----------------------------------+---------+</span><br><span class="line">| Image ID                             | Member ID                        | Status  |</span><br><span class="line">+--------------------------------------+----------------------------------+---------+</span><br><span class="line">| 54b116cf-e941-403c-9fa3-082e767712f6 | b8d9637523374f939026d268e033a77b | pending |</span><br><span class="line">+--------------------------------------+----------------------------------+---------+</span><br><span class="line">[root@controller ~]# glance member-update 54b116cf-e941-403c-9fa3-082e767712f6 b8d9637523374f939026d268e033a77b accepted</span><br><span class="line">+--------------------------------------+----------------------------------+----------+</span><br><span class="line">| Image ID                             | Member ID                        | Status   |</span><br><span class="line">+--------------------------------------+----------------------------------+----------+</span><br><span class="line">| 54b116cf-e941-403c-9fa3-082e767712f6 | b8d9637523374f939026d268e033a77b | accepted |</span><br><span class="line">+--------------------------------------+----------------------------------+----------+</span><br></pre></td></tr></table></figure>

<h4 id="【题目-2】OpenStack-消息队列调优-0-5-分"><a href="#【题目-2】OpenStack-消息队列调优-0-5-分" class="headerlink" title="【题目 2】OpenStack 消息队列调优[0.5 分]"></a>【题目 2】OpenStack 消息队列调优[0.5 分]</h4><p>OpenStack 各服务内部通信都是通过 RPC 来交互，各 agent 都需要去连接 RabbitMQ；随着各服务 agent 增多，MQ 的连接数会随之增多，最终可能会到达上限，成为瓶颈。使用自行搭建的 OpenStack 私有云平台，分别通过用户级别、系统级别、配置文件来设置 RabbitMQ服务的最大连接数为 10240，配置完成后提交修改节点的用户名、密码和 IP 地址到答题框。<br>1.检查 rabbitmq 服务最大连接数正确计 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# cat /etc/security/limits.conf   #用户级别</span><br><span class="line"></span><br><span class="line">*		 hard    nofile		 10240</span><br><span class="line">*		 soft    nofile		 10240</span><br><span class="line">[root@controller ~]# cat /etc/sysctl.conf </span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">fs.file-max=10240   #系统级别</span><br><span class="line">[root@controller ~]# sysctl -p</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">fs.file-max = 10240</span><br><span class="line">[root@controller ~]# cat /usr/lib/systemd/system/rabbitmq-server.service </span><br><span class="line"># systemd unit example</span><br><span class="line">[Unit]</span><br><span class="line">Description=RabbitMQ broker</span><br><span class="line">After=network.target epmd@0.0.0.0.socket</span><br><span class="line">Wants=network.target epmd@0.0.0.0.socket</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">User=rabbitmq</span><br><span class="line">Group=rabbitmq</span><br><span class="line">NotifyAccess=all</span><br><span class="line">TimeoutStartSec=3600</span><br><span class="line"># Note:</span><br><span class="line"># You *may* wish to add the following to automatically restart RabbitMQ</span><br><span class="line"># in the event of a failure. systemd service restarts are not a</span><br><span class="line"># replacement for service monitoring. Please see</span><br><span class="line"># http://www.rabbitmq.com/monitoring.html</span><br><span class="line">#</span><br><span class="line"># Restart=on-failure</span><br><span class="line"># RestartSec=10</span><br><span class="line">WorkingDirectory=/var/lib/rabbitmq</span><br><span class="line">ExecStart=/usr/lib/rabbitmq/bin/rabbitmq-server</span><br><span class="line">ExecStop=/usr/lib/rabbitmq/bin/rabbitmqctl stop</span><br><span class="line">ExecStop=/bin/sh -c &quot;while ps -p $MAINPID &gt;/dev/null 2&gt;&amp;1; do sleep 1; done&quot;</span><br><span class="line">LimitNOFILE=10240    #配置文件</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# systemctl daemon-reload</span><br><span class="line">[root@controller ~]# systemctl restart rabbitmq-server</span><br><span class="line">[root@controller ~]# </span><br><span class="line">[root@controller ~]# </span><br><span class="line">[root@controller ~]# rabbitmqctl status</span><br><span class="line">Status of node rabbit@controller</span><br><span class="line">[&#123;pid,5068&#125;,</span><br><span class="line"> &#123;running_applications,</span><br><span class="line">     [&#123;rabbit,&quot;RabbitMQ&quot;,&quot;3.6.16&quot;&#125;,</span><br><span class="line">      &#123;rabbit_common,</span><br><span class="line">          &quot;Modules shared by rabbitmq-server and rabbitmq-erlang-client&quot;,</span><br><span class="line">          &quot;3.6.16&quot;&#125;,</span><br><span class="line">      &#123;compiler,&quot;ERTS  CXC 138 10&quot;,&quot;7.0.4.1&quot;&#125;,</span><br><span class="line">      &#123;xmerl,&quot;XML parser&quot;,&quot;1.3.14&quot;&#125;,</span><br><span class="line">      &#123;ranch,&quot;Socket acceptor pool for TCP protocols.&quot;,&quot;1.3.2&quot;&#125;,</span><br><span class="line">      &#123;mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.14.3&quot;&#125;,</span><br><span class="line">      &#123;syntax_tools,&quot;Syntax tools&quot;,&quot;2.1.1&quot;&#125;,</span><br><span class="line">      &#123;ssl,&quot;Erlang/OTP SSL application&quot;,&quot;8.1.3.1&quot;&#125;,</span><br><span class="line">      &#123;os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.4.2&quot;&#125;,</span><br><span class="line">      &#123;public_key,&quot;Public key infrastructure&quot;,&quot;1.4&quot;&#125;,</span><br><span class="line">      &#123;crypto,&quot;CRYPTO&quot;,&quot;3.7.4&quot;&#125;,</span><br><span class="line">      &#123;asn1,&quot;The Erlang ASN1 compiler version 4.0.4&quot;,&quot;4.0.4&quot;&#125;,</span><br><span class="line">      &#123;recon,&quot;Diagnostic tools for production use&quot;,&quot;2.3.2&quot;&#125;,</span><br><span class="line">      &#123;sasl,&quot;SASL  CXC 138 11&quot;,&quot;3.0.3&quot;&#125;,</span><br><span class="line">      &#123;stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;3.3&quot;&#125;,</span><br><span class="line">      &#123;kernel,&quot;ERTS  CXC 138 10&quot;,&quot;5.2&quot;&#125;]&#125;,</span><br><span class="line"> &#123;os,&#123;unix,linux&#125;&#125;,</span><br><span class="line"> &#123;erlang_version,</span><br><span class="line">     &quot;Erlang/OTP 19 [erts-8.3.5.3] [source] [64-bit] [smp:4:4] [async-threads:64] [hipe] [kernel-poll:true]\n&quot;&#125;,</span><br><span class="line"> &#123;memory,</span><br><span class="line">     [&#123;connection_readers,2026008&#125;,</span><br><span class="line">      &#123;connection_writers,360960&#125;,</span><br><span class="line">      &#123;connection_channels,515976&#125;,</span><br><span class="line">      &#123;connection_other,3295536&#125;,</span><br><span class="line">      &#123;queue_procs,1851512&#125;,</span><br><span class="line">      &#123;queue_slave_procs,0&#125;,</span><br><span class="line">      &#123;plugins,0&#125;,</span><br><span class="line">      &#123;other_proc,19619360&#125;,</span><br><span class="line">      &#123;metrics,421520&#125;,</span><br><span class="line">      &#123;mgmt_db,0&#125;,</span><br><span class="line">      &#123;mnesia,335752&#125;,</span><br><span class="line">      &#123;other_ets,2143792&#125;,</span><br><span class="line">      &#123;binary,141972984&#125;,</span><br><span class="line">      &#123;msg_index,84952&#125;,</span><br><span class="line">      &#123;code,21467691&#125;,</span><br><span class="line">      &#123;atom,891849&#125;,</span><br><span class="line">      &#123;other_system,10030300&#125;,</span><br><span class="line">      &#123;allocated_unused,35666864&#125;,</span><br><span class="line">      &#123;reserved_unallocated,0&#125;,</span><br><span class="line">      &#123;total,91086848&#125;]&#125;,</span><br><span class="line"> &#123;alarms,[]&#125;,</span><br><span class="line"> &#123;listeners,[&#123;clustering,25672,&quot;::&quot;&#125;,&#123;amqp,5672,&quot;::&quot;&#125;]&#125;,</span><br><span class="line"> &#123;vm_memory_calculation_strategy,rss&#125;,</span><br><span class="line"> &#123;vm_memory_high_watermark,0.4&#125;,</span><br><span class="line"> &#123;vm_memory_limit,4971485593&#125;,</span><br><span class="line"> &#123;disk_free_limit,50000000&#125;,</span><br><span class="line"> &#123;disk_free,103964745728&#125;,</span><br><span class="line"> &#123;file_descriptors,</span><br><span class="line">     [&#123;total_limit,10140&#125;,</span><br><span class="line">      &#123;total_used,74&#125;,</span><br><span class="line">      &#123;sockets_limit,9124&#125;,</span><br><span class="line">      &#123;sockets_used,72&#125;]&#125;,</span><br><span class="line"> &#123;processes,[&#123;limit,1048576&#125;,&#123;used,1181&#125;]&#125;,</span><br><span class="line"> &#123;run_queue,0&#125;,</span><br><span class="line"> &#123;uptime,9&#125;,</span><br><span class="line"> &#123;kernel,&#123;net_ticktime,60&#125;&#125;]</span><br></pre></td></tr></table></figure>

<h4 id="【题目-3】OpenStack-Glance-镜像压缩-0-5-分"><a href="#【题目-3】OpenStack-Glance-镜像压缩-0-5-分" class="headerlink" title="【题目 3】OpenStack Glance 镜像压缩[0.5 分]"></a>【题目 3】OpenStack Glance 镜像压缩[0.5 分]</h4><p>使 用 自 行 搭 建 的 OpenStack 平 台 。 在 HTTP 服 务 中 存 在 一 个 镜 像 为CentOS7.5-compress.qcow2 的镜像，请使用 qemu 相关命令，对该镜像进行压缩，压缩后的镜像命名为 chinaskill-js-compress.qcow2 并存放在&#x2F;root 目录下。完成后提交 controller 点的用户名、密码和 IP 地址到答题框。<br>1.检查镜像压缩正确计 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# qemu-img convert -c -O qcow2 cirros-0.3.4-x86_64-disk.img chinaskill-cirros.img</span><br></pre></td></tr></table></figure>

<h4 id="【题目-4】glance-对接-cinder-后端存储-0-5-分"><a href="#【题目-4】glance-对接-cinder-后端存储-0-5-分" class="headerlink" title="【题目 4】glance 对接 cinder 后端存储[0.5 分]"></a>【题目 4】glance 对接 cinder 后端存储[0.5 分]</h4><p>在自行搭建的 OpenStack 平台中修改相关参数，使 glance 可以使用 cinder 作为后端存储，将镜像存储于 cinder 卷中。使用 cirros-0.3.4-x86_64-disk.img 文件创建 cirros-image 镜像存储于 cirros-cinder 卷中，通过 cirros-image 镜像使用 cinder 卷启动盘的方式进行创建虚拟机。完成后提交修改节点的用户名、密码和 IP 地址到答题框。</p>
<p>1.检查修改 glance 后端存储为 cinder 正确计 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# vi /etc/glance/glance-api.conf</span><br><span class="line">stores = file,http,swift,cinder</span><br><span class="line">show_multiple_locations = True</span><br><span class="line">[root@controller ~]# vi /etc/cinder/cinder.conf</span><br><span class="line">glance_api_version = 2</span><br><span class="line">allowed_direct_url_schemes = cinder</span><br><span class="line">image_upload_use_internal_tenant = True</span><br><span class="line">[root@controller ~]# systemctl restart openstack-glance*</span><br><span class="line">[root@controller ~]# systemctl restart openstack-cinder*</span><br><span class="line">去图形界面通过镜像创建一个云硬盘</span><br><span class="line">[root@controller ~]# cinder list</span><br><span class="line">+--------------------------------------+-----------+---------------+------+-------------+----------+-------------</span><br><span class="line">+</span><br><span class="line">| ID | Status | Name | Size | Volume Type</span><br><span class="line">| Bootable | Attached to |</span><br><span class="line">+--------------------------------------+-----------+---------------+------+-------------+----------+-------------</span><br><span class="line">+</span><br><span class="line">| 13b79150-8571-48e6-b3f9-478912d2b678 | available | cirros-cinder | 15 | - | true</span><br><span class="line">| |</span><br><span class="line">+--------------------------------------+-----------+---------------+------+-------------+----------+-------------</span><br><span class="line">+</span><br><span class="line">[root@controller ~]# glance image-create --name cirros-image --disk-format qcow2 --container</span><br><span class="line">bare</span><br><span class="line">+------------------+--------------------------------------+</span><br><span class="line">| Property | Value |</span><br><span class="line">+------------------+--------------------------------------+</span><br><span class="line">| checksum | None |</span><br><span class="line">| container_format | bare |</span><br><span class="line">| created_at | 2022-05-27T10:29:35Z |</span><br><span class="line">| disk_format | qcow2 |</span><br><span class="line">| id | 9d163f0d-58f2-49bd-b438-a4e2704e57ad |</span><br><span class="line">| locations | [] |</span><br><span class="line">| min_disk | 0 |</span><br><span class="line">| min_ram | 0 |</span><br><span class="line">| name | cirros-image |</span><br><span class="line">| os_hash_algo | None |</span><br><span class="line">| os_hash_value | None |</span><br><span class="line">| os_hidden | False |</span><br><span class="line">| owner | 50957190677d4ef186e7b0c04b99b44f |</span><br><span class="line">| protected | False |</span><br><span class="line">| size | None |</span><br><span class="line">| status | queued |</span><br><span class="line">| tags | [] |</span><br><span class="line">| updated_at | 2022-05-27T10:29:35Z |</span><br><span class="line">| virtual_size | Not available |</span><br><span class="line">| visibility | shared |</span><br><span class="line">+------------------+--------------------------------------+</span><br><span class="line">[root@controller ~]# glance location-add 9d163f0d-58f2-49bd-b438-a4e2704e57ad --url</span><br><span class="line">cinder://13b79150-8571-48e6-b3f9-478912d2b678</span><br></pre></td></tr></table></figure>



<h4 id="【题目-5】OpenStack-Heat-运维：创建容器-0-5-分"><a href="#【题目-5】OpenStack-Heat-运维：创建容器-0-5-分" class="headerlink" title="【题目 5】OpenStack Heat 运维：创建容器[0.5 分]"></a>【题目 5】OpenStack Heat 运维：创建容器[0.5 分]</h4><p>在 自 行 搭 建 的 OpenStack 私 有 云 平 台 上 ， 在 &#x2F;root 目 录 下 编 写 Heat 模 板create_container.yaml，要求执行 yaml 文件可以创建名为 heat-swift 的容器。完成后提交控制节点的用户名、密码和 IP 地址到答题框。（在提交信息前请准备好 yaml 模板执行的环境）</p>
<p>1.执行 heat 模板文件成功创建容器计 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# cat create_container.yaml </span><br><span class="line">heat_template_version: 2018-03-02</span><br><span class="line">resources:</span><br><span class="line">  server:</span><br><span class="line">    type: OS::Swift::Container</span><br><span class="line">    properties:</span><br><span class="line">      name: heat-swift</span><br><span class="line">[root@controller ~]# openstack stack create -t create_container.yaml heat-swift</span><br><span class="line">+---------------------+--------------------------------------+</span><br><span class="line">| Field               | Value                                |</span><br><span class="line">+---------------------+--------------------------------------+</span><br><span class="line">| id                  | 81873448-b1ad-48d9-9bbc-31fb158e1881 |</span><br><span class="line">| stack_name          | heat-swift                           |</span><br><span class="line">| description         | No description                       |</span><br><span class="line">| creation_time       | 2023-03-07T07:50:52Z                 |</span><br><span class="line">| updated_time        | None                                 |</span><br><span class="line">| stack_status        | CREATE_IN_PROGRESS                   |</span><br><span class="line">| stack_status_reason | Stack CREATE started                 |</span><br><span class="line">+---------------------+--------------------------------------+   </span><br></pre></td></tr></table></figure>

<h4 id="【题目-6】OpenStack-Nova-清除缓存-0-5-分"><a href="#【题目-6】OpenStack-Nova-清除缓存-0-5-分" class="headerlink" title="【题目 6】OpenStack Nova 清除缓存[0.5 分]"></a>【题目 6】OpenStack Nova 清除缓存[0.5 分]</h4><p>在 OpenStack 平台的一台计算节点创建虚拟机，若是第一次在该节点创建次虚拟机，会先将镜像文件复制到该计算节点目录&#x2F;var&#x2F;lib&#x2F;nova&#x2F;instances&#x2F;_base。长期下来，该目录会占用比较大的磁盘空间而要清理。可以通过修改 nova 的配置文件来自动清理该缓存目录，即在该节点没有使用某镜像启动的云主机，那么这个镜像在过一定的时间后会被自动删除。配置完成后提交改动节点的用户名、密码和 IP 地址到答题框。<br>1.检查 nova 配置自动清理缓存文件正确计 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# cat /etc/nova/nova.conf | grep remove_unused_base_images=true</span><br><span class="line">remove_unused_base_images=true</span><br><span class="line">[root@controller ~]# systemctl restart *nova*</span><br></pre></td></tr></table></figure>

<h4 id="【题目-7】Redis-一主二从三哨兵模式-1-分"><a href="#【题目-7】Redis-一主二从三哨兵模式-1-分" class="headerlink" title="【题目 7】Redis 一主二从三哨兵模式[1 分]"></a>【题目 7】Redis 一主二从三哨兵模式[1 分]</h4><p>使用提供的 OpenStack 私有云平台，申请三台 CentOS7.9 系统的云主机，使用提供的http 源，在三个节点自行安装 Redis 服务并启动，配置 Redis 的访问需要密码，密码设置为123456。然后将这三个 Redis 节点配置为 Redis 的一主二从三哨兵架构，即一个 Redis 主节点，两个从节点，三个节点均为哨兵节点。配置完成后提交 Redis 主节点的用户名、密码和IP 地址到答题框。<br>1.检查 redis 主从集群部署正确计 0.5 分<br>2.检查 redis 集群部署为哨兵节点正确计 0.5 分</p>
<p>主节点：</p>
<p><code>yum install -y redis</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/redis.conf </span><br><span class="line">bind 0.0.0.0</span><br><span class="line">protected-mode no</span><br><span class="line">daemonize yes</span><br><span class="line">masterauth 123456</span><br><span class="line">requirepass 123456</span><br></pre></td></tr></table></figure>

<p><code>systemctl restart redis</code></p>
<p><code>systemctl enable  redis</code></p>
<p>从节点1：</p>
<p><code>yum install -y redis</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/redis.conf</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">protected-mode no</span><br><span class="line">daemonize yes</span><br><span class="line">slaveof 192.168.20.104 6379</span><br><span class="line">masterauth 123456</span><br><span class="line">requirepass 123456</span><br></pre></td></tr></table></figure>

<p><code>systemctl restart redis</code></p>
<p><code>systemctl enable  redis</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@redis-2 ~]# redis-cli </span><br><span class="line">127.0.0.1:6379&gt; info</span><br><span class="line">.................</span><br><span class="line"># Replication</span><br><span class="line">role:slave</span><br><span class="line">master_host:192.168.20.104</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:7</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:589</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_repl_offset:0</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line">....................</span><br></pre></td></tr></table></figure>

<p>从节点2：</p>
<p><code>yum install -y redis</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/redis.conf</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">protected-mode no</span><br><span class="line">daemonize yes</span><br><span class="line">slaveof 192.168.20.104 6379</span><br><span class="line">masterauth 123456</span><br><span class="line">requirepass 123456</span><br></pre></td></tr></table></figure>

<p><code>systemctl restart redis</code></p>
<p><code>systemctl enable  redis</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@redis-3 ~]# redis-cli </span><br><span class="line">127.0.0.1:6379&gt; info</span><br><span class="line">.................</span><br><span class="line"># Replication</span><br><span class="line">role:slave</span><br><span class="line">master_host:192.168.20.104</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:7</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:589</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_repl_offset:0</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line">....................</span><br></pre></td></tr></table></figure>

<p>1、哨兵模式搭建：<br>哨兵模式需要修改sentinel.conf文件，三台服务器均为此配置</p>
<p><code>vi /etc/redis-sentinel.conf</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">端口默认为26379。</span><br><span class="line">port 26379</span><br><span class="line">关闭保护模式，可以外部访问。</span><br><span class="line">protected-mode no</span><br><span class="line">设置为后台启动。</span><br><span class="line">daemonize yes</span><br><span class="line">指定主机IP地址和端口(三台配置均为指定主机ip)，并且指定当有2台哨兵认为主机宕机，则对主机进行容灾切换。mymaster：设置master名字，必须在其它有用到该名字的命令之前设置</span><br><span class="line">sentinel monitor mymaster 192.168.20.104 6379 2</span><br><span class="line">当在Redis实例中开启了requirepass，这里就需要提供密码。</span><br><span class="line">sentinel auth-pass mymaster 123456</span><br><span class="line">这里设置了主机多少秒无响应，则认为挂了。此处3秒</span><br><span class="line">sentinel down-after-milliseconds mymaster 3000</span><br><span class="line">主备切换时，最多有多少个slave同时对新的master进行同步，这里设置为默认的1。</span><br><span class="line">snetinel parallel-syncs mymaster 1</span><br><span class="line">故障转移的超时时间，这里设置为三分钟。</span><br><span class="line">sentinel failover-timeout mymaster 180000</span><br></pre></td></tr></table></figure>

<h4 id="【题目-8】Redis-服务调优-AOF-1-分"><a href="#【题目-8】Redis-服务调优-AOF-1-分" class="headerlink" title="【题目 8】Redis 服务调优-AOF[1 分]"></a>【题目 8】Redis 服务调优-AOF[1 分]</h4><p>使用上一题安装的 Redis 服务。在 Redis 中，AOF 配置为以三种不同的方式在磁盘上执行 write 或者 fsync。假设当前 Redis 压力过大，请配置 Redis 不执行 fsync。除此之外，避免AOF 文件过大，Redis 会进行 AOF 重写，生成缩小的 AOF 文件。请修改配置，让 AOF 重写时，不进行 fsync 操作。配置完成后提交 Redis 节点的用户名、密码和 IP 地址到答题框。<br>1.检查配置 redis 不执行 fsync 正确计 0.5 分、<br>2.检查配置 redis 进行 AOF 重写不执行 fsync 正确计 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# vi /etc/redis.conf</span><br><span class="line">appendonly yes</span><br><span class="line">appendfsync no                 # 将原来的everysec修改为no,表示不执行fsync</span><br><span class="line">no-appendfsync-on-rewrite yes  # 将原来的no改为yes,表示进行aof重写不执行fsync</span><br></pre></td></tr></table></figure>

<h4 id="【题目-9】应用部署：堡垒机部署-0-5-分"><a href="#【题目-9】应用部署：堡垒机部署-0-5-分" class="headerlink" title="【题目 9】应用部署：堡垒机部署[0.5 分]"></a>【题目 9】应用部署：堡垒机部署[0.5 分]</h4><p>使用提供的 OpenStack 平台申请一台 CentOS7.9 的云主机，使用提供的软件包安装JumpServer 堡垒机服务，并配置使用该堡垒机对接自己安装的 controller 和 compute 节点。完成后提交 JumpServer 节点的用户名、密码和 IP 地址到答题框。<br>1.检查堡垒机部署正确计 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[root@jumpserver ~]# ls</span><br><span class="line">jumpserver.tar.gz</span><br><span class="line">[root@jumpserver ~]# tar -zxvf jumpserver.tar.gz -C /opt/</span><br><span class="line">[root@jumpserver ~]# cd /opt/</span><br><span class="line">[root@jumpserver opt]# ls</span><br><span class="line">compose  config  docker  docker.service  images  jumpserver  jumpserver-repo  static.env</span><br><span class="line">[root@jumpserver ~]# cd /etc/yum.repos.d/</span><br><span class="line">[root@jumpserver yum.repos.d]# mkdir bak</span><br><span class="line">[root@jumpserver yum.repos.d]# mv CentOS-* bak/</span><br><span class="line">[root@jumpserver yum.repos.d]# cat local.repo </span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=ftp://192.168.200.10/centos</span><br><span class="line">gpgcheck=0</span><br><span class="line">[jumpserver ]</span><br><span class="line">name=jumpserver</span><br><span class="line">baseurl=file:///opt/jumpserver-repo</span><br><span class="line">gpgcheck=0</span><br><span class="line">[root@jumpserver ~]# yum install python2 -y</span><br><span class="line">[root@jumpserver opt]# cp -rf /opt/docker/* /usr/bin/</span><br><span class="line">[root@jumpserver opt]# chmod 775 /usr/bin/docker*</span><br><span class="line">[root@jumpserver opt]# cp -rf /opt/docker.service /etc/systemd/system</span><br><span class="line">[root@jumpserver opt]# chmod 775 /etc/systemd/system/docker.service </span><br><span class="line">[root@jumpserver opt]# systemctl daemon-reload</span><br><span class="line">[root@jumpserver opt]# systemctl enable docker --now</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /etc/systemd/system/docker.service.</span><br><span class="line">[root@jumpserver opt]# docker -v</span><br><span class="line">Docker version 18.06.3-ce, build d7080c1</span><br><span class="line">[root@jumpserver opt]# docker-compose -v</span><br><span class="line">docker-compose version 1.27.4, build 40524192</span><br><span class="line">[root@jumpserver opt]# </span><br><span class="line">[root@jumpserver images]# ls</span><br><span class="line">jumpserver_core_v2.11.4.tar  jumpserver_lion_v2.11.4.tar  jumpserver_nginx_alpine2.tar</span><br><span class="line">jumpserver_koko_v2.11.4.tar  jumpserver_luna_v2.11.4.tar  jumpserver_redis_6-alpine.tar</span><br><span class="line">jumpserver_lina_v2.11.4.tar  jumpserver_mysql_5.tar       load.sh</span><br><span class="line">[root@jumpserver images]# cat load.sh </span><br><span class="line">#!/bin/bash</span><br><span class="line">docker load -i jumpserver_core_v2.11.4.tar</span><br><span class="line">docker load -i jumpserver_koko_v2.11.4.tar</span><br><span class="line">docker load -i jumpserver_lina_v2.11.4.tar</span><br><span class="line">docker load -i jumpserver_lion_v2.11.4.tar</span><br><span class="line">docker load -i jumpserver_luna_v2.11.4.tar</span><br><span class="line">docker load -i jumpserver_mysql_5.tar</span><br><span class="line">docker load -i jumpserver_nginx_alpine2.tar</span><br><span class="line">docker load -i jumpserver_redis_6-alpine.tar</span><br><span class="line">[root@jumpserver images]# sh load.sh </span><br><span class="line">[root@jumpserver images]# mkdir -p /opt/jumpserver/&#123;core,koko,lion,mysql,nginx,redis&#125;</span><br><span class="line">[root@jumpserver images]# cp -rf /opt/config /opt/jumpserver/</span><br><span class="line">[root@jumpserver compose]# ls</span><br><span class="line">config_static                docker-compose-lb.yml              docker-compose-network.yml         down.sh</span><br><span class="line">docker-compose-app.yml       docker-compose-mysql-internal.yml  docker-compose-redis-internal.yml  up.sh</span><br><span class="line">docker-compose-es.yml        docker-compose-mysql.yml           docker-compose-redis.yml</span><br><span class="line">docker-compose-external.yml  docker-compose-network_ipv6.yml    docker-compose-task.yml</span><br><span class="line">[root@jumpserver compose]# source /opt/static.env </span><br><span class="line">[root@jumpserver compose]# sh up.sh </span><br><span class="line">Creating network &quot;jms_net&quot; with driver &quot;bridge&quot;</span><br><span class="line">Creating jms_redis ... done</span><br><span class="line">Creating jms_mysql ... done</span><br><span class="line">Creating jms_core  ... done</span><br><span class="line">Creating jms_lina   ... done</span><br><span class="line">Creating jms_nginx  ... done</span><br><span class="line">Creating jms_celery ... done</span><br><span class="line">Creating jms_lion   ... done</span><br><span class="line">Creating jms_luna   ... done</span><br><span class="line">Creating jms_koko   ... done</span><br><span class="line">[root@jumpserver compose]#</span><br></pre></td></tr></table></figure>

<h4 id="【题目-10】skywalking-服务部署与应用-1-分"><a href="#【题目-10】skywalking-服务部署与应用-1-分" class="headerlink" title="【题目 10】skywalking 服务部署与应用[1 分]"></a>【题目 10】skywalking 服务部署与应用[1 分]</h4><p>使用提供的 OpenStack 私有云平台，申请一台 centos7.9 系统的云主机，使用提供的软件包安装 Elasticsearch 服务和 skywalking 服务，将 skywalking 的 UI 访问端口修改为 8888。接下来再申请一台 CentOS7.9 的云主机，用于搭建 gpmall 商城应用，并配置 SkyWalking Agent，将 gpmall 的 jar 包放置探针并启动。安装与配置完成后提交 skywalking 节点的用户名、密码和 IP 地址到答题框。<br>1.检查 skywalking 服务部署正确计 1 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br></pre></td><td class="code"><pre><span class="line">1. 部署 Elasticsearch 服务</span><br><span class="line">（1）修改主机名，修改主机名后，单击实验环境左侧工具栏最后一个重连按钮以生效新主</span><br><span class="line">机名。</span><br><span class="line">[root@node-1 ~]# hostnamectl set-hostname node-1</span><br><span class="line">[root@node-1 ~]# hostnamectl</span><br><span class="line">Static hostname: node-1</span><br><span class="line">Icon name: computer-vm</span><br><span class="line">Chassis: vm</span><br><span class="line">Machine ID: cc2c86fe566741e6a2ff6d399c5d5daa</span><br><span class="line">Boot ID: 6c32a0c1d29e4f30929422c8032239ca</span><br><span class="line">Virtualization: kvm</span><br><span class="line">Operating System: CentOS Linux 7 (Core)</span><br><span class="line">CPE OS Name: cpe:/o:centos:centos:7</span><br><span class="line">Kernel: Linux 3.10.0-1160.el7.x86_64</span><br><span class="line">Architecture: x86-64</span><br><span class="line">（2）将提供的 elasticsearch-7.17.0-linux-x86_64.tar.gz 软件包下载到此节点并解压到/opt</span><br><span class="line">目录，进入解压后的目录并创建 data 目录：</span><br><span class="line">[root@node-1 ~]# curl -O http://mirrors.douxuedu.com/competition/elasticsearch-7.17.</span><br><span class="line">0-linux-x86_64.tar.gz</span><br><span class="line">[root@node-1 ~]# tar -zxvf elasticsearch-7.17.0-linux-x86_64.tar.gz -C /opt</span><br><span class="line">[root@node-1 ~]# cd /opt/elasticsearch-7.17.0/</span><br><span class="line">[root@node-1 elasticsearch-7.17.0]# mkdir data</span><br><span class="line">（3）修改 Elasticsearch 配置，在文件最后添加如下几行内容，按“i”建进入编辑模式进行配</span><br><span class="line">置，按 ESC 键输入:wq 保存退出。</span><br><span class="line">[root@node-1 elasticsearch-7.17.0]# vi config/elasticsearch.yml</span><br><span class="line">...</span><br><span class="line">cluster.name: my-application</span><br><span class="line">node.name: node-1</span><br><span class="line">path.data: /opt/elasticsearch-7.17.0/data</span><br><span class="line">path.logs: /opt/elasticsearch-7.17.0/logs</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">cluster.initial_master_nodes: [&quot;node-1&quot;]</span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line">http.cors.allow-headers: Authorization,X-Requested-With,Content-Length,Content-Type</span><br><span class="line">（4）创建 Elasticsearch 启动用户，并设置属组及权限：</span><br><span class="line">[root@node-1 elasticsearch-7.17.0]# groupadd elsearch</span><br><span class="line">[root@node-1 elasticsearch-7.17.0]# useradd elsearch -g elsearch -p elasticsearch</span><br><span class="line">[root@node-1 elasticsearch-7.17.0]# chown -R elsearch:elsearch /opt/elasticsearch-7.</span><br><span class="line">17.0</span><br><span class="line">（5）修改资源限制及内核配置，添加如下内容：</span><br><span class="line">[root@node-1 elasticsearch-7.17.0]# vi /etc/security/limits.conf</span><br><span class="line">...</span><br><span class="line">* hard nofile 65536</span><br><span class="line">* soft nofile 65536</span><br><span class="line">[root@node-1 elasticsearch-7.17.0]# vi /etc/sysctl.conf</span><br><span class="line">vm.max_map_count=262144</span><br><span class="line">[root@node-1 elasticsearch-7.17.0]# sysctl -p</span><br><span class="line">[root@node-1 elasticsearch-7.17.0]# reboot</span><br><span class="line">重启后等待一段时间后刷新页面点击重新连接。</span><br><span class="line">（6）启动 Elasticsearch 服务：</span><br><span class="line">[root@node-1 ~]# cd /opt/elasticsearch-7.17.0/</span><br><span class="line">[root@node-1 elasticsearch-7.17.0]# su elsearch</span><br><span class="line">[elsearch@node-1 elasticsearch-7.17.0]$ ./bin/elasticsearch -d</span><br><span class="line">（7）查询端口，存在 9200 则成功启动：</span><br><span class="line">[root@node-1 elasticsearch-7.17.0]$ netstat -ntpl</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program n</span><br><span class="line">ame tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1081/ss</span><br><span class="line">hd tcp 0 0 127.0.0.1:25 0.0.0.0:* LISTEN 1041</span><br><span class="line">/master tcp 0 0 0.0.0.0:111 0.0.0.0:* LISTEN 6</span><br><span class="line">10/rpcbind</span><br><span class="line">tcp6 0 0 :::9300 :::* LISTEN 2261/java</span><br><span class="line">tcp6 0 0 :::22 :::* LISTEN 1081/sshd</span><br><span class="line">tcp6 0 0 ::1:25 :::* LISTEN 1041/master</span><br><span class="line">tcp6 0 0 :::111 :::* LISTEN 610/rpcbind</span><br><span class="line">tcp6 0 0 :::9200 :::* LISTEN 2261/java</span><br><span class="line">（8）切换至带有桌面的虚拟机环境中，使用浏览器访问 10.24.193.154:9200，如图 1 所示：</span><br><span class="line">图 1 Elasticsearch 服务访问</span><br><span class="line">2. 部署 SkyWalking OAP 服务</span><br><span class="line">（1）将提供的 jdk-8u144-linux-x64.tar.gz 软件包下载至 node-1 节点/root/目录中，并配置</span><br><span class="line">jdk 如下所示：</span><br><span class="line">[elsearch@node-1 elasticsearch-7.17.0]$ exit</span><br><span class="line">[root@node-1 elasticsearch-7.17.0]# cd</span><br><span class="line">[root@node-1 ~]# curl -O http://mirrors.douxuedu.com/competition/jdk-8u144-linux-x6</span><br><span class="line">4.tar.gz</span><br><span class="line">[root@node-1 ~]# tar -zxvf jdk-8u144-linux-x64.tar.gz -C /usr/local/</span><br><span class="line">修改 profile 环境变量文件，代码如下所示：</span><br><span class="line">[root@node-1 ~]# vi /etc/profile</span><br><span class="line">export JAVA_HOME=/usr/local/jdk1.8.0_144</span><br><span class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/jre/lib/rt.jar:$&#123;JAVA_HOME&#125;/lib/dt.jar:$&#123;JAVA_HOME&#125;/</span><br><span class="line">lib/tools.jar</span><br><span class="line">export PATH=$PATH:$&#123;JAVA_HOME&#125;/bin</span><br><span class="line">[root@node-1 ~]# source /etc/profile</span><br><span class="line">[root@node-1 ~]# java -version</span><br><span class="line">java version &quot;1.8.0_144&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_144-b01)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.144-b01, mixed mode)</span><br><span class="line">（2）将提供的 apache-skywalking-apm-es7-8.0.0.tar.gz 软件包下载至 node-1 节点上并解</span><br><span class="line">压到/opt 目录下：</span><br><span class="line">[root@node-1 ~]# curl -O http://mirrors.douxuedu.com/competition/apache-skywalking-a</span><br><span class="line">pm-es7-8.0.0.tar.gz</span><br><span class="line">[root@node-1 ~]# tar -zxvf apache-skywalking-apm-es7-8.0.0.tar.gz -C /opt</span><br><span class="line">（3）进入解压后目录，修改 OAP 配置文件：</span><br><span class="line">[root@node-1 ~]# cd /opt/apache-skywalking-apm-bin-es7/</span><br><span class="line">[root@node-1 apache-skywalking-apm-bin-es7]# vi config/application.yml</span><br><span class="line">...</span><br><span class="line">#集群配置使用单机版</span><br><span class="line">cluster:</span><br><span class="line">selector: $&#123;SW_CLUSTER:standalone&#125;</span><br><span class="line">standalone:</span><br><span class="line">...</span><br><span class="line">#数据库使用 elasticsearch7</span><br><span class="line">storage:</span><br><span class="line">selector: $&#123;SW_STORAGE:elasticsearch7&#125;</span><br><span class="line">...</span><br><span class="line">elasticsearch7:</span><br><span class="line">nameSpace: $&#123;SW_NAMESPACE:&quot;&quot;&#125;</span><br><span class="line">clusterNodes: $&#123;SW_STORAGE_ES_CLUSTER_NODES:10.24.194.203:9200&#125;</span><br><span class="line">...</span><br><span class="line">（4）启动 OAP 服务，查询端口，存在 11800 与 12800 则成功启动：</span><br><span class="line">[root@node-1 apache-skywalking-apm-bin-es7]# ./bin/oapService.sh</span><br><span class="line">SkyWalking OAP started successfully!</span><br><span class="line">[root@node-1 apache-skywalking-apm-bin-es7]# netstat -ntpl</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program n</span><br><span class="line">ame</span><br><span class="line">tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1081/sshd</span><br><span class="line">tcp 0 0 127.0.0.1:25 0.0.0.0:* LISTEN 1041/master</span><br><span class="line">tcp 0 0 0.0.0.0:111 0.0.0.0:* LISTEN 610/rpcbind</span><br><span class="line">tcp6 0 0 :::9300 :::* LISTEN 2261/java</span><br><span class="line">tcp6 0 0 :::22 :::* LISTEN 1081/sshd</span><br><span class="line">tcp6 0 0 :::11800 :::* LISTEN 2416/java</span><br><span class="line">tcp6 0 0 ::1:25 :::* LISTEN 1041/master</span><br><span class="line">tcp6 0 0 :::12800 :::* LISTEN 2416/java</span><br><span class="line">tcp6 0 0 :::111 :::* LISTEN 610/rpcbind</span><br><span class="line">tcp6 0 0 :::9200 :::* LISTEN 2261/java</span><br><span class="line">3. 部署 SkyWalking UI 服务</span><br><span class="line">（1）由于 SkyWalking UI 的默认地址是 8080，与很多中间件可能存在冲突，修改一下：</span><br><span class="line">[root@node-1 apache-skywalking-apm-bin-es7]# vi webapp/webapp.yml</span><br><span class="line">...</span><br><span class="line">server:</span><br><span class="line">port: 8888</span><br><span class="line">...</span><br><span class="line">（2）启动 SkyWalking UI 服务：</span><br><span class="line">[root@node-1 apache-skywalking-apm-bin-es7]# ./bin/webappService.sh</span><br><span class="line">SkyWalking Web Application started successfully!</span><br><span class="line">（3）查看端口，存在 8888 则成功启动：</span><br><span class="line">[root@node-1 apache-skywalking-apm-bin-es7]# netstat -ntpl</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program n</span><br><span class="line">ame</span><br><span class="line">tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1081/sshd</span><br><span class="line">tcp 0 0 127.0.0.1:25 0.0.0.0:* LISTEN 1041/master</span><br><span class="line">tcp 0 0 0.0.0.0:111 0.0.0.0:* LISTEN 610/rpcbind</span><br><span class="line">tcp6 0 0 :::9300 :::* LISTEN 2261/java</span><br><span class="line">tcp6 0 0 :::22 :::* LISTEN 1081/sshd</span><br><span class="line">tcp6 0 0 :::8888 :::* LISTEN 3133/java</span><br><span class="line">tcp6 0 0 :::11800 :::* LISTEN 2416/java</span><br><span class="line">tcp6 0 0 ::1:25 :::* LISTEN 1041/master</span><br><span class="line">tcp6 0 0 :::12800 :::* LISTEN 2416/java</span><br><span class="line">tcp6 0 0 :::111 :::* LISTEN 610/rpcbind</span><br><span class="line">tcp6 0 0 :::9200 :::* LISTEN 2261/java</span><br><span class="line">（4）切换带有桌面的虚拟机环境，使用火狐浏览器访问 10.24.194.203:8888，此时访问页面</span><br><span class="line">无数据，如图 2 所示：</span><br><span class="line">图 2 访问 SkyWalking UI 服务</span><br><span class="line">4. 搭建并启动应用商城服务</span><br><span class="line">切换至提供 mall 节点，搭建并启动应用商城服务，并配置 SkyWalking Agent</span><br><span class="line">（1）修改 mall 节点主机名，修改完成后，单击实验环境左侧工具栏最后一个重连按钮以生</span><br><span class="line">效新主机名。</span><br><span class="line">[root@localhost ~]# hostnamectl set-hostname mall</span><br><span class="line">[root@mall ~]# hostnamectl</span><br><span class="line">Static hostname: mall</span><br><span class="line">Icon name: computer-vm</span><br><span class="line">Chassis: vm</span><br><span class="line">Machine ID: cc2c86fe566741e6a2ff6d399c5d5daa</span><br><span class="line">Boot ID: 51559d155ec14aafad2411ca8b85db42</span><br><span class="line">Virtualization: kvm</span><br><span class="line">Operating System: CentOS Linux 7 (Core)</span><br><span class="line">CPE OS Name: cpe:/o:centos:centos:7</span><br><span class="line">Kernel: Linux 3.10.0-1160.el7.x86_64</span><br><span class="line">Architecture: x86-64</span><br><span class="line">修改/etc/hosts 配置文件如下：</span><br><span class="line">[root@mall ~]# vi /etc/hosts</span><br><span class="line">127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1 localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">10.24.193.168 mall</span><br><span class="line">（2）配置本地 Yum 源</span><br><span class="line">将提供的 gpmall 包下载到服务器的/root 目录下并解压 gpmall.tar.gz，配置本地 local.repo</span><br><span class="line">文件，具体代码如下所示：</span><br><span class="line">[root@mall ~]# curl -O http://mirrors.douxuedu.com/competition/gpmall.tar.gz</span><br><span class="line">[root@mall ~]# tar -zxvf gpmall.tar.gz</span><br><span class="line">[root@mall ~]# mv /etc/yum.repos.d/* /media/</span><br><span class="line">[root@mall ~]# cd gpmall/</span><br><span class="line">[root@mall gpmall]# tar -zxvf gpmall-repo.tar.gz -C /root/</span><br><span class="line">[root@mall ~]# vi /etc/yum.repos.d/local.repo</span><br><span class="line">[mall]</span><br><span class="line">name=mall</span><br><span class="line">baseurl=file:///root/gpmall-repo</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">（3）安装基础服务</span><br><span class="line">安装基础服务，包括 Java JDK 环境、数据库、Redis、Nginx 等，安装基础服务的命令具体</span><br><span class="line">如下。</span><br><span class="line">① 安装 Java 环境</span><br><span class="line">[root@mall ~]# yum install -y java-1.8.0-openjdk java-1.8.0-openjdk-devel</span><br><span class="line">...</span><br><span class="line">[root@mall ~]# java -version</span><br><span class="line">openjdk version &quot;1.8.0_322&quot;</span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_322-b06)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.322-b06, mixed mode)</span><br><span class="line">② 安装 Redis 缓存服务</span><br><span class="line">[root@mall ~]# yum install redis -y</span><br><span class="line">③ 安装 Nginx 服务</span><br><span class="line">[root@mall ~]# yum install nginx -y</span><br><span class="line">④ 安装 MariaDB 数据库</span><br><span class="line">[root@mall ~]# yum install mariadb mariadb-server -y</span><br><span class="line">安装 ZooKeeper 服务，将提供的 zookeeper-3.4.14.tar.gz 解压，命令如下：</span><br><span class="line">[root@mall gpmall]# tar -zxvf zookeeper-3.4.14.tar.gz -C /root/</span><br><span class="line">进入到 zookeeper-3.4.14/conf 目录下，将 zoo_sample.cfg 文件重命名为 zoo.cfg，命令如</span><br><span class="line">下：</span><br><span class="line">[root@mall gpmall]# cd /root/zookeeper-3.4.14/conf/</span><br><span class="line">[root@mall conf]# mv zoo_sample.cfg zoo.cfg</span><br><span class="line">进入到 zookeeper-3.4.14/bin 目录下，启动 ZooKeeper 服务，命令如下：</span><br><span class="line">[root@mall conf]# cd ../bin</span><br><span class="line">[root@mall bin]# ./zkServer.sh start</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /root/zookeeper-3.4.14/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line">查看 ZooKeeper 状态，命令如下：</span><br><span class="line">[root@mall bin]# ./zkServer.sh status</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /root/zookeeper-3.4.14/bin/../conf/zoo.cfg</span><br><span class="line">Mode: standalone</span><br><span class="line">安装 Kafka 服务，将提供的 kafka_2.11-1.1.1.tgz 解压至/root 目录下，命令如下：</span><br><span class="line">[root@mall bin]# tar -zxvf /root/gpmall/kafka_2.11-1.1.1.tgz -C /root</span><br><span class="line">进入到 kafka_2.11-1.1.1/bin 目录下，启动 Kafka 服务，命令如下：</span><br><span class="line">[root@mall bin]# cd /root/kafka_2.11-1.1.1/bin/</span><br><span class="line">[root@mall bin]# ./kafka-server-start.sh -daemon ../config/server.properties</span><br><span class="line">使用 jps 或者 netstat -ntpl 命令查看 Kafka 是否成功启动，命令如下：</span><br><span class="line">[root@mall bin]# jps</span><br><span class="line">6039 Kafka</span><br><span class="line">1722 QuorumPeerMain</span><br><span class="line">6126 Jps</span><br><span class="line">[root@mall bin]# netstat -ntpl</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program n</span><br><span class="line">ame</span><br><span class="line">tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1008/sshd</span><br><span class="line">tcp 0 0 127.0.0.1:25 0.0.0.0:* LISTEN 887/master</span><br><span class="line">tcp6 0 0 :::9092 :::* LISTEN 6039/java</span><br><span class="line">tcp6 0 0 :::46949 :::* LISTEN 6039/java</span><br><span class="line">tcp6 0 0 :::2181 :::* LISTEN 1722/java</span><br><span class="line">tcp6 0 0 :::48677 :::* LISTEN 1722/java</span><br><span class="line"></span><br><span class="line">tcp6 0 0 :::22 :::* LISTEN 1008/sshd</span><br><span class="line">tcp6 0 0 ::1:25 :::* LISTEN 887/mast</span><br><span class="line">运行结果查看到 Kafka 服务和 9092 端口，说明 Kafka 服务已启动。</span><br><span class="line">（4）启动服务</span><br><span class="line">① 启动数据库并配置</span><br><span class="line">修改数据库配置文件并启动 MariaDB 数据库，设置 root 用户密码为 123456，并创建 gpmall</span><br><span class="line">数据库，将提供的 gpmall.sql 导入。</span><br><span class="line">修改/etc/my.cnf 文件，添加字段如下所示：</span><br><span class="line">[root@mall bin]# cd</span><br><span class="line">[root@mall ~]# vi /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">...</span><br><span class="line">init_connect=&#x27;SET collation_connection = utf8_unicode_ci&#x27;</span><br><span class="line">init_connect=&#x27;SET NAMES utf8&#x27;</span><br><span class="line">character-set-server=utf8</span><br><span class="line">collation-server=utf8_unicode_ci</span><br><span class="line">skip-character-set-client-handshake</span><br><span class="line">启动数据库命令如下。</span><br><span class="line">[root@mall ~]# systemctl start mariadb</span><br><span class="line">设置 root 用户的密码为 123456 并登录。</span><br><span class="line">[root@mall ~]# mysqladmin -uroot password 123456</span><br><span class="line">[root@mall ~]# mysql -uroot -p123456</span><br><span class="line">Welcome to the MariaDB monitor. Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 3</span><br><span class="line">Server version: 5.5.68-MariaDB MariaDB Server</span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line">MariaDB [(none)]&gt;</span><br><span class="line">设置 root 用户的权限，命令如下：</span><br><span class="line">MariaDB [(none)]&gt; grant all privileges on *.* to root@localhost identified by &#x27;12345</span><br><span class="line">6&#x27; with grant option;</span><br><span class="line">Query OK, 0 rows affected (0.001 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; grant all privileges on *.* to root@&quot;%&quot; identified by &#x27;123456&#x27; with</span><br><span class="line">grant option;</span><br><span class="line">Query OK, 0 rows affected (0.001 sec)</span><br><span class="line">创建数据库 gpmall 并导入/root/gpmall/目录中的 gpmall.sql 文件。</span><br><span class="line">MariaDB [(none)]&gt; create database gpmall;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">MariaDB [(none)]&gt; use gpmall;</span><br><span class="line">MariaDB [gpmall]&gt; source /root/gpmall/gpmall.sql</span><br><span class="line">退出数据库并设置开机自启。</span><br><span class="line">MariaDB [gpmall]&gt; exit</span><br><span class="line">Bye</span><br><span class="line">[root@mall ~]# systemctl enable mariadb</span><br><span class="line">Created symlink from /etc/systemd/system/mysql.service to /usr/lib/systemd/system/ma</span><br><span class="line">riadb.service.</span><br><span class="line">Created symlink from /etc/systemd/system/mysqld.service to /usr/lib/systemd/system/m</span><br><span class="line">ariadb.service.</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/mariadb.service to</span><br><span class="line">/usr/lib/systemd/system/mariadb.service.</span><br><span class="line">② 启动 Redis 服务</span><br><span class="line">修改 Redis 配置文件，编辑/etc/redis.conf 文件。</span><br><span class="line">将 bind 127.0.0.1 这一行注释掉；将 protected-mode yes 改为 protected-mode no。</span><br><span class="line">启动 Redis 服务命令如下。</span><br><span class="line">[root@mall ~]# vi /etc/redis.conf</span><br><span class="line">...</span><br><span class="line">\#bind 127.0.0.1</span><br><span class="line">protected-mode no</span><br><span class="line">...</span><br><span class="line">[root@mall ~]# systemctl start redis</span><br><span class="line">[root@mall ~]# systemctl enable redis</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/redis.service to /u</span><br><span class="line">sr/lib/systemd/system/redis.service.</span><br><span class="line">③ 启动 Nginx 服务</span><br><span class="line">启动 Nginx 服务命令如下。</span><br><span class="line">[root@mall ~]# systemctl start nginx</span><br><span class="line">[root@mall ~]# systemctl enable nginx</span><br><span class="line"></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /u</span><br><span class="line">sr/lib/systemd/system/nginx.service.</span><br><span class="line">（5）应用系统部署</span><br><span class="line">使 用 提 供 gpmall-shopping-0.0.1-SNAPSHOT.jar 、 gpmall-user-0.0.1-SNAPSHOT.jar 、</span><br><span class="line">shopping-provider-0.0.1-SNAPSHOT.jar、user-provider-0.0.1-SNAPSHOT.jar 、dist 这 5 个</span><br><span class="line">包部署应用系统，其中 4 个 jar 包为后端服务包，dist 为前端包。（包在 gpmall 目录下）</span><br><span class="line">① 全局变量配置</span><br><span class="line">修改/etc/hosts 文件，修改项目全局配置文件如下（原有的 172.128.11.42 mall 映射删除）：</span><br><span class="line">[root@mall ~]# cat /etc/hosts</span><br><span class="line">127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1 localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">10.24.193.168 kafka.mall</span><br><span class="line">10.24.193.168 mysql.mall</span><br><span class="line">10.24.193.168 redis.mall</span><br><span class="line">10.24.193.168 zookeeper.mall</span><br><span class="line">② 部署前端</span><br><span class="line">清空默认项目路径下的文件，将 dist 目录下的文件，复制到 Nginx 默认项目路径（文件在</span><br><span class="line">gpmall 目录下）。</span><br><span class="line">[root@mall ~]# rm -rf /usr/share/nginx/html/*</span><br><span class="line">[root@mall ~]# cp -rvf gpmall/dist/* /usr/share/nginx/html/</span><br><span class="line">修改 Nginx 配置文件/etc/nginx/nginx.conf，添加映射如下所示：</span><br><span class="line">[root@mall ~]# vi /etc/nginx/nginx.conf</span><br><span class="line">...</span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">listen [::]:80;</span><br><span class="line">server_name _;</span><br><span class="line">root /usr/share/nginx/html;</span><br><span class="line">\# Load configuration files for the default server block.</span><br><span class="line">include /etc/nginx/default.d/*.conf;</span><br><span class="line">location / &#123;</span><br><span class="line">root /usr/share/nginx/html;</span><br><span class="line">index index.html index.htm;</span><br><span class="line">&#125;</span><br><span class="line">location /user &#123;</span><br><span class="line"></span><br><span class="line">proxy_pass http://127.0.0.1:8082;</span><br><span class="line">&#125;</span><br><span class="line">location /shopping &#123;</span><br><span class="line">proxy_pass http://127.0.0.1:8081;</span><br><span class="line">&#125;</span><br><span class="line">location /cashier &#123;</span><br><span class="line">proxy_pass http://127.0.0.1:8083;</span><br><span class="line">&#125;</span><br><span class="line">error_page 404 /404.html;</span><br><span class="line">...</span><br><span class="line">重启 Nginx 服务，命令如下：</span><br><span class="line">[root@mall ~]# systemctl restart nginx</span><br><span class="line">到此，前端部署完毕。</span><br><span class="line">③ 部署后端</span><br><span class="line">将 node-1 节点的/opt/apache-skywalking-apm-bin-es7 目录下的 agent 目录复制到 mall</span><br><span class="line">节点下(密码为 Abc@1234)：</span><br><span class="line">[root@mall ~]# scp -r 10.24.194.203:/opt/apache-skywalking-apm-bin-es7/agent /root</span><br><span class="line">修改 SkyWalking agent 配置文件：</span><br><span class="line">[root@mall ~]# vi agent/config/agent.config</span><br><span class="line">...</span><br><span class="line">agent.service_name=$&#123;SW_AGENT_NAME:my-application&#125;</span><br><span class="line">agent.sample_n_per_3_secs=$&#123;SW_AGENT_SAMPLE:1&#125;</span><br><span class="line">...</span><br><span class="line">collector.backend_service=$&#123;SW_AGENT_COLLECTOR_BACKEND_SERVICES:10.24.194.203:1180</span><br><span class="line">0&#125;</span><br><span class="line">...</span><br><span class="line">采样率修改：agent.sample_n_per_3_secs 配置说明：</span><br><span class="line">在访问量较少时，链路全量收集不会对系统带来太大负担，能够完整的观测到系统的运行状</span><br><span class="line">况。但是在访问量较大时，全量的链路收集，对链路收集的客户端（agent 探针）、服务端</span><br><span class="line">（SkyWalking OAP）、存储器（例如说 Elastcsearch）都会带来较大的性能开销，甚至会影</span><br><span class="line">响应用的正常运行。在访问量级较大的情况下，往往会选择抽样采样，只收集部分链路信息。</span><br><span class="line">SkyWalking Agent 在 agent/config/agent.config 配 置 文 件 中 ， 定 义 了</span><br><span class="line">agent.sample_n_per_3_secs 配置项，设置每 3 秒可收集的链路数据的数量。</span><br><span class="line">将 gpmall 软件包中提供的 4 个 jar 包，放置探针并启动，通过设置启动参数的方式检测系</span><br><span class="line">统，启动命令如下：</span><br><span class="line"></span><br><span class="line">[root@mall ~]# nohup java -javaagent:/root/agent/skywalking-agent.jar -jar gpmall/s</span><br><span class="line">hopping-provider-0.0.1-SNAPSHOT.jar &amp;</span><br><span class="line">[1] 20086</span><br><span class="line">[root@mall ~]# nohup: ignoring input and appending output to ‘nohup.out’</span><br><span class="line">[root@mall ~]# nohup java -javaagent:/root/agent/skywalking-agent.jar -jar gpmall/u</span><br><span class="line">ser-provider-0.0.1-SNAPSHOT.jar &amp;</span><br><span class="line">[2] 20132</span><br><span class="line">[root@mall ~]# nohup: ignoring input and appending output to ‘nohup.out’</span><br><span class="line">[root@mall ~]# nohup java -javaagent:/root/agent/skywalking-agent.jar -jar gpmall/g</span><br><span class="line">pmall-shopping-0.0.1-SNAPSHOT.jar &amp;</span><br><span class="line">[3] 20177</span><br><span class="line">[root@mall ~]# nohup: ignoring input and appending output to ‘nohup.out’</span><br><span class="line">[root@mall ~]# nohup java -javaagent:/root/agent/skywalking-agent.jar -jar gpmall/g</span><br><span class="line">pmall-user-0.0.1-SNAPSHOT.jar &amp;</span><br><span class="line">[4] 20281</span><br><span class="line">[root@mall ~]# nohup: ignoring input and appending output to ‘nohup.out’</span><br><span class="line">\# httpd 访问网络配置</span><br><span class="line">[root@mall ~]# setsebool -P httpd_can_network_connect 1</span><br><span class="line">按照顺序运行 4 个 jar 包后，至此后端服务部署完毕。</span><br></pre></td></tr></table></figure>



<h4 id="【题目-11】Linux-内核优化-1-分"><a href="#【题目-11】Linux-内核优化-1-分" class="headerlink" title="【题目 11】Linux 内核优化[1 分]"></a>【题目 11】Linux 内核优化[1 分]</h4><p>在使用 Linux 服务器的时候，TCP 协议规定，对于已经建立的连接，网络双方要进行四次挥手才能成功断开连接，如果缺少了其中某个步骤，将会使连接处于假死状态，连接本身占用的资源不会被释放。因为服务器程序要同时管理大量连接，所以很有必要保证无用的连接完全断开，否则大量僵死的连接会浪费许多服务器资源。创建一台 CentOS7.9 云主机，修改相应的配置文件，分别开启 SYN Cookies；允许将 TIME-WAIT sockets 重新用于新的 TCP连接；开启 TCP 连接中 TIME-WAIT sockets 的快速回收；修改系統默认的 TIMEOUT 时间为 30。完成后提交修改节点的用户名、密码和 IP 地址到答题框。<br>1.检查内核优化正确计 1 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# cat /etc/sysctl.conf</span><br><span class="line">net.ipv4.tcp_syncookies = 1   #开启SYN Cookies</span><br><span class="line">net.ipv4.tcp_tw_reuse = 1     #开启重用。允许将TIME-WAIT sockets重新用于新的TCP连接</span><br><span class="line">net.ipv4.tcp_tw_recycle = 1   #开启TCP连接中TIME-WAIT sockets的快速回收</span><br><span class="line">net.ipv4.tcp_fin_timeout = 30 #修改系統默认的 TIMEOUT 时间为 30</span><br></pre></td></tr></table></figure>

<h4 id="【题目-12】排错：Glance-服务排错-1-分"><a href="#【题目-12】排错：Glance-服务排错-1-分" class="headerlink" title="【题目 12】排错：Glance 服务排错[1 分]"></a>【题目 12】排错：Glance 服务排错[1 分]</h4><p>使用赛项提供的 chinaskill-error1 镜像启动云主机，flavor 使用 4vcpu&#x2F;12G 内存&#x2F;100G 硬盘。启动后存在错误的私有云平台，错误现象为查看不到 image 列表，试根据错误信息排查云平台错误，使云平台可以查询到 image 信息。完成后提交云主机节点的用户名、密码和 IP地址到答题框。<br>1.检查错误镜像 glance 服务启动正确计 1 分</p>
<h4 id="【题目-13】排错：数据库排错-1-5-分"><a href="#【题目-13】排错：数据库排错-1-5-分" class="headerlink" title="【题目 13】排错：数据库排错[1.5 分]"></a>【题目 13】排错：数据库排错[1.5 分]</h4><p>使用赛项提供的排错镜像 chinaskill-error2 创建一台云主机（云主机的登录用户名为 root，密码为 000000），该云主机中存在错误的数据库服务，错误现象为数据库服务无法启动。请将数据库服务修复并启动，将数据库的密码修改为 chinaskill123。修复完成后提交该云主机的用户名、密码和 IP 地址到答题框。<br>1.检查错误镜像数据库服务启动正确计 1.5 分</p>
<h3 id="【任务-3】私有云运维开发-10-分"><a href="#【任务-3】私有云运维开发-10-分" class="headerlink" title="【任务 3】私有云运维开发[10 分]"></a>【任务 3】私有云运维开发[10 分]</h3><h4 id="【题目-1】Ansible-服务部署：部署-MariaDB-集群-2-分"><a href="#【题目-1】Ansible-服务部署：部署-MariaDB-集群-2-分" class="headerlink" title="【题目 1】Ansible 服务部署：部署 MariaDB 集群[2 分]"></a>【题目 1】Ansible 服务部署：部署 MariaDB 集群[2 分]</h4><p>使用 OpenStack 私有云平台，创建 4 台系统为 centos7.9 的云主机，其中一台作为 Ansible的母机并命名为 ansible，另外三台云主机命名为 node1、node2、node3；使用这一台母机，编写 Ansible 脚本（在&#x2F;root 目录下创建 example 目录作为 Ansible 工作目录，部署的入口文件 命 名 为 cscc_install.yaml ） ， 对 其 他 三 台 云 主 机 进 行 安 装 高 可 用 数 据 库 集 群（MariaDB_Galera_cluster，数据库密码设置为 123456）的操作（所需的安装包在 HTTP 服<br>务中）。完成后提交 Ansible 节点的用户名、密码和 IP 地址到答题框。（考试系统会连接到你的 Ansible 节点，去执行 Ansible 脚本，请准备好 Ansible 运行环境，以便考试系统访问）<br>1.执行 yaml 文件正确计 0.5 分<br>2.检查数据库集群部署正确计 1 分<br>3.检查数据库集群数量为 3 正确计 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@jumpserver mariadb-ansible]# cat /etc/ansible/hosts </span><br><span class="line">[node-1]</span><br><span class="line">node-1</span><br><span class="line">[node-2]</span><br><span class="line">node-2</span><br><span class="line">[node-3]</span><br><span class="line">node-3</span><br><span class="line">[node]</span><br><span class="line">node-1  node_name=node-1</span><br><span class="line">node-2  node_name=node-2</span><br><span class="line">node-3  node_name=node-3</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@jumpserver mariadb-ansible]# cat /etc/my.cnf.d/server.cnf </span><br><span class="line">[galera]</span><br><span class="line">wsrep_on=ON</span><br><span class="line">wsrep_provider=/usr/lib64/galera/libgalera_smm.so</span><br><span class="line">wsrep_cluster_address=&quot;gcomm://node-1,node-2,node-3&quot;</span><br><span class="line">binlog_format=row</span><br><span class="line">default_storage_engine=InnoDB</span><br><span class="line">innodb_autoinc_lock_mode=2</span><br><span class="line">bind-address=0.0.0.0</span><br><span class="line">wsrep_slave_threads=1</span><br><span class="line">innodb_flush_log_at_trx_commit=0</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@jumpserver mariadb-ansible]# cat local.repo </span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=http://172.19.25.11/centos</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[mariadb]</span><br><span class="line">name=mariadb</span><br><span class="line">baseurl=http://172.19.25.11/gpmall-repo</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@jumpserver mariadb-ansible]# cat cscc_install.yaml </span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">- hosts: node</span><br><span class="line">  tasks:</span><br><span class="line">  - name: copy hosts</span><br><span class="line">    copy:</span><br><span class="line">      src: /etc/hosts</span><br><span class="line">      dest: /etc/</span><br><span class="line">  - name: stop selinux </span><br><span class="line">    shell: setenforce 0</span><br><span class="line">  - name: rm repo</span><br><span class="line">    shell: rm -rf /etc/yum.repos.d/*</span><br><span class="line">  - name: copy repo</span><br><span class="line">    copy:</span><br><span class="line">      src: /root/mariadb-ansible/local.repo</span><br><span class="line">      dest: /etc/yum.repos.d/</span><br><span class="line">  - name: install mariadb</span><br><span class="line">    yum:</span><br><span class="line">      name: mariadb,mariadb-server</span><br><span class="line">  - name: start mariadb</span><br><span class="line">    service:</span><br><span class="line">      name: mariadb</span><br><span class="line">      state: started</span><br><span class="line">      enabled: true</span><br><span class="line">  - name: init_mysql</span><br><span class="line">    shell: mysqladmin -uroot password 123456</span><br><span class="line">  - name: stop mariadb</span><br><span class="line">    service:</span><br><span class="line">      name: mariadb</span><br><span class="line">      state: stopped</span><br><span class="line">  - name: copy server.cnf</span><br><span class="line">    copy:</span><br><span class="line">      src: /etc/my.cnf.d/server.cnf</span><br><span class="line">      dest: /etc/my.cnf.d/</span><br><span class="line"></span><br><span class="line">- hosts: node-1</span><br><span class="line">  tasks:</span><br><span class="line">  - name: start mariadb</span><br><span class="line">    shell: galera_new_cluster</span><br><span class="line">- hosts: node-2,node-3</span><br><span class="line">  tasks:</span><br><span class="line">  - name: start mariadb</span><br><span class="line">    service:</span><br><span class="line">      name: mariadb</span><br><span class="line">      state: started</span><br></pre></td></tr></table></figure>

<h4 id="【题目-2】Ansible-服务部署：部署-ELK-集群服务-2-分"><a href="#【题目-2】Ansible-服务部署：部署-ELK-集群服务-2-分" class="headerlink" title="【题目 2】Ansible 服务部署：部署 ELK 集群服务[2 分]"></a>【题目 2】Ansible 服务部署：部署 ELK 集群服务[2 分]</h4><p>使用赛项提供的 OpenStack 私有云平台，创建三台 CentOS7.9 系统的云主机分别命名为elk-1、elk-2 和 elk-3，Ansible 主机可以使用上一题的环境。要求 Ansible 节点编写剧本，执行 Ansible 剧本可以在这三个节点部署 ELK 集群服务（在&#x2F;root 目录下创建 install_elk 目录作为 ansible 工作目录，部署的入口文件命名为 install_elk.yaml）。具体要求为三个节点均安装Elasticserach 服务并配置为 Elasticserach 集群；kibana 安装在第一个节点；Logstash 安装在第二个节点。（需要用到的软件包在 HTTP 服务下）完成后提交 ansible 节点的用户名、密码和 IP 地址到答题框。（考试系统会连接到 ansible 节点，执行 ansible 脚本，准备好环境，<br>以便考试系统访问）<br>1.执行 yaml 文件正确计 0.5 分<br>2.检查 ELK 服务部署正确计 1.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@jumpserver elk-ansible]# cat roles/es/tasks/main.yml </span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"># tasks file for roles/es</span><br><span class="line"></span><br><span class="line">- name: 安装java环境</span><br><span class="line">  unarchive:</span><br><span class="line">    src: openjdk-11.0.1_linux-x64_bin.tar.gz</span><br><span class="line">    dest: /usr/local/</span><br><span class="line">- name: 添加环境变量</span><br><span class="line">  shell: echo &#x27;export JAVA_HOME=/usr/local/jdk-11.0.1&#x27; &gt;&gt; /etc/profile &amp;&amp; echo &#x27;export PATH=$PATH:/usr/local/jdk-11.0.1/bin&#x27; &gt;&gt; /etc/profile</span><br><span class="line">- name: 生效环境变量</span><br><span class="line">  shell: source /etc/profile</span><br><span class="line">- name: 创建es用户</span><br><span class="line">  user:</span><br><span class="line">    name: es</span><br><span class="line">- name: 传输本地包到目标并解压</span><br><span class="line">  unarchive:</span><br><span class="line">    src: elasticsearch-7.7.1-linux-x86_64.tar.gz</span><br><span class="line">    dest: /opt</span><br><span class="line">- name: mkdir data</span><br><span class="line">  shell: mkdir /opt/elasticsearch-7.7.1/data</span><br><span class="line">- name: 更改用户组</span><br><span class="line">  shell: chown -R es:es /opt/elasticsearch-7.7.1</span><br><span class="line">- name: 传输配置文件</span><br><span class="line">  template:</span><br><span class="line">    src: elasticsearch.j2</span><br><span class="line">    dest: /opt/elasticsearch-7.7.1/config/elasticsearch.yml</span><br><span class="line">    owner: es</span><br><span class="line">    group: es</span><br><span class="line">- name: 传输系统配置文件</span><br><span class="line">  copy: </span><br><span class="line">    src: limits.conf</span><br><span class="line">    dest: /etc/security/limits.conf</span><br><span class="line">- name: 传输系统配置文件</span><br><span class="line">  copy:</span><br><span class="line">    src: sysctl.conf</span><br><span class="line">    dest: /etc/sysctl.conf</span><br><span class="line">- name: 加载sysctl</span><br><span class="line">  shell: sysctl -p</span><br><span class="line">- name: 启动服务</span><br><span class="line">  become: yes</span><br><span class="line">  become_user: es</span><br><span class="line">  command: </span><br><span class="line">    argv:</span><br><span class="line">      - nohup</span><br><span class="line">      - /opt/elasticsearch-7.7.1/bin/elasticsearch</span><br><span class="line">      - -d</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@jumpserver elk-ansible]# cat roles/es/templates/elasticsearch.j2 </span><br><span class="line">cluster.name: elk-cluster</span><br><span class="line">node.name: &#123;&#123;node_name&#125;&#125;</span><br><span class="line">#node.attr.rack: r1</span><br><span class="line">path.data: /opt/elasticsearch-7.7.1/data</span><br><span class="line">path.logs: /opt/elasticsearch-7.7.1/logs</span><br><span class="line">#bootstrap.memory_lock: true</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">discovery.seed_hosts: [&quot;192.168.20.181&quot;, &quot;192.168.20.167&quot;, &quot;192.168.20.188&quot;]</span><br><span class="line">cluster.initial_master_nodes: [&quot;node-1&quot;]</span><br><span class="line">#gateway.recover_after_nodes: 3</span><br><span class="line">#action.destructive_requires_name: true</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@jumpserver elk-ansible]# cat roles/es/files/limits.conf </span><br><span class="line"></span><br><span class="line">*	soft	 nofile	     65535</span><br><span class="line">*	hard	 nofile	     65535</span><br><span class="line">*	soft	 nproc	     4096</span><br><span class="line">*	hard	 nproc	     4096</span><br><span class="line">[root@jumpserver elk-ansible]# cat roles/es/files/sysctl.conf </span><br><span class="line">vm.max_map_count=655360</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@jumpserver elk-ansible]# cat roles/kibana/tasks/main.yml </span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"># tasks file for roles/kibana</span><br><span class="line"></span><br><span class="line">- name: 传输本地文件到目标</span><br><span class="line">  unarchive:</span><br><span class="line">    src: kibana-7.7.1-linux-x86_64.tar.gz</span><br><span class="line">    dest: /opt/</span><br><span class="line">    owner: es</span><br><span class="line">    group: es</span><br><span class="line">- name: 创建日志与pid目录</span><br><span class="line">  shell: mkdir -p /var/log/kibana /run/kibana</span><br><span class="line">- name: 更改用户组</span><br><span class="line">  shell: chown -R es:es /var/log/kibana /run/kibana</span><br><span class="line">- name: 传输配置文件</span><br><span class="line">  copy:</span><br><span class="line">    src: kibana.yml</span><br><span class="line">    dest: /opt/kibana-7.7.1-linux-x86_64/config/kibana.yml</span><br><span class="line">- name: chown</span><br><span class="line">  shell: chown -R es:es /opt/kibana-7.7.1-linux-x86_64/config/kibana.yml</span><br><span class="line">- name: 启动服务</span><br><span class="line">  become: yes</span><br><span class="line">  become_user: es</span><br><span class="line">  shell: nohup /opt/kibana-7.7.1-linux-x86_64/bin/kibana &amp;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@jumpserver elk-ansible]# cat roles/kibana/files/kibana.yml </span><br><span class="line">server.port: 5601</span><br><span class="line">server.host: &quot;0.0.0.0&quot;</span><br><span class="line">elasticsearch.hosts: [&quot;http://192.168.20.181:9200&quot;,&quot;http://192.168.20.167:9200&quot;,&quot;http://192.168.20.188:9200&quot;]</span><br><span class="line">i18n.locale: &quot;zh-CN&quot;</span><br><span class="line">pid.file: /run/kibana/kibana.pid</span><br><span class="line">logging.dest: /var/log/kibana/kibana.log</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@jumpserver elk-ansible]# cat roles/log/tasks/main.yml </span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"># tasks file for roles/log</span><br><span class="line"></span><br><span class="line">- name: 创建日志目录</span><br><span class="line">  shell: mkdir /var/log/logstash</span><br><span class="line">- name: 更改权限</span><br><span class="line">  shell: chown -R es:es /var/log/logstash</span><br><span class="line">- name: 传输本地文件到目标</span><br><span class="line">  unarchive:</span><br><span class="line">    src: logstash-7.7.1.tar.gz</span><br><span class="line">    dest: /opt</span><br><span class="line">    owner: es</span><br><span class="line">    group: es</span><br><span class="line">- name: 传输配置文件</span><br><span class="line">  template:</span><br><span class="line">    src: logstash.yml</span><br><span class="line">    dest: /opt/logstash-7.7.1/config/logstash.yml</span><br><span class="line">- name: 传输管道配置文件</span><br><span class="line">  template:</span><br><span class="line">    src: logstash.conf</span><br><span class="line">    dest: /opt/logstash-7.7.1/config/logstash-sample.conf</span><br><span class="line">- name: 更改权限</span><br><span class="line">  shell: chown -R es:es /opt/logstash-7.7.1 </span><br><span class="line">- name: 启动服务</span><br><span class="line">  become: yes</span><br><span class="line">  become_user: es</span><br><span class="line">  shell: source /etc/profile &amp;&amp; sh /opt/logstash-7.7.1/bin/logstash -f /opt/logstash-7.7.1/config/logstash-sample.conf &amp;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@jumpserver elk-ansible]# cat roles/log/templates/logstash.yml </span><br><span class="line">http.host: &quot;0.0.0.0&quot;</span><br><span class="line">path.logs: /var/log/logstash/</span><br><span class="line">[root@jumpserver elk-ansible]# cat roles/log/templates/logstash.conf </span><br><span class="line">input &#123;</span><br><span class="line">  file &#123;</span><br><span class="line">    path =&gt; &quot;/var/log/yum.log&quot;</span><br><span class="line">    type =&gt; &quot;yum_log&quot;</span><br><span class="line">    start_position =&gt; &quot;beginning&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#标准输出到elasticsearch中</span><br><span class="line">output &#123;</span><br><span class="line">  elasticsearch &#123;</span><br><span class="line">    hosts =&gt;  [&quot;192.168.20.181:9200&quot;,&quot;192.168.20.167:9200&quot;,&quot;192.168.20.188:9200&quot;] </span><br><span class="line">    index =&gt; &quot;%&#123;[@metadata][beat]&#125;-%&#123;[@metadata][version]&#125;-%&#123;+YYYY.MM.dd&#125;&quot;</span><br><span class="line">    #user =&gt; &quot;elastic&quot;</span><br><span class="line">    #password =&gt; &quot;changeme&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="【题目-3】Python-运维开发：基于-OpenStack-Restful-API-实现镜像上传-1-分"><a href="#【题目-3】Python-运维开发：基于-OpenStack-Restful-API-实现镜像上传-1-分" class="headerlink" title="【题目 3】Python 运维开发：基于 OpenStack Restful API 实现镜像上传[1 分]"></a>【题目 3】Python 运维开发：基于 OpenStack Restful API 实现镜像上传[1 分]</h4><p>使用 OpenStack all-in-one 镜像，创建 OpenStack Python 运维开发环境。云主机的用户&#x2F;密码为：“root&#x2F;Abc@1234”，OpenStack 的域名&#x2F;账号&#x2F;密码为：“demo&#x2F;admin&#x2F;000000”。提示说明：python 脚本文件头建议加入“#encoding:utf-8”避免编码错误；测试脚本代码用 python3 命令执行与测试。在 controller 节点的&#x2F;root 目录下创建 api_image_manager.py 脚本，编写 python 代码对接OpenStack API，完成镜像的创建与上传。创建之前查询是否存在“同名镜像”，如果存在先删除该镜像。<br>（1）创建镜像：要求在 OpenStack 私有云平台中上传镜像 cirros-0.3.4-x86_64-disk.img，名字为 cirros001，disk_format 为 qcow2，container_format 为 bare。<br>（2）查询镜像：查询 cirros001 的详细信息，并以 json 格式文本输出到控制台。完成后提交 OpenStack Python 运维开发环境 Controller 节点的 IP 地址，用户名和密码提交。<br>1.执行 api_image_manager.py 脚本,成功创建镜像，计 0.5 分<br>2.检查镜像状态正确，计 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# cat api_image_manager.py </span><br><span class="line">#coding=utf-8</span><br><span class="line">import json</span><br><span class="line">import requests</span><br><span class="line">url = &quot;http://192.168.10.10&quot;</span><br><span class="line">body = &#123;</span><br><span class="line">    &quot;auth&quot;: &#123;</span><br><span class="line">        &quot;identity&quot;: &#123;</span><br><span class="line">            &quot;methods&quot;: [&quot;password&quot;],</span><br><span class="line">            &quot;password&quot;: &#123;</span><br><span class="line">                &quot;user&quot;: &#123;</span><br><span class="line">                    &quot;domain&quot;: &#123;</span><br><span class="line">                        &quot;name&quot;: &quot;demo&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &quot;name&quot;: &quot;admin&quot;,</span><br><span class="line">                    &quot;password&quot;: &quot;000000&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &quot;scope&quot;: &#123;</span><br><span class="line">        &quot;project&quot;: &#123;</span><br><span class="line">            &quot;domain&quot;: &#123;</span><br><span class="line">                &quot;name&quot;: &quot;demo&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;name&quot;: &quot;admin&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">headers = &#123;</span><br><span class="line">    &quot;Content-Type&quot;: &quot;application/json&quot;</span><br><span class="line">&#125;</span><br><span class="line">def get_token():</span><br><span class="line">    tokenurl = url+&quot;:5000/v3/auth/tokens&quot;</span><br><span class="line">    re = requests.post(url=tokenurl, headers=headers,data=json.dumps(body)).headers[&quot;X-Subject-Token&quot;]</span><br><span class="line">    return re</span><br><span class="line"></span><br><span class="line">def delete_image():</span><br><span class="line">   glanceurl = url+&quot;:9292/v2/images&quot;</span><br><span class="line">   headers[&quot;X-Auth-Token&quot;]=get_token()</span><br><span class="line">   re = requests.get(url=glanceurl,headers=headers).json()</span><br><span class="line">   for i in re[&#x27;images&#x27;]:</span><br><span class="line">       if i[&#x27;name&#x27;] == &quot;cirros001&quot;:</span><br><span class="line">           requests.delete(&quot;http://192.168.10.10:9292/v2/images/&quot;+i[&#x27;id&#x27;],headers=headers)</span><br><span class="line"></span><br><span class="line">def create_image():</span><br><span class="line">    glanceurl = url + &quot;:9292/v2/images&quot;</span><br><span class="line">    headers[&quot;X-Auth-Token&quot;] = get_token()</span><br><span class="line">    body1 = &#123;</span><br><span class="line">        &quot;name&quot;: &quot;cirros001&quot;,</span><br><span class="line">        &quot;disk_format&quot;: &quot;qcow2&quot;,</span><br><span class="line">        &quot;container_format&quot;: &quot;bare&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    re = requests.post(url=glanceurl,headers=headers,data=json.dumps(body1)).json()</span><br><span class="line">    id=re[&#x27;id&#x27;]</span><br><span class="line">    return id</span><br><span class="line"></span><br><span class="line">def put_image():</span><br><span class="line">    glanceurl = url + &quot;:9292/v2/images&quot;</span><br><span class="line">    id = create_image()</span><br><span class="line">    headers[&quot;Content-Type&quot;] = &quot;application/octet-stream&quot;</span><br><span class="line">    a = open(&quot;cirros-0.3.4-x86_64-disk.img&quot;,&quot;rb&quot;).read()</span><br><span class="line">    requests.put(&quot;http://192.168.10.10:9292/v2/images/&#123;&#125;/file&quot;.format(id),data=a,headers=headers)</span><br><span class="line">    return id</span><br><span class="line"></span><br><span class="line">def show_image():</span><br><span class="line">    glanceurl=url+&quot;:9292/v2/images&quot;</span><br><span class="line">    headers[&quot;X-Auth-Token&quot;]=get_token()</span><br><span class="line">    id = put_image()</span><br><span class="line">    re = requests.get(url=glanceurl,headers=headers).json()</span><br><span class="line">    for i in re[&#x27;images&#x27;]:</span><br><span class="line">        if i[&#x27;id&#x27;] == id:</span><br><span class="line">            print(i)</span><br><span class="line"></span><br><span class="line">delete_image()</span><br><span class="line">show_image()</span><br></pre></td></tr></table></figure>

<h4 id="【题目-4】Python-运维开发：基于-Openstack-Python-SDK-实现云主机创建-1-分"><a href="#【题目-4】Python-运维开发：基于-Openstack-Python-SDK-实现云主机创建-1-分" class="headerlink" title="【题目 4】Python 运维开发：基于 Openstack Python SDK 实现云主机创建[1 分]"></a>【题目 4】Python 运维开发：基于 Openstack Python SDK 实现云主机创建[1 分]</h4><p>使 用 已 建 好 的 OpenStack Python 运 维 开 发 环 境 ， 在 &#x2F;root 目 录 下 创 建sdk_server_manager.py 脚本，使用 python-openstacksdk Python 模块，完成云主机的创建和查询。创建之前查询是否存在“同名云主机”，如果存在先删除该镜像。<br>（1）创建 1 台云主机：云主机信息如下：云主机名称如下：server001镜像文件：cirros-0.3.4-x86_64-disk.img<br>云主机类型：m1.tiny网络等必要信</p>
<p>息自己补充。<br>（2）查询云主机：查询云主机 server001 的详细信息，并以 json 格式文本输出到控制台。完成后提交 OpenStack Python 运维开发环境 Controller 节点的 IP 地址，用户名和密码提交。</p>
<p>1.执行 sdk_server_manager.py 脚本,成功创建云主机，计 0.5 分<br>2.检查创建的云主机状态正确，计 0.5 分</p>
<p>sdk_server_manager.py：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">import json</span><br><span class="line">import logging</span><br><span class="line">import openstack</span><br><span class="line"></span><br><span class="line">def create_connection():</span><br><span class="line">  connect=openstack.connect(</span><br><span class="line">    auth_url=&quot;http://192.168.20.146:5000/v3&quot;,</span><br><span class="line">    user_domain_name=&quot;demo&quot;,</span><br><span class="line">    username=&quot;admin&quot;,</span><br><span class="line">    password=&quot;000000&quot;,</span><br><span class="line">  )</span><br><span class="line">  return connect</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def delete_server():</span><br><span class="line">  connect = create_connection()</span><br><span class="line">  items = connect.compute.servers()</span><br><span class="line">  for i in items:</span><br><span class="line">      if i[&#x27;name&#x27;] == &quot;server001&quot;:</span><br><span class="line">         server = connect.compute.find_server(&quot;server001&quot;)</span><br><span class="line">         connect.compute.delete_server(server)</span><br><span class="line"></span><br><span class="line">def create_server():</span><br><span class="line">  connect = create_connection()</span><br><span class="line">  image = connect.compute.find_image(&quot;cirros&quot;)</span><br><span class="line">  flavor = connect.compute.find_flavor(&quot;m1.small&quot;)</span><br><span class="line">  network = connect.network.find_network(&quot;int-net&quot;)</span><br><span class="line">  server = connect.compute.create_server(name=&quot;server001&quot;,image_id=image.id,flavor_id=flavor.id,networks=[&#123;&quot;uuid&quot;: network.id&#125;])</span><br><span class="line">  id = server[&#x27;id&#x27;]</span><br><span class="line">  return id</span><br><span class="line">  </span><br><span class="line">def get_server():</span><br><span class="line">  connect = create_connection()</span><br><span class="line">  server_id = create_server()</span><br><span class="line">  server = connect.compute.find_server(server_id)</span><br><span class="line">  a = json.dumps(server,idnent=2)</span><br><span class="line">  print(a)</span><br><span class="line">  </span><br><span class="line">delete_server()</span><br><span class="line"></span><br><span class="line">get_server()</span><br></pre></td></tr></table></figure>

<h4 id="【题目-5】Python-运维开发：云主机类型管理的命令行工具开发-2-分"><a href="#【题目-5】Python-运维开发：云主机类型管理的命令行工具开发-2-分" class="headerlink" title="【题目 5】Python 运维开发：云主机类型管理的命令行工具开发[2 分]"></a>【题目 5】Python 运维开发：云主机类型管理的命令行工具开发[2 分]</h4><p>使用已建好的 OpenStack Python 运维开发环境，在&#x2F;root 目录下创建 flavor_manager.py脚本，完成云主机类型的管理，flavor_manager.py 程序支持命令行参数执行。提示说明：Python 标准库 argparse 模块，可以提供命令行参数的解析。要求如下：<br>（1）程序支持根据命令行参数，创建 1 个多云主机类型。返回 response。<br>位置参数“create”，表示创建；<br>参数“-n”支持指定 flavor 名称，数据类型为字符串类型；<br>参数“-m”支持指定内存大小，数据类型为 int，单位 M；<br>参数“-v”支持指定虚拟 cpu 个数，数据类型为 int；<br>参数“-d”支持磁盘大小，内存大小类型为 int，单位 G；<br>参数“-id”支持指定 ID，类型为字符串。<br>参考运行实例：</p>
<p>python3 flavor_manager.py create -n flavor_small -m 1024 -v 1 -d 10 -id 100000<br>（2）程序支持查询目前 admin 账号下所有的云主机类型。<br>位置参数“getall”，表示查询所有云主机类型；<br>查询结果，以 json 格式输出到控制台。<br>参考执行实例如下：<br>python3 flavor_manager.py getall<br>（3）支持查询给定具体名称的云主机类型查询。<br>位置参数“get”，表示查询 1 个云主机类型；<br>参数“-id”支持指定 ID 查询，类型为 string。<br>控制台以 json 格式输出创建结果。<br>参考执行实例如下：<br>python3 flavor_manager.py get -id 100000<br>（4）支持删除指定的 ID 云主机类型。<br>位置参数“delete”，表示删除一个云主机类型；<br>参数“-id”支持指定 ID 查询，返回 response，控制台输出 response。<br>参考执行实例如下：<br>python3 flavor_manager.py delete -id 100001<br>1.执行 flavor_manager.py 脚本，指定 create 和配置参数，成功创建 1 个云主机类型，计 0.5<br>分；<br>2.执行 flavor_manager.py 脚本，指定 getall 参数，成功查询所有云主机类型，计 0.5 分；<br>3.执行 flavor_manager.py 脚本，指定 get 和配置参数，成功查询具体名称的云主机类型，计<br>0.5 分；<br>4.执行 flavor_manager.py 脚本，指定 delete 和配置参数，成功删除指定 ID 云主机类型，计<br>0.5 分。</p>
<h4 id="【题目-6】Python-运维开发：用户管理的命令行工具开发-2-分"><a href="#【题目-6】Python-运维开发：用户管理的命令行工具开发-2-分" class="headerlink" title="【题目 6】Python 运维开发：用户管理的命令行工具开发[2 分]"></a>【题目 6】Python 运维开发：用户管理的命令行工具开发[2 分]</h4><p>使用已建好的 OpenStack Python 运维开发环境，在&#x2F;root 目录下创建 user_manager.py 脚本，完成用户管理功能开发，user_manager.py 程序支持命令行带参数执行。提示说明：Python 标准库 argparse 模块，可以提供命令行参数的解析。<br>（1）程序支持根据命令行参数，创建 1 个用户。<br>位置参数“create”，表示创建；</p>
<p>参数“-i 或–input”，格式为 json 格式文本用户数据。<br>查询结果，以 json 格式输出到控制台。<br>参考执行实例如下：<br>python3 user_manager.py create –input ‘{ “name”: “user01”, “password”: “000000”,<br>“description”: “description” } ‘<br>（2）支持查询给定具体名称的用户查询。<br>位置参数“get”，表示查询 1 个用户；<br>参数“-n 或 –name”支持指定名称查询，类型为 string。<br>参数“-o 或 output”支持查询该用户信息输出到文件，格式为 json 格式。<br>参考执行实例如下：<br>python3 user_manager.py get –name user01-o user.json<br>（3）程序支持查询目前 admin 账号下所有的用户。<br>位置参数“getall”，表示查询所有用户；<br>参数“-o 或–output”支持输出到文件，格式为 yaml 格式。<br>参考执行实例如下：<br>python3 user_manager.py getall -o openstack_all_user.yaml<br>（4）支持删除指定的名称的用户。<br>位置参数“delete”，表示删除一个用户；返回 response，通过控制台输出。<br>参数“-n 或–name”支持指定名称查询，类型为 string。<br>参考执行实例如下：<br>python3 user_manager.py delete -name user01<br>1.执行 user_manager.py 脚本，指定 create 和配置参数，成功创建 1 个用户，计 0.5 分；<br>2.执行 user_manager.py 脚本，指定 get 和配置参数，成功查询具体名称的用户，计 0.5 分；<br>3.执行 user_manager.py 脚本，指定 getall 和配置参数，成功查询 admin 账号下的所有用户，<br>计 0.5 分；<br>4.执行 user_manager.py 脚本，指定 delete 和配置参数，成功删除指定名称的用户，计 0.5 分。</p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/04/03/2022%E4%BA%91%E8%AE%A1%E7%AE%97%E5%9B%BD%E8%B5%9B%E5%AE%B9%E5%99%A8%E4%BA%91/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          2022云计算国赛容器云
        
      </div>
    </a>
  
  
    <a href="/2022/09/19/%E9%87%91%E7%A0%96%E5%9B%BD%E8%B5%9B%E6%A0%B7%E9%A2%98%E4%B8%89/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">金砖国赛样题三</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>






</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2023 Miss
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/preccrep/hexo-theme-jelly" target="_blank">Jelly</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




  </div>
</body>
</html>