<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>2022云计算国赛容器云 | Misswjy&#39;Blog</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="2022 年全国职业院校技能大赛高职组云计算赛项试卷">
<meta property="og:type" content="article">
<meta property="og:title" content="2022云计算国赛容器云">
<meta property="og:url" content="http://example.com/2023/04/03/2022%E4%BA%91%E8%AE%A1%E7%AE%97%E5%9B%BD%E8%B5%9B%E5%AE%B9%E5%99%A8%E4%BA%91/index.html">
<meta property="og:site_name" content="Misswjy&#39;Blog">
<meta property="og:description" content="2022 年全国职业院校技能大赛高职组云计算赛项试卷">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-04-03T07:26:33.000Z">
<meta property="article:modified_time" content="2023-04-22T13:43:38.089Z">
<meta property="article:author" content="Miss">
<meta property="article:tag" content="容器云">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="Misswjy&#39;Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
<meta name="generator" content="Hexo 6.1.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
				<img lazy-src="/img/avatar.png" class="js-avatar">
			
		</a>

		<hgroup>
			<h1 class="header-author"><a href="/">Miss</a></h1>
		</hgroup>

		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">Home</a></li>
				        
							<li><a href="/archives">Archives</a></li>
				        
						</ul>
					</nav>
					<nav class="half-header-menu">
						<a class="hide">Home</a>
						<a>Tags</a>
						<a>Links</a>
						<a>About</a>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/Misswjy" title="github">github</a>
					        
								<a class="mail" target="_blank" href="/dockery@foxmail.com" title="mail">mail</a>
					        
								<a class="bilibili" target="_blank" href="https://space.bilibili.com/292671654" title="bilibili">bilibili</a>
					        
						</div>
						<!-- music -->
						
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/k8s/" style="font-size: 15px;">k8s</a> <a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 12.5px;">云计算</a> <a href="/tags/%E5%AE%B9%E5%99%A8%E4%BA%91/" style="font-size: 17.5px;">容器云</a> <a href="/tags/%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2%E5%92%8C%E8%BF%90%E7%BB%B4/" style="font-size: 10px;">应用部署和运维</a> <a href="/tags/%E7%A7%81%E6%9C%89%E4%BA%91/" style="font-size: 20px;">私有云</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/">github</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">I&#39;m a developer.</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/avatar.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">Home</a></li>
		        
					<li><a href="/archives">Archives</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Misswjy" title="github">github</a>
			        
						<a class="mail" target="_blank" href="/dockery@foxmail.com" title="mail">mail</a>
			        
						<a class="bilibili" target="_blank" href="https://space.bilibili.com/292671654" title="bilibili">bilibili</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-2022云计算国赛容器云" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2023/04/03/2022%E4%BA%91%E8%AE%A1%E7%AE%97%E5%9B%BD%E8%B5%9B%E5%AE%B9%E5%99%A8%E4%BA%91/" class="article-date">
  	<time datetime="2023-04-03T07:26:33.000Z" itemprop="datePublished">2023-04-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      2022云计算国赛容器云
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%B9%E5%99%A8%E4%BA%91/" rel="tag">容器云</a></li></ul>
	</div>

        

        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="2022-年全国职业院校技能大赛高职组云计算赛项试卷"><a href="#2022-年全国职业院校技能大赛高职组云计算赛项试卷" class="headerlink" title="2022 年全国职业院校技能大赛高职组云计算赛项试卷"></a>2022 年全国职业院校技能大赛高职组云计算赛项试卷<span id="more"></span></h1><h2 id="云计算赛项第二场-容器云"><a href="#云计算赛项第二场-容器云" class="headerlink" title="云计算赛项第二场-容器云"></a>云计算赛项第二场-容器云</h2><h3 id="【任务-1】容器云平台搭建-5-分"><a href="#【任务-1】容器云平台搭建-5-分" class="headerlink" title="【任务 1】容器云平台搭建[5 分]"></a>【任务 1】容器云平台搭建[5 分]</h3><p>【适用平台】私有云</p>
<h4 id="【题目-1】平台部署–部署容器云平台-1-5-分"><a href="#【题目-1】平台部署–部署容器云平台-1-5-分" class="headerlink" title="【题目 1】平台部署–部署容器云平台[1.5 分]"></a>【题目 1】平台部署–部署容器云平台[1.5 分]</h4><p>登录 OpenStack 私有云平台，使用 CentOS7.9 镜像创建两台云主机，使用 kubeeasy 工具完成 Kubernetes 1.22.1 集群的搭建。然后使用 nginx 镜像在 default 命名空间下创建一个名为exam 的 Pod，并为该 Pod 设置环境变量 exam，其值为 2022。完成后提交 master 节点的用户名、密码和 IP 到答题框。</p>
<p>1.Kubernetes 集群部署成功得 1 分；<br>2.Pod 创建成功且环境变量设置正确得 0.5 分。</p>
<h4 id="【题目-2】平台部署–部署-Istio-服务网格-0-5-分"><a href="#【题目-2】平台部署–部署-Istio-服务网格-0-5-分" class="headerlink" title="【题目 2】平台部署–部署 Istio 服务网格[0.5 分]"></a>【题目 2】平台部署–部署 Istio 服务网格[0.5 分]</h4><p>在 Kubernetes 集群上完成 Istio 服务网格环境的安装，然后新建命名空间 exam，为该命名空间开启自动注入 Sidecar。完成后提交 master 节点的用户名、密码和 IP 到答题框。<br>1.Istio 所有组件运行成功得 0.3 分；<br>2.命名空间 exam 自动注入成功得 0.2 分。</p>
<h4 id="【题目-3】平台部署–部署-KubeVirt-虚拟化-1-分"><a href="#【题目-3】平台部署–部署-KubeVirt-虚拟化-1-分" class="headerlink" title="【题目 3】平台部署–部署 KubeVirt 虚拟化[1 分]"></a>【题目 3】平台部署–部署 KubeVirt 虚拟化[1 分]</h4><p>在 Kubernetes 集群上完成 KubeVirt 虚拟化环境的安装。完成后提交 master 节点的用户名、密码和 IP 到答题框。<br>1.KubeVirt 所有组件运行成功得 1 分。</p>
<h4 id="【题目-4】平台部署–部署-Harbor-仓库及-Helm-包管理工具-1-分"><a href="#【题目-4】平台部署–部署-Harbor-仓库及-Helm-包管理工具-1-分" class="headerlink" title="【题目 4】平台部署–部署 Harbor 仓库及 Helm 包管理工具[1 分]"></a>【题目 4】平台部署–部署 Harbor 仓库及 Helm 包管理工具[1 分]</h4><p>在 master 节点上完成 Harbor 镜像仓库及 Helm 包管理工具的部署。然后使用 nginx 镜像自定义一个 Chart，Deployment 名称为 nginx，副本数为 1，然后将该 Chart 部署到 default命名空间下，Release 名称为 web。<br>完成后提交 master 节点的用户名、密码和 IP 到答题框。<br>1.Harbor 仓库部署成功得 0.5 分；<br>2.Helm 工具安装成功得 0.2 分；<br>3.Chart 包部署成功得 0.3 分。</p>
<h4 id="【题目-5】集群管理–备份-ETCD-数据-1-分"><a href="#【题目-5】集群管理–备份-ETCD-数据-1-分" class="headerlink" title="【题目 5】集群管理–备份 ETCD 数据[1 分]"></a>【题目 5】集群管理–备份 ETCD 数据[1 分]</h4><p>Kubernetes 使用 ETCD 来存储集群的实时运行数据，为防止服务器宕机导致 Kubernetes集群数据丢失，请将 Kubernetes 集群数据备份到&#x2F;root&#x2F;etcd.db 中。完成后提交 master 节点的 IP 地址、用户名和密码到答题框。<br>1.etcdctl 工具安装成功得 0.2 分；<br>2.ETCD 数据备份成功得 0.8 分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# ETCDCTL_API=3 /usr/local/bin/etcdctl --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key --endpoints=&quot;https://127.0.0.1:2379&quot; snapshot save /root/etcd.db</span><br><span class="line">&#123;&quot;level&quot;:&quot;info&quot;,&quot;ts&quot;:1681819860.8046362,&quot;caller&quot;:&quot;snapshot/v3_snapshot.go:68&quot;,&quot;msg&quot;:&quot;created temporary db file&quot;,&quot;path&quot;:&quot;/root/etcd.db.part&quot;&#125;</span><br><span class="line">&#123;&quot;level&quot;:&quot;info&quot;,&quot;ts&quot;:1681819860.8216271,&quot;logger&quot;:&quot;client&quot;,&quot;caller&quot;:&quot;v3/maintenance.go:211&quot;,&quot;msg&quot;:&quot;opened snapshot stream; downloading&quot;&#125;</span><br><span class="line">&#123;&quot;level&quot;:&quot;info&quot;,&quot;ts&quot;:1681819860.8217337,&quot;caller&quot;:&quot;snapshot/v3_snapshot.go:76&quot;,&quot;msg&quot;:&quot;fetching snapshot&quot;,&quot;endpoint&quot;:&quot;https://127.0.0.1:2379&quot;&#125;</span><br><span class="line">&#123;&quot;level&quot;:&quot;info&quot;,&quot;ts&quot;:1681819860.8757417,&quot;logger&quot;:&quot;client&quot;,&quot;caller&quot;:&quot;v3/maintenance.go:219&quot;,&quot;msg&quot;:&quot;completed snapshot read; closing&quot;&#125;</span><br><span class="line">&#123;&quot;level&quot;:&quot;info&quot;,&quot;ts&quot;:1681819861.1202412,&quot;caller&quot;:&quot;snapshot/v3_snapshot.go:91&quot;,&quot;msg&quot;:&quot;fetched snapshot&quot;,&quot;endpoint&quot;:&quot;https://127.0.0.1:2379&quot;,&quot;size&quot;:&quot;3.0 MB&quot;,&quot;took&quot;:&quot;now&quot;&#125;</span><br><span class="line">&#123;&quot;level&quot;:&quot;info&quot;,&quot;ts&quot;:1681819861.1204019,&quot;caller&quot;:&quot;snapshot/v3_snapshot.go:100&quot;,&quot;msg&quot;:&quot;saved&quot;,&quot;path&quot;:&quot;/root/etcd.db&quot;&#125;</span><br><span class="line">Snapshot saved at /root/etcd.db</span><br></pre></td></tr></table></figure>



<h3 id="【任务-2】容器云应用部署：Docker-Compose-编排部署-7-0-分"><a href="#【任务-2】容器云应用部署：Docker-Compose-编排部署-7-0-分" class="headerlink" title="【任务 2】容器云应用部署：Docker Compose 编排部署[7.0 分]"></a>【任务 2】容器云应用部署：Docker Compose 编排部署[7.0 分]</h3><p>【适用平台】私有云<br>Hyperf 是一个高性能、高灵活性的渐进式 PHP 协程框架，内置协程服务器及大量常用的组件，性能较传统基于 PHP-FPM 的框架有质的提升，提供超高性能的同时，也保持着极其灵活的可扩展性。请根据要求完成数据库服务 MariaDB、缓存服务 Redis、微服务 Hyperf及前端服务 Nginx 按照要求进行容器化。</p>
<h4 id="【题目-1】容器化-MariaDB-服务-1-分"><a href="#【题目-1】容器化-MariaDB-服务-1-分" class="headerlink" title="【题目 1】容器化 MariaDB 服务[1 分]"></a>【题目 1】容器化 MariaDB 服务[1 分]</h4><p>编写 Dockerfile 文件构建 hyperf-mariadb:v1.0 镜像，具体要求如下：（需要用到的软件包：<br>Hyperf.tar.gz）<br>（1）基础镜像：centos:7.9.2009；<br>（2）完成 MariaDB 服务的安装；<br>（3）声明端口：3306；<br>（4）设置数据库 root 用户的密码为 root；<br>（5）将提供的数据库文件 hyperf_admin.sql 导入数据库；<br>（6）设置服务开机自启。<br>完成后构建镜像，并提交 master 节点的用户名、密码和 IP 地址到答题框。<br>1.镜像构建成功得 0.5 分；<br>2.数据库安装且导入数据成功得 0.5 分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master Hyperf]# cat init.sh </span><br><span class="line">#!/bin/bash</span><br><span class="line">#echo &quot;[mysqld]\ncharacter-set-server=utf8&quot; &gt; /etc/my.cnf</span><br><span class="line">mysql_install_db --user=root</span><br><span class="line">mysqld_safe --user=root &amp;</span><br><span class="line">sleep 5</span><br><span class="line">mysqladmin -u root password &#x27;root&#x27;</span><br><span class="line">mysql -uroot -proot -e &quot;grant all privileges on *.* to root@&#x27;%&#x27; identified by &#x27;root&#x27;;&quot;</span><br><span class="line">mysql -uroot -proot -e &quot;source /opt/hyperf_admin.sql;&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@master Hyperf]# cat Dockerfile-mariadb </span><br><span class="line">FROM centos:7.9.2009</span><br><span class="line">MAINTAINER chinaskill</span><br><span class="line">RUN rm -rf /etc/yum.repos.d/*</span><br><span class="line">ADD yum /opt/yum</span><br><span class="line">COPY local.repo /etc/yum.repos.d/</span><br><span class="line">RUN  yum install -y mariadb-server mariadb</span><br><span class="line">COPY sql/hyperf_admin.sql /opt/</span><br><span class="line">COPY init.sh /root</span><br><span class="line">RUN sh /root/init.sh</span><br><span class="line">EXPOSE 3306</span><br><span class="line">CMD [&quot;mysqld_safe&quot;,&quot;--user=root&quot;]</span><br></pre></td></tr></table></figure>



<h4 id="【题目-2】容器化-Redis-服务-1-分"><a href="#【题目-2】容器化-Redis-服务-1-分" class="headerlink" title="【题目 2】容器化 Redis 服务[1 分]"></a>【题目 2】容器化 Redis 服务[1 分]</h4><p>编写 Dockerfile 文件构建 hyperf-redis:v1.0 镜像，具体要求如下：（需要用到的软件包：<br>Hyperf.tar.gz）<br>（1）基础镜像：centos:7.9.2009；<br>（2）安装 Redis 服务；<br>（3）关闭保护模式；<br>（4）声明端口：6379；<br>（5）设置服务开机自启。<br>完成后构建镜像，并提交 master 节点的用户名、密码和 IP 地址到答题框。<br>1.镜像构建成功的 0.5 分；<br>2.Redis 服务安装成功且配置正确得 0.5 分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@master Hyperf]# cat Dockerfile-redis </span><br><span class="line">FROM centos:7.9.2009</span><br><span class="line">MAINTAINER chinaskill</span><br><span class="line">RUN rm -rf /etc/yum.repos.d/*</span><br><span class="line">COPY local.repo /etc/yum.repos.d/</span><br><span class="line">ADD yum /opt/yum</span><br><span class="line">RUN yum install -y redis</span><br><span class="line">RUN sed -i &quot;s/bind 127.0.0.1/bind 0.0.0.0/g&quot; /etc/redis.conf</span><br><span class="line">RUN sed -i &quot;s/protected-mode yes/protected-mode no/g&quot; /etc/redis.conf</span><br><span class="line">EXPOSE 6379</span><br><span class="line">CMD [&quot;redis-server&quot;,&quot;/etc/redis.conf&quot;]</span><br></pre></td></tr></table></figure>

<h4 id="【题目-3】容器化-Nginx-服务-0-5-分"><a href="#【题目-3】容器化-Nginx-服务-0-5-分" class="headerlink" title="【题目 3】容器化 Nginx 服务[0.5 分]"></a>【题目 3】容器化 Nginx 服务[0.5 分]</h4><p>编写 Dockerfile 文件构建 hyperf-nginx:v1.0 镜像，具体要求如下：（需要用到的软件包：<br>Hyperf.tar.gz）<br>（1）基础镜像：centos:7.9.2009；<br>（2）安装 nginx 服务；<br>（3）声明端口：80；<br>（4）设置服务开机自启。<br>完成后构建镜像，并提交 master 节点的用户名、密码和 IP 地址到答题框。<br>1.镜像构建成功得 0.3 分；<br>2.Nginx 安装成功且配置正确得 0.2 分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@master Hyperf]# cat Dockerfile-nginx </span><br><span class="line">FROM centos:7.9.2009</span><br><span class="line">MAINTAINER chinaskill</span><br><span class="line">RUN rm -rf /etc/yum.repos.d/*</span><br><span class="line">COPY local.repo /etc/yum.repos.d/</span><br><span class="line">ADD yum /opt/yum</span><br><span class="line">RUN yum install -y nginx</span><br><span class="line">COPY project/frontend /var/www/frontend</span><br><span class="line">COPY project/docker/conf.d/hyperf-admin.conf /etc/nginx/conf.d/default.conf</span><br><span class="line">EXPOSE 80 443</span><br><span class="line">CMD [&quot;nginx&quot;,&quot;-g&quot;,&quot;daemon off;&quot;]</span><br></pre></td></tr></table></figure>



<h4 id="【题目-4】容器化-Hyperf-服务-1-分"><a href="#【题目-4】容器化-Hyperf-服务-1-分" class="headerlink" title="【题目 4】容器化 Hyperf 服务[1 分]"></a>【题目 4】容器化 Hyperf 服务[1 分]</h4><p>编写 Dockerfile 文件构建 hyperf-service:v1.0 镜像，具体要求如下：（需要用到的软件包：<br>Hyperf.tar.gz）<br>（1）基础镜像：centos:7.9.2009；<br>（2）安装 PHP 及扩展；</p>
<p>（3）使用源码编译安装 Swoole。<br>完成后构建镜像，并提交 master 节点的用户名、密码和 IP 地址到答题框。<br>1.镜像构建成功得 0.5 分；<br>2.PHP 安装成功得 0.2 分；<br>3.Swoole 安装成功得 0.3 分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@master Hyperf]# cat Dockerfile-hyperf </span><br><span class="line">FROM centos:7.9.2009</span><br><span class="line">MAINTAINER chinaskill</span><br><span class="line">RUN rm -rf /etc/yum.repos.d/*</span><br><span class="line">COPY local.repo /etc/yum.repos.d/</span><br><span class="line">ADD yum /opt/yum</span><br><span class="line">RUN ls /opt/</span><br><span class="line">COPY swoole-v4.8.3.zip /opt/</span><br><span class="line">ADD project/backend/ /opt</span><br><span class="line">RUN yum install -y php php-cli php-fpm php-devel php-gd php-mysqlnd </span><br><span class="line">RUN yum install -y unzip gcc make</span><br><span class="line">WORKDIR /opt</span><br><span class="line">RUN unzip /opt/swoole-v4.8.3.zip &amp;&amp; cd /opt/swoole-v4.8.3 &amp;&amp; phpize &amp;&amp; ./configure &amp;&amp; make &amp;&amp; make install</span><br><span class="line">RUN echo &quot;[swoole]&quot; &gt;&gt; /etc/php.ini &amp;&amp;  \</span><br><span class="line">    echo &quot;extension=swoole.so&quot; &gt;&gt; /etc/php.ini &amp;&amp;  \</span><br><span class="line">    echo &quot;swoole.use_shortname=&#x27;Off&#x27;&quot; &gt;&gt; /etc/php.ini</span><br><span class="line">EXPOSE 9511</span><br><span class="line">RUN chmod +x bin/hyperf.php</span><br><span class="line">CMD php --ri swoole &amp;&amp; tail -f /etc/shadow</span><br></pre></td></tr></table></figure>



<h4 id="【题目-5】编排部署-Hyperf-框架-3-5-分"><a href="#【题目-5】编排部署-Hyperf-框架-3-5-分" class="headerlink" title="【题目 5】编排部署 Hyperf 框架[3.5 分]"></a>【题目 5】编排部署 Hyperf 框架[3.5 分]</h4><p>编写&#x2F;root&#x2F;hyperf&#x2F;project&#x2F;docker-compose.yaml 文件，具体要求如下：<br>（1）容器 1 名称：hyperf-mysql；镜像：hyperf-mariadb:v1.0；端口映射：3306:3306；<br>（2）容器 2 名称：hyperf-redis；镜像：hyperf-redis:v1.0；<br>（3）容器 3 名称：hyperf-ui；镜像：hyperf-nginx:v1.0；端口映射：80:8081；<br>（4）容器 4 名称：hyperf-service；镜像：hyperf-service:v1.0。<br>完成后编排部署 Hyperf 框架，并提交 master 节点的用户名、密码和 IP 地址到答题框。<br>1.docker-compose.yaml 文件编排成功得 1.5 分；<br>2.8081 端口访问服务成功得 1 分；<br>3.Hyperf-service 连接数据库和 Redis 成功得 1 分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@master Hyperf]# cat docker-compose.yaml </span><br><span class="line">version: &#x27;3.1&#x27;</span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: hyperf-redis:v1.0</span><br><span class="line">    container_name: hyperf-redis</span><br><span class="line">  mysql:</span><br><span class="line">    container_name: mysql-test</span><br><span class="line">    image: hyperf-mariadb:v1.0</span><br><span class="line"></span><br><span class="line">    ports:</span><br><span class="line">      - 3306:3306</span><br><span class="line"></span><br><span class="line">  app:</span><br><span class="line">    container_name: hyperf-service</span><br><span class="line">    image: hyperf-hyperf:v1.0</span><br><span class="line">    depends_on:</span><br><span class="line">      - mysql</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;9511:9511&quot;</span><br><span class="line">    links:</span><br><span class="line">      - mysql:mysql</span><br><span class="line">    command:</span><br><span class="line">      - sh</span><br><span class="line">      - -c</span><br><span class="line">      - &quot;/opt/bin/hyperf.php start&quot;</span><br><span class="line"></span><br><span class="line">  nginx:</span><br><span class="line">    image: hyperf-nginx:v1.0</span><br><span class="line">    container_name: hyperf-ui</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - 8081:80</span><br><span class="line">    links:</span><br><span class="line">      - app</span><br><span class="line">      - mysql:mysql</span><br></pre></td></tr></table></figure>

<h3 id="【任务-3】容器云应用部署：基于-Kubernetes-构建-CICD-8-0-分"><a href="#【任务-3】容器云应用部署：基于-Kubernetes-构建-CICD-8-0-分" class="headerlink" title="【任务 3】容器云应用部署：基于 Kubernetes 构建 CICD[8.0 分]"></a>【任务 3】容器云应用部署：基于 Kubernetes 构建 CICD[8.0 分]</h3><p>该公司决定采用 Kubernetes + GitLab CI 来构建 CICD 环境，以缩短新功能开发上线周期，及时满足客户的需求，实现 DevOps 的部分流程，来减轻部署运维的负担，实现可视化容器生命周期管理、应用发布和版本迭代更新，请完成 GitLab CI + Kubernetes 的 CICD 环境部署（构建持续集成所需要的所有软件包在软件包 CICD-Runner.tar.gz 中）。CICD 应用系统架构如下：</p>
<h4 id="【题目-1】安装-GitLab-环境-1-分"><a href="#【题目-1】安装-GitLab-环境-1-分" class="headerlink" title="【题目 1】安装 GitLab 环境[1 分]"></a>【题目 1】安装 GitLab 环境[1 分]</h4><p>在 Kubernetes 集群中新建命名空间 gitlab-ci，将 GitLab 部署到该命名空间下，Deployment和 Service 名称均为 gitlab，以 NodePort 方式将 80 端口对外暴露为 30880，设置 GitLab 服务root 用户的密码为 admin@123，将项目包 demo-2048.tar.gz 导入到 GitLab 中并命名为demo-2048。完成后提交 master 节点的用户名、密码和 IP 地址到答题框。（需要用到的软件包路径CICD-Runner.tar.gz）<br>1.GitLab 部署正确且能正常访问得 0.5 分；<br>2.项目导入成功得 0.5 分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-node1 ~]# cat gitlab.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app: gitlab</span><br><span class="line">  name: gitlab</span><br><span class="line">  namespace: gitlab-ci</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: gitlab</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: gitlab</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - image: gitlab/gitlab-ce:12.9.2-ce.0</span><br><span class="line">        env:</span><br><span class="line">        - name: GITLAB_ROOT_PASSWORD</span><br><span class="line">          value: admin@123</span><br><span class="line">        name: gitlab</span><br><span class="line">        ports: </span><br><span class="line">        - containerPort: 443</span><br><span class="line">          name: gitlab443</span><br><span class="line">        - containerPort: 80</span><br><span class="line">          name: gitlab80</span><br><span class="line">        - containerPort: 22</span><br><span class="line">          name: gitlab22</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: gitlab-config</span><br><span class="line">          mountPath: /etc/gitlab</span><br><span class="line">        - name: gitlab-logs</span><br><span class="line">          mountPath: /var/log/gitlab</span><br><span class="line">        - name: gitlab-data</span><br><span class="line">          mountPath: /var/opt/gitlab</span><br><span class="line">      volumes:</span><br><span class="line">      - name: gitlab-config</span><br><span class="line">        nfs:</span><br><span class="line">          server: 192.168.20.147</span><br><span class="line">          path: /root/nfs-gitlab/config</span><br><span class="line">      - name: gitlab-logs</span><br><span class="line">        nfs:</span><br><span class="line">          server: 192.168.20.147</span><br><span class="line">          path: /root/nfs-gitlab/logs</span><br><span class="line">      - name: gitlab-data</span><br><span class="line">        nfs:</span><br><span class="line">          server: 192.168.20.147</span><br><span class="line">          path: /root/nfs-gitlab/data</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: gitlab</span><br><span class="line">  namespace: gitlab-ci</span><br><span class="line">spec:</span><br><span class="line">  type: NodePort</span><br><span class="line">  ports:</span><br><span class="line">  - port: 443</span><br><span class="line">    targetPort: 443</span><br><span class="line">    name: gitlab443</span><br><span class="line">  - port: 80</span><br><span class="line">    targetPort: 80</span><br><span class="line">    nodePort: 30888</span><br><span class="line">    name: gitlab80</span><br><span class="line">  - port: 22</span><br><span class="line">    targetPort: 22</span><br><span class="line">    name: gitlab22</span><br><span class="line">      selector:</span><br><span class="line">    app: gitlab</span><br></pre></td></tr></table></figure>



<h4 id="【题目-2】部署-GitLab-Runner-2-分"><a href="#【题目-2】部署-GitLab-Runner-2-分" class="headerlink" title="【题目 2】部署 GitLab Runner[2 分]"></a>【题目 2】部署 GitLab Runner[2 分]</h4><p>将 GitLab Runner 部署到 gitlab-ci 命名空间下，Release 名称为 gitlab-runner，为 GitLabRunner 创建持久化构建缓存目录&#x2F;home&#x2F;gitlab-runner&#x2F;ci-build-cache 以加速构建速度，并将其注册到 GitLab 中。完成后提交 master 节点的用户名、密码和 IP 地址到答题框。（需要用到的软件包路径CICD-Runner.tar.gz）<br>1.GitLab Runner 部署成功得 0.5 分；<br>2.GitLab Runner 注册成功得 0.5 分；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-node1 ~]# cat gitlab-runner.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app: gitlab-runner</span><br><span class="line">  name: gitlab-runner</span><br><span class="line">  namespace: gitlab-ci</span><br><span class="line">spec:</span><br><span class="line">  replicas: 2</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: gitlab-runner</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: gitlab-runner</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - image: gitlab/gitlab-runner:latest</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        name: gitlab-runner</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: gitlab-config</span><br><span class="line">          mountPath: /etc/gitlab-runner</span><br><span class="line">      volumes:</span><br><span class="line">      - name: gitlab-config</span><br><span class="line">        nfs:</span><br><span class="line">          server: 192.168.20.147</span><br><span class="line">          path: /root/nfs-gitlab/runner-config</span><br></pre></td></tr></table></figure>



<h4 id="【题目-3】配置-GitLab-1-5-分"><a href="#【题目-3】配置-GitLab-1-5-分" class="headerlink" title="【题目 3】配置 GitLab[1.5 分]"></a>【题目 3】配置 GitLab[1.5 分]</h4><p>将 Kubernetes 集群添加到 demo-2048 项目中，并命名为 kubernetes-agent，项目命名空间选择 gitlab-ci。完成后提交 master 节点的用户名、密码和 IP 地址到答题框。（需要用到的软件包路径CICD-Runner.tar.gz）<br>1.GitLab Agent 安装成功得 1 分；<br>2.Kubernetes 连接成功得 0.5 分。</p>
<h4 id="【题目-4】构建-CICD-3-5-分"><a href="#【题目-4】构建-CICD-3-5-分" class="headerlink" title="【题目 4】构建 CICD[3.5 分]"></a>【题目 4】构建 CICD[3.5 分]</h4><p>编写流水线脚本.gitlab-ci.yml 触发自动构建，具体要求如下：<br>（1）基于镜像 maven:3.6-jdk-8 构建项目的 drone 分支；<br>（2）构建镜像的名称：demo:latest；<br>（3）将镜像推送到 Harbor 仓库 demo 项目中；<br>（4）将 demo-2048 应用自动发布到 Kubernetes 集群 gitlab-ci 命名空间下。<br>完成后提交 master 节点的用户名、密码和 IP 地址到答题框。（需要用到的软件包路径CICD-Runner.tar.gz）<br>1.项目变异成功得 0.5 分；<br>2.镜像构建成功得 1 分；<br>3.服务发布成功得 1 分；<br>4.服务能正常访问得 1 分。</p>
<h3 id="【任务-4】容器云服务运维：Kubernetes-基于容器的运维-6-分"><a href="#【任务-4】容器云服务运维：Kubernetes-基于容器的运维-6-分" class="headerlink" title="【任务 4】容器云服务运维：Kubernetes 基于容器的运维[6 分]"></a>【任务 4】容器云服务运维：Kubernetes 基于容器的运维[6 分]</h3><p>【适用平台】私有云</p>
<h4 id="【题目-1】Pod-管理–创建-Pod-0-5-分"><a href="#【题目-1】Pod-管理–创建-Pod-0-5-分" class="headerlink" title="【题目 1】Pod 管理–创建 Pod[0.5 分]"></a>【题目 1】Pod 管理–创建 Pod[0.5 分]</h4><p>在 default 命名空间下使用 nginx:latest 镜像创建一个 QoS 类为 Guaranteed 的 Pod，名称为 qos-demo。<br>完成后提交 master 节点的 IP 地址、用户名和密码到答题框。<br>1.Pod 创建成功得 0.2 分；<br>2.Pod QoS 类型为 Guaranteed 得 0.3 分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-node1 ~]# cat nginx.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    run: qos-demo</span><br><span class="line">  name: qos-demo</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - image: nginx:latest</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    name: qos-demo</span><br><span class="line">    resources: </span><br><span class="line">      requests:</span><br><span class="line">        memory: 200Mi</span><br><span class="line">        cpu: 700m</span><br><span class="line">      limits:</span><br><span class="line">        memory: 200Mi</span><br><span class="line">        cpu: 700m</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-node1 ~]# kubectl get pods qos-demo --output=yaml | grep qosClass</span><br><span class="line">  qosClass: Guaranteed</span><br></pre></td></tr></table></figure>

<blockquote>
<p><em>对于 QoS 类为 <code>Guaranteed</code> 的 Pod：</em></p>
<ul>
<li><em>Pod 中的每个容器都必须指定内存限制和内存请求。</em></li>
<li><em>对于 Pod 中的每个容器，内存限制必须等于内存请求。</em></li>
<li><em>Pod 中的每个容器都必须指定 CPU 限制和 CPU 请求。</em></li>
<li><em>对于 Pod 中的每个容器，CPU 限制必须等于 CPU 请求。</em></li>
</ul>
<p><em>如果满足下面条件，Kubernetes 将会指定 Pod 的 QoS 类为 <code>Burstable</code>：</em></p>
<ul>
<li><em>Pod 不符合 <code>Guaranteed</code> QoS 类的标准。</em></li>
<li><em>Pod 中至少一个 Container 具有内存或 CPU 的请求或限制。</em></li>
</ul>
<p><em>对于 QoS 类为 <code>BestEffort</code> 的 Pod，Pod 中的 Container 必须没有设置内存和 CPU 限制或请求。</em></p>
</blockquote>
<h4 id="【题目-2】安全管理–配置-Pod-安全上下文-0-5-分"><a href="#【题目-2】安全管理–配置-Pod-安全上下文-0-5-分" class="headerlink" title="【题目 2】安全管理–配置 Pod 安全上下文[0.5 分]"></a>【题目 2】安全管理–配置 Pod 安全上下文[0.5 分]</h4><p>使用 busybox 镜像启动一个名为 context-demo 的 Pod，为该 Pod 配置安全上下文，要求容器内以用户 1000 和用户组 3000 来运行所有进程，并在启动时执行“sleep 1h”命令。完成后提交 master 节点的 IP 地址、用户名和密码到答题框。<br>1.Pod 安全上下午配置正确得 0.5 分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-node1 ~]# cat context.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    run: context-demo</span><br><span class="line">  name: context-demo</span><br><span class="line">spec:</span><br><span class="line">  securityContext:</span><br><span class="line">    runAsUser: 1000</span><br><span class="line">    runAsGroup: 3000</span><br><span class="line">  containers:</span><br><span class="line">  - image: busybox:latest</span><br><span class="line">    name: context-demo</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    command: [&quot;sh&quot;,&quot;-c&quot;,&quot;sleep 1h&quot;]</span><br></pre></td></tr></table></figure>

<h4 id="【题目-3】CRD-管理–创建自定义资源类型-0-5-分"><a href="#【题目-3】CRD-管理–创建自定义资源类型-0-5-分" class="headerlink" title="【题目 3】CRD 管理–创建自定义资源类型[0.5 分]"></a>【题目 3】CRD 管理–创建自定义资源类型[0.5 分]</h4><p>在 Kubernetes 集群中自定义一种资源类型 Student，API 为 stable.example.com&#x2F;v1，单数形式为 student，复数形式为 students，简写为 stu，作用域为命名空间级，然后在 default 命名空间下创建一个名为 exam 的Student 对象。完成后提交 master 节点的 IP 地址、用户名和密码到答题框。<br>1.资源类型 Student 定义成功的 0.3 分；<br>2.exam 创建成功得 0.2 分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-node1 ~]# cat crd.yaml </span><br><span class="line">apiVersion: apiextensions.k8s.io/v1</span><br><span class="line">kind: CustomResourceDefinition</span><br><span class="line">metadata:</span><br><span class="line">  name: students.stable.example.com</span><br><span class="line">spec:</span><br><span class="line">  group: stable.example.com</span><br><span class="line">  names:</span><br><span class="line">    kind: Student #kind 通常是单数形式的驼峰命名（CamelCased）形式。你的资源清单会使用这一形式。</span><br><span class="line">    plural: students #名称的复数形式，用于 URL：/apis/&lt;组&gt;/&lt;版本&gt;/&lt;名称的复数形式&gt;</span><br><span class="line">    singular: student #名称的单数形式，作为命令行使用时和显示时的别名</span><br><span class="line">    shortNames: # shortNames 允许你在命令行使用较短的字符串来匹配资源</span><br><span class="line">    - stu</span><br><span class="line">  scope: Namespaced</span><br><span class="line">  versions:</span><br><span class="line">  - served: true</span><br><span class="line">    storage: true</span><br><span class="line">    name: v1</span><br><span class="line">    schema:</span><br><span class="line">      openAPIV3Schema:</span><br><span class="line">        type: object</span><br><span class="line">[root@k8s-master-node1 ~]# cat student.yaml </span><br><span class="line">apiVersion: stable.example.com/v1</span><br><span class="line">kind: Student</span><br><span class="line">metadata:</span><br><span class="line">  name: exam</span><br></pre></td></tr></table></figure>

<h4 id="【题目-4】解析管理–添加主机别名到-Pod-0-5-分"><a href="#【题目-4】解析管理–添加主机别名到-Pod-0-5-分" class="headerlink" title="【题目 4】解析管理–添加主机别名到 Pod[0.5 分]"></a>【题目 4】解析管理–添加主机别名到 Pod[0.5 分]</h4><p>使用 nginx 镜像在 default 命名空间下创建一个名为 nginx 的 Pod，并在 Pod 的&#x2F;etc&#x2F;hosts中添加 IP 地址 127.0.0.1 与 chinaskills 的解析。完成后提交 master 节点的 IP 地址、用户名和密码到答题框。<br>1.自定义解析配置正确得 0.5 分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-node1 ~]# cat nginx.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx</span><br><span class="line">spec:</span><br><span class="line">  hostAliases:</span><br><span class="line">  - ip: &quot;127.0.0.1&quot;</span><br><span class="line">    hostnames:</span><br><span class="line">    - &quot;chinaskills&quot;</span><br><span class="line">  containers:</span><br><span class="line">  - name: ngnix</span><br><span class="line">    image: nginx:latest</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br></pre></td></tr></table></figure>

<h4 id="【题目-5】HPA-管理–创建-HPA-规则-1-分"><a href="#【题目-5】HPA-管理–创建-HPA-规则-1-分" class="headerlink" title="【题目 5】HPA 管理–创建 HPA 规则[1 分]"></a>【题目 5】HPA 管理–创建 HPA 规则[1 分]</h4><p>默认情况下 HPA 是无法调整伸缩灵敏度的，但不同的业务场景对伸缩灵敏度的要求不一样。要求在 default 命名空间下使用 nginx 镜像创建一个名为 web 的 deployment，自定义HPA 的伸缩灵敏度，为该 deployment 创建一个名为 web 的 HPA，扩容时立即新增当前 9 倍数量的副本数，时间窗口为 5s，伸缩范围为 1–1000。例如一开始只有 1 个 Pod，当 CPU 使用率超过 80%时，Pod 数量变化趋势为：1 → 10 → 100 → 1000。完成后提交 master 节点的 IP 地址、用户名和密码到答题框。<br>1.HPA 创建成功得 0.2 分；<br>2.HPA 伸缩策略配置正确得 0.8 分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-node1 ~]# cat nginx-hpa.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app: web</span><br><span class="line">  name: web</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: web</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: web</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - image: nginx:latest</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        name: nginx</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">        resources:</span><br><span class="line">          limits:</span><br><span class="line">            cpu: 10m</span><br><span class="line">            memory: 20Mi</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 10m</span><br><span class="line">            memory: 20Mi</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-node1 ~]# cat web-hpa.yaml</span><br><span class="line">apiVersion: autoscaling/v2beta2</span><br><span class="line">kind: HorizontalPodAutoscaler</span><br><span class="line">metadata:</span><br><span class="line">  name: web</span><br><span class="line">spec:</span><br><span class="line">  minReplicas: 1</span><br><span class="line">  maxReplicas: 1000</span><br><span class="line">  scaleTargetRef:</span><br><span class="line">    apiVersion: apps/v1</span><br><span class="line">    kind: Deployment</span><br><span class="line">    name: web</span><br><span class="line">  metrics:</span><br><span class="line">  - type: Resource</span><br><span class="line">    resource:</span><br><span class="line">      name: cpu</span><br><span class="line">      target:</span><br><span class="line">        type: Utilization</span><br><span class="line">        averageUtilization: 80</span><br><span class="line">  behavior:</span><br><span class="line">    scaleUp:</span><br><span class="line">      stabilizationWindowSeconds: 5 #在五秒之内进程扩容</span><br><span class="line">      policies:</span><br><span class="line">      - type: Percent  #以百分比形式</span><br><span class="line">        value: 900  #百分之900</span><br><span class="line">        periodSeconds: 5 #每5秒扩容一次</span><br></pre></td></tr></table></figure>

<h4 id="【题目-6】节点亲和性管理–创建硬限制规则的-Pod-0-5-分"><a href="#【题目-6】节点亲和性管理–创建硬限制规则的-Pod-0-5-分" class="headerlink" title="【题目 6】节点亲和性管理–创建硬限制规则的 Pod[0.5 分]"></a>【题目 6】节点亲和性管理–创建硬限制规则的 Pod[0.5 分]</h4><p>在 default 命 名空 间下 使用 nginx 镜像 运行 一个 Pod ，名 称为 nginx ，要求 使用requiredDuringSchedulingIgnoredDuringExecution 策略将 Pod 调度到具有“disktype&#x3D;ssd”标签的节点。<br>完成后提交 master 节点的用户名、密码和 IP 到答题框。<br>1.Pod 调度策略配置正确得 0.5 分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-node1 ~]# kubectl label node k8s-worker-node1 disktype=ssd</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-node1 ~]# cat label-nginx.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata: </span><br><span class="line">  name: nginx</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - image: nginx:latest</span><br><span class="line">    name: nginx</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">  affinity:</span><br><span class="line">    nodeAffinity:</span><br><span class="line">      requiredDuringSchedulingIgnoredDuringExecution:</span><br><span class="line">        nodeSelectorTerms:</span><br><span class="line">        - matchExpressions:</span><br><span class="line">          - key: disktype</span><br><span class="line">            operator: In</span><br><span class="line">            values:</span><br><span class="line">              - ssd</span><br></pre></td></tr></table></figure>

<h4 id="【题目-7】网络策略管理–创建-Pod-网络策略-0-5-分"><a href="#【题目-7】网络策略管理–创建-Pod-网络策略-0-5-分" class="headerlink" title="【题目 7】网络策略管理–创建 Pod 网络策略[0.5 分]"></a>【题目 7】网络策略管理–创建 Pod 网络策略[0.5 分]</h4><p>创建一个网络策略 network-exam，要求只有 internal 命名空间下的 Pod 可以通过 TCP协议的 8080 端口访问到 mysql 命名空间下的 Pod。<br>完成后提交 master 节点的 IP、用户名和密码到答题框。<br>1.网络策略创建成功得 0.2 分；<br>2.规则配置正确得 0.3 分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-node1 ~]# cat network-exam.yaml </span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">kind: NetworkPolicy</span><br><span class="line">metadata:</span><br><span class="line">  name: network-exam</span><br><span class="line">  namespace: internal</span><br><span class="line">spec:</span><br><span class="line">  podSelector: &#123;&#125; #internal命名空间下所有pod</span><br><span class="line">  policyTypes:</span><br><span class="line">    - Egress</span><br><span class="line">  egress:</span><br><span class="line">    - to:</span><br><span class="line">      - namespaceSelector:</span><br><span class="line">          matchLabels:</span><br><span class="line">            kubernetes.io/metadata.name: mysql #mysql命名空间的默认label</span><br><span class="line">      ports:</span><br><span class="line">        - protocol: TCP</span><br><span class="line">          port: 8080</span><br></pre></td></tr></table></figure>

<h4 id="【题目-8】驱逐机制管理–配置节点压力驱逐-0-5-分"><a href="#【题目-8】驱逐机制管理–配置节点压力驱逐-0-5-分" class="headerlink" title="【题目 8】驱逐机制管理–配置节点压力驱逐[0.5 分]"></a>【题目 8】驱逐机制管理–配置节点压力驱逐[0.5 分]</h4><p>设置 kubelet 数据存储在&#x2F;apps&#x2F;data&#x2F;kubelet 目录下，并设置当 kubelet 的存储空间不足 5%，或者当容器运行时文件系统可用存储空间不足 5%时开始驱逐 Pod。</p>
<p>完成后提交 master 节点的 IP 地址、用户名和密码到答题框。<br>1.节点压力驱逐配置正确得 0.5 分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-node1 ~]# mkdir -p /apps/data/kubelet</span><br><span class="line">[root@k8s-master-node1 ~]# cat /etc/sysconfig/kubelet </span><br><span class="line">KUBELET_EXTRA_ARGS=--root-dir=/apps/data/kubelet</span><br><span class="line">[root@k8s-master-node1 ~]# cat /var/lib/kubelet/config.yaml  | grep available</span><br><span class="line">  nodefs.available: 5%</span><br><span class="line">  imagefs.available: 5%</span><br><span class="line">[root@k8s-master-node1 ~]# systemctl restart kubelet</span><br></pre></td></tr></table></figure>

<h4 id="【题目-9】流量管理–创建-Ingress-Gateway-0-5-分"><a href="#【题目-9】流量管理–创建-Ingress-Gateway-0-5-分" class="headerlink" title="【题目 9】流量管理–创建 Ingress Gateway[0.5 分]"></a>【题目 9】流量管理–创建 Ingress Gateway[0.5 分]</h4><p>使用提供的软件包 ServiceMesh.tar.gz 将 Bookinfo 应用部署到 default 命名空间下，使用Istio Gateway 可 以 实 现 应 用 程 序 从 外 部 访 问 ， 请 为 Bookinfo 应 用 创 建 一 个 名 为bookinfo-gateway 的网关，指定所有 HTTP 流量通过 80 端口流入网格，然后将网关绑定到虚拟服务 bookinfo 上。<br>完成后提交 master 节点的 IP 地址、用户名和密码到答题框。<br>1.Bookinfo 应用部署成功得 0.2 分；<br>2.Bookinfo 能通过网关访问得 0.3 分。</p>
<p>解压软件包并导入镜像：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master</span>-<span class="type">node1</span> ~]<span class="comment"># tar -zxf ServiceMesh.tar.gz</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master</span>-<span class="type">node1</span> ~]<span class="comment"># cd ServiceMesh/</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master</span>-<span class="type">node1</span> <span class="type">ServiceMesh</span>]<span class="comment"># docker load -i images/image.tar</span></span><br></pre></td></tr></table></figure>

<p>部署应用到Kubernetes集群：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master</span>-<span class="type">node1</span> <span class="type">ServiceMesh</span>]<span class="comment"># kubectl apply -f bookinfo/bookinfo.yaml</span></span><br><span class="line">service/details created</span><br><span class="line">serviceaccount/bookinfo<span class="literal">-details</span> created</span><br><span class="line">deployment.apps/details<span class="literal">-v1</span> created</span><br><span class="line">service/ratings created</span><br><span class="line">serviceaccount/bookinfo<span class="literal">-ratings</span> created</span><br><span class="line">deployment.apps/ratings<span class="literal">-v1</span> created</span><br><span class="line">service/reviews created</span><br><span class="line">serviceaccount/bookinfo<span class="literal">-reviews</span> created</span><br><span class="line">deployment.apps/reviews<span class="literal">-v1</span> created</span><br><span class="line">service/productpage created</span><br><span class="line">serviceaccount/bookinfo<span class="literal">-productpage</span> created</span><br><span class="line">deployment.apps/productpage<span class="literal">-v1</span> created</span><br></pre></td></tr></table></figure>

<p>Gateway配置文件如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master</span>-<span class="type">node1</span> <span class="type">ServiceMesh</span>]<span class="comment"># cat bookinfo-gateway.yaml</span></span><br><span class="line">apiVersion: networking.istio.io/v1alpha3</span><br><span class="line">kind: Gateway</span><br><span class="line">metadata:</span><br><span class="line">name: bookinfo<span class="literal">-gateway</span></span><br><span class="line">spec:</span><br><span class="line">selector:</span><br><span class="line">  istio: ingressgateway <span class="comment"># use istio default controller</span></span><br><span class="line">servers:</span><br><span class="line"> - port:</span><br><span class="line">    number: <span class="number">80</span></span><br><span class="line">    name: http</span><br><span class="line">    protocol: HTTP</span><br><span class="line">  hosts:</span><br><span class="line">   - <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="literal">---</span></span><br><span class="line">apiVersion: networking.istio.io/v1alpha3</span><br><span class="line">kind: VirtualService</span><br><span class="line">metadata:</span><br><span class="line">name: bookinfo</span><br><span class="line">spec:</span><br><span class="line">hosts:</span><br><span class="line"> - <span class="string">&quot;*&quot;</span></span><br><span class="line">gateways:</span><br><span class="line"> - bookinfo<span class="literal">-gateway</span></span><br><span class="line">http:</span><br><span class="line"> - match:</span><br><span class="line">   - uri:</span><br><span class="line">      exact: /productpage</span><br><span class="line">   - uri:</span><br><span class="line">      prefix: /<span class="keyword">static</span></span><br><span class="line">   - uri:</span><br><span class="line">      exact: /login</span><br><span class="line">   - uri:</span><br><span class="line">      exact: /logout</span><br><span class="line">   - uri:</span><br><span class="line">      prefix: /api/v1/products</span><br><span class="line">  route:</span><br><span class="line">   - destination:</span><br><span class="line">      host: productpage</span><br><span class="line">      port:</span><br><span class="line">        number: <span class="number">9080</span></span><br></pre></td></tr></table></figure>

<p>确认网关创建完成：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master</span>-<span class="type">node1</span> <span class="type">ServiceMesh</span>]<span class="comment"># kubectl apply -f bookinfo-gateway.yaml</span></span><br><span class="line">gateway.networking.istio.io/bookinfo<span class="literal">-gateway</span> created</span><br><span class="line">virtualservice.networking.istio.io/bookinfo created</span><br><span class="line"></span><br><span class="line">[<span class="type">root</span>@<span class="type">k8s</span>-<span class="type">master</span>-<span class="type">node1</span> <span class="type">ServiceMesh</span>]<span class="comment"># kubectl get gateway</span></span><br><span class="line">NAME               AGE</span><br><span class="line">bookinfo<span class="literal">-gateway</span>       <span class="number">32</span>s</span><br></pre></td></tr></table></figure>

<h4 id="【题目-10】服务网格–创建基于用户身份的路由-0-5-分"><a href="#【题目-10】服务网格–创建基于用户身份的路由-0-5-分" class="headerlink" title="【题目 10】服务网格–创建基于用户身份的路由[0.5 分]"></a>【题目 10】服务网格–创建基于用户身份的路由[0.5 分]</h4><p>创建一个名为 reviews 路由，要求来自名为 Jason 的用户的所有流量将被路由到服务reviews:v2。<br>完成后提交 master 节点的用户名、密码和 IP 到答题框。<br>1.路由创建成功得 0.2 分；<br>2.用户限制正确得 0.3 分。</p>
<h4 id="【题目-11】服务网格–创建请求路由-0-5-分"><a href="#【题目-11】服务网格–创建请求路由-0-5-分" class="headerlink" title="【题目 11】服务网格–创建请求路由[0.5 分]"></a>【题目 11】服务网格–创建请求路由[0.5 分]</h4><p>在 default 命名空间下创建一个名为 reviews-route 的虚拟服务，默认情况下，所有的 HTTP流量都会被路由到标签为 version:v1 的 reviews 服务的 Pod 上。此外，路径以&#x2F;wpcatalog&#x2F;或&#x2F;consumercatalog&#x2F;开头的 HTTP 请求将被重写为&#x2F;newcatalog，并被发送到标签为 version:v2 的Pod 上。<br>完成后提交 master 节点的 IP 地址、用户名和密码到答题框。<br>1.请求路由创建成功得 0.2 分；</p>
<p>2.路由策略配置正确得 0.3 分</p>
<h3 id="【任务-5】容器云服务运维：Kubernetes-基于虚拟机的运维-4-0-分"><a href="#【任务-5】容器云服务运维：Kubernetes-基于虚拟机的运维-4-0-分" class="headerlink" title="【任务 5】容器云服务运维：Kubernetes 基于虚拟机的运维[4.0 分]"></a>【任务 5】容器云服务运维：Kubernetes 基于虚拟机的运维[4.0 分]</h3><p>【适用平台】私有云</p>
<h4 id="【题目-1】VM-管理–创建-VM-0-5-分"><a href="#【题目-1】VM-管理–创建-VM-0-5-分" class="headerlink" title="【题目 1】VM 管理–创建 VM[0.5 分]"></a>【题目 1】VM 管理–创建 VM[0.5 分]</h4><p>使用镜像 fedora-virt:v1.0 在 default 命名空间下创建一台 vm，名称为 vm-fedora，内存为1G。<br>完成后提交 master 节点的 IP 地址、用户名和密码到答题框。<br>1.VM 创建成功得 0.3 分；<br>2.VM 配置正确得 0.2 分。</p>
<p><em><strong>重要：启用仿真模拟，虽然会影响VM的性能 。</strong></em></p>
<blockquote>
<p>如果不启用，后边可能vm会启动不起来，但是开启后只能在本机访问，不能通过nodePort远程访问，此处建议执行，运行成功后可以尝试修改为false，然后再删除vm，重新创建vm。</p>
</blockquote>
<p><code>kubectl create configmap -n kubevirt kubevirt-config --from-literal debug.useEmulation=true</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-node1 ~]# cat vm-fedora.yaml </span><br><span class="line">apiVersion: kubevirt.io/v1</span><br><span class="line">kind: VirtualMachine</span><br><span class="line">metadata:</span><br><span class="line">  name: vm-fedora</span><br><span class="line">spec:</span><br><span class="line">  running: false</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        kubevirt.io/vm: vm-fedora</span><br><span class="line">    spec:</span><br><span class="line">      domain:</span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            memory: 1Gi</span><br><span class="line">        devices:</span><br><span class="line">          disks:</span><br><span class="line">          - name: containerdisk</span><br><span class="line">            disk: &#123;&#125;</span><br><span class="line">      volumes:</span><br><span class="line">      - name: containerdisk</span><br><span class="line">        containerDisk:</span><br><span class="line">          image: kubevirt/fedora-cloud-container-disk-demo:latest</span><br></pre></td></tr></table></figure>

<h4 id="【题目-2】存储与卷–创建-emptyDisk-卷-1-分"><a href="#【题目-2】存储与卷–创建-emptyDisk-卷-1-分" class="headerlink" title="【题目 2】存储与卷–创建 emptyDisk 卷[1 分]"></a>【题目 2】存储与卷–创建 emptyDisk 卷[1 分]</h4><p>使用镜像 fedora-virt:v1.0 在 default 命名空间下创建一台 vmi，名称为 vmi-fedora，并使用 emptyDisk 卷为 vmi 挂载一块 2G 的磁盘。<br>完成后提交 master 节点的 IP 地址、用户名和密码到答题框。<br>1.VMI 创建成功得 0.4 分；<br>2.卷挂载成功得 0.6 分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-node1 ~]# cat vmi.yaml </span><br><span class="line">apiVersion: kubevirt.io/v1</span><br><span class="line">kind: VirtualMachineInstance</span><br><span class="line">metadata:</span><br><span class="line">  name: testvmi-nocloud</span><br><span class="line">spec:</span><br><span class="line">  domain:</span><br><span class="line">    resources:</span><br><span class="line">      requests:</span><br><span class="line">        memory: 1024M</span><br><span class="line">    devices:</span><br><span class="line">      disks:</span><br><span class="line">      - name: containerdisk</span><br><span class="line">        disk:</span><br><span class="line">          bus: virtio</span><br><span class="line">      - name: emptydisk</span><br><span class="line">        disk:</span><br><span class="line">          bus: virtio</span><br><span class="line">  volumes:</span><br><span class="line">  - name: containerdisk</span><br><span class="line">    containerDisk:</span><br><span class="line">      image: kubevirt/fedora-cloud-container-disk-demo:latest</span><br><span class="line">  - name: emptydisk</span><br><span class="line">    emptyDisk:</span><br><span class="line">      capacity: &quot;2Gi&quot;</span><br></pre></td></tr></table></figure>

<h4 id="【题目-3】KubeVirt-运维–创建-VMI-1-5-分"><a href="#【题目-3】KubeVirt-运维–创建-VMI-1-5-分" class="headerlink" title="【题目 3】KubeVirt 运维–创建 VMI[1.5 分]"></a>【题目 3】KubeVirt 运维–创建 VMI[1.5 分]</h4><p>将提供的镜像 exam.qcow2 转换为 docker 镜像 exam:v1.0，然后使用镜像 exam:v1.0 镜像在 default 命名空间下创建一台 vmi，名称为 exam，将虚拟机的 80 端口以 NodePort 的方式对外暴露为 30082，并使用数据源在启动时将 VM 的主机名初始化为 exam。完成后提交 master 节点的 IP 地址、用户名和密码到答题框。<br>1.qcow2 镜像转化成功得 0.3 分；<br>2.VMI 创建成功得 0.3 分；</p>
<p>3.端口暴露成功得 0.3 分；<br>4.服务能正常访问得 0.4 分；<br>5.主机名初始化成功得 0.2 分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master-node1 ~]# yum install -y  libguestfs-tools</span><br><span class="line">[root@k8s-master-node1 ~]# systemctl restart libvirtd</span><br><span class="line">[root@k8s-master-node1 ~]# guestmount -a CentOS-7-x86_64-2009.qcow2 -i /mnt/</span><br><span class="line">libguestfs: error: could not create appliance through libvirt.</span><br><span class="line">Try running qemu directly without libvirt using this environment variable:</span><br><span class="line">export LIBGUESTFS_BACKEND=direct</span><br><span class="line">Original error from libvirt: Cannot access storage file &#x27;/root/CentOS-7-x86_64-2009.qcow2&#x27; (as uid:107, gid:107): Permission denied [code=38 int1=13]</span><br><span class="line">[root@k8s-master-node1 ~]# export LIBGUESTFS_BACKEND=direct</span><br><span class="line">[root@k8s-master-node1 ~]# guestmount -a CentOS-7-x86_64-2009.qcow2 -i /mnt/</span><br><span class="line">[root@k8s-master-node1 ~]# ls /mnt/</span><br><span class="line">bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">[root@k8s-master-node1 ~]# tar -cvzf exam.tar.gz  -C /mnt/ ./</span><br><span class="line">[root@k8s-master-node1 ~]# cat /root/exam.tar.gz | docker import - exam:v1.0</span><br><span class="line">[root@k8s-master-node1 ~]# docker images | grep exam</span><br><span class="line">exam                                                v1.0           b7271758eb57   2 minutes ago   807MB</span><br></pre></td></tr></table></figure>

<h4 id="【题目-4】KubeVirt-运维–启用快照-1-分"><a href="#【题目-4】KubeVirt-运维–启用快照-1-分" class="headerlink" title="【题目 4】KubeVirt 运维–启用快照[1 分]"></a>【题目 4】KubeVirt 运维–启用快照[1 分]</h4><p>KubeVirt 支持对 VM 进行快照，请启用 KubeVirt 快照管理功能：完成后提交 master 节点的 IP 地址、用户名和密码到答题框。</p>
<h3 id="【任务-6】容器云运维开发：Kubernetes-APIs-运维开发-10-分"><a href="#【任务-6】容器云运维开发：Kubernetes-APIs-运维开发-10-分" class="headerlink" title="【任务 6】容器云运维开发：Kubernetes APIs 运维开发[10 分]"></a>【任务 6】容器云运维开发：Kubernetes APIs 运维开发[10 分]</h3><p>【适用平台】私有云</p>
<h4 id="【题目-1】Python-运维开发：基于-Kubernetes-Restful-API-实现-Deployment-创建-2-分"><a href="#【题目-1】Python-运维开发：基于-Kubernetes-Restful-API-实现-Deployment-创建-2-分" class="headerlink" title="【题目 1】Python 运维开发：基于 Kubernetes Restful API 实现 Deployment 创建[2 分]"></a>【题目 1】Python 运维开发：基于 Kubernetes Restful API 实现 Deployment 创建[2 分]</h4><p>在提供的 OpenStack 私有云平台上，使用 k8s-python-dev 镜像创建 1 台云主机，云主机类型使用 4vCPU&#x2F;12G 内存&#x2F;100G 硬盘。该主机中已经默认安装了所需的开发环境，登录默认账号密码为“root&#x2F;1DaoYun@2022”。<br>使用 Kubernetes Restful API 库，在&#x2F;root 目录下，创建 api_deployment_manager.py 文件，要求编写 python 代码，代码实现以下任务：<br>（1）编写 Python 程序实现 Deployment 资源的创建。Deployment 配置信息如下。如果<br>同名 Deployment 存在，先删除再创建。<br>（2）创建完成后，查询该 Deployment 的详细信息，执行结果控制台输出，以 yaml 格<br>式展示。<br>创建 Deployment 的 yaml 的配置如下：<br>apiVersion: apps&#x2F;v1<br>kind: Deployment<br>metadata:<br>name: nginx-deployment<br>labels:</p>
<p>app: nginx<br>spec:<br>replicas: 3<br>selector:<br>matchLabels:<br>app: nginx<br>template:<br>metadata:<br>labels:<br>app: nginx<br>spec:<br>containers:<br>- name: nginx<br>image: nginx:1.15.4<br>ports:<br>- containerPort: 80<br>1.执行 api_deployment_manager.py 脚本，成功创建 deployment 资源，计 1 分；<br>2.检查创建的 deployment 资源，配置信息无误计 1 分。1.快照功能启用成功得 1 分。</p>
<h4 id="【题目-2】Python-运维开发：基于-Kubernetes-Python-SDK-实现-Job-创建-1-分"><a href="#【题目-2】Python-运维开发：基于-Kubernetes-Python-SDK-实现-Job-创建-1-分" class="headerlink" title="【题目 2】Python 运维开发：基于 Kubernetes Python SDK 实现 Job 创建[1 分]"></a>【题目 2】Python 运维开发：基于 Kubernetes Python SDK 实现 Job 创建[1 分]</h4><p>在前面已建好的 Kubernetes 开发环境云平台上。使用 Kubernetes python SDK 的“kubernetes”Python 库，在&#x2F;root 目录下，创建 sdk_job_manager.py 文件，要求编写 python 代码，代码实现以下任务：<br>（1）编写 Python 程序实现 Job 资源的创建。Job 配置信息如下。如果同名 Job 存在，先删除再创建。<br>（2）创建完成后，查询该 Job 的详细信息，执行结果控制台输出，以 json 格式展示。<br>Job 创建 yaml 的信息如下：<br>apiVersion: batch&#x2F;v1<br>kind: Job</p>
<p>metadata:<br>name: pi<br>spec:<br>template:<br>spec:<br>containers:<br>- name: pi<br>image: perl<br>command: [“perl”, “-Mbignum&#x3D;bpi”, “-wle”, “print bpi(2000)”]<br>restartPolicy: Never<br>backoffLimit: 4<br>1.执行 sdk_job_manager.py 脚本，成功创建 job 资源，计 0.5 分；<br>2.查询 job 资源，配置信息无误，计 0.5 分。</p>
<h4 id="【题目-3】Python-运维开发：Pod-资源的-Restful-APIs-HTTP-服务封装-3-分"><a href="#【题目-3】Python-运维开发：Pod-资源的-Restful-APIs-HTTP-服务封装-3-分" class="headerlink" title="【题目 3】Python 运维开发：Pod 资源的 Restful APIs HTTP 服务封装[3 分]"></a>【题目 3】Python 运维开发：Pod 资源的 Restful APIs HTTP 服务封装[3 分]</h4><p>编写 Python 程序实现 Pod 资源管理程序，将 Pod 资源管理的封装成 Web 服务。在&#x2F;root 目录下创建 pod_server.py 程序，实现 Pod 的增删查改等 Web 访问操作。http.server的 host 为 localhost，端口 8889；程序内部实现 Kubernetes 认证。提示说明：Python 标准库 http.server 模块，提供了 HTTP Server 请求封装。<br>需要实现的 Restful API 接口如下：GET &#x2F;pod&#x2F;{name} ，查询指定名称{name}的 Pod；Response 的 Body 以 json 格式输出。POST &#x2F;pod&#x2F;{yamlfilename} 创建 yaml 文件名称为{yamlfilename}的 Pod；Response 的<br>Body 以 json 格式。编码完成后，“手工下载”文件服务器主目录所有*.yaml 文件到 root 目录下，“手动执<br>行”所编写 pod_server.py 程序，提交答案进行检测。<br>1.HTTP 服务成功启动，计 1 分；<br>2.发起指定参数的 GET 查询 Pod 请求，成功查询指定名称的 pod 服务，计 1 分；</p>
<p>3.发起指定参数的 POST 创建 Pod 请求，成功创建 Pod 服务，计 1 分。</p>
<h4 id="【题目-4】Python-运维开发：Service-资源-Restful-APIs-HTTP-服务封装-4-分"><a href="#【题目-4】Python-运维开发：Service-资源-Restful-APIs-HTTP-服务封装-4-分" class="headerlink" title="【题目 4】Python 运维开发：Service 资源 Restful APIs HTTP 服务封装[4 分]"></a>【题目 4】Python 运维开发：Service 资源 Restful APIs HTTP 服务封装[4 分]</h4><p>编写 Python 程序实现 Service 资源管理程序，将 Service 资源管理的封装成 Web 服务。在&#x2F;root 目录下创建 service_server.py 程序，实现 Service 的增删查改等 Web 访问操作。http.server 的 host 为 localhost，端口 8888；程序内部实现 Kubernetes 认证。提示说明：Python 标准库 http.server 模块，提供了 HTTP Server 请求封装。需要实现的 Restful API 接口如下：GET &#x2F;services&#x2F;{name}，查询指定名称{name}的 Service；Response 的 Body 以 json 格式输出。<br>POST &#x2F;services&#x2F;{yamlfilename} 创建 yaml 文件名称为{yamlfilename}的 Service；<br>Response 的 Body 以 json 格式，（手工将文件服务器主目录所有*.yaml 文件下载到 root 目录<br>下）。<br>DELETE &#x2F;services&#x2F;{name}；删除指定名称的 Service；Response 的 Body 以 json 格式。<br>编码完成后，自己手动执行提供 Web HTTP 服务的 service_server.py 程序，提交答案进<br>行检测。<br>1.HTTP 服务成功启动，计 1 分；<br>2.发起指定参数的 POST 创建 service 请求，成功创建 service 资源，计 1 分；<br>3.发起指定参数的 GET 查询 service 请求，成功查询指定名称的 Service，计 1 分；<br>4.发起指定参数的 DELETE 删除 service 请求，成功删除指定名称的 Service，计 1 分。</p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/04/19/openstacksdk/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2023/03/07/2022%E4%BA%91%E8%AE%A1%E7%AE%97%E5%9B%BD%E8%B5%9B%E7%A7%81%E6%9C%89%E4%BA%91/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">2022云计算国赛私有云</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>






</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2023 Miss
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/preccrep/hexo-theme-jelly" target="_blank">Jelly</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




  </div>
</body>
</html>