<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>k8s学习日记day2 | Misswjy&#39;Blog</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="kubernetes的资源管理">
<meta property="og:type" content="article">
<meta property="og:title" content="k8s学习日记day2">
<meta property="og:url" content="http://example.com/2022/05/19/k8s%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0day2/index.html">
<meta property="og:site_name" content="Misswjy&#39;Blog">
<meta property="og:description" content="kubernetes的资源管理">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-05-19T02:52:13.000Z">
<meta property="article:modified_time" content="2022-05-19T05:07:10.000Z">
<meta property="article:author" content="Miss">
<meta property="article:tag" content="k8s">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="Misswjy&#39;Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
<meta name="generator" content="Hexo 6.1.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
				<img lazy-src="/img/avatar.png" class="js-avatar">
			
		</a>

		<hgroup>
			<h1 class="header-author"><a href="/">Miss</a></h1>
		</hgroup>

		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">Home</a></li>
				        
							<li><a href="/archives">Archives</a></li>
				        
						</ul>
					</nav>
					<nav class="half-header-menu">
						<a class="hide">Home</a>
						<a>Tags</a>
						<a>Links</a>
						<a>About</a>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/Misswjy" title="github">github</a>
					        
								<a class="mail" target="_blank" href="/dockery@foxmail.com" title="mail">mail</a>
					        
								<a class="bilibili" target="_blank" href="https://space.bilibili.com/292671654" title="bilibili">bilibili</a>
					        
						</div>
						<!-- music -->
						
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/k8s/" style="font-size: 15px;">k8s</a> <a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 12.5px;">云计算</a> <a href="/tags/%E5%AE%B9%E5%99%A8%E4%BA%91/" style="font-size: 17.5px;">容器云</a> <a href="/tags/%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2%E5%92%8C%E8%BF%90%E7%BB%B4/" style="font-size: 10px;">应用部署和运维</a> <a href="/tags/%E7%A7%81%E6%9C%89%E4%BA%91/" style="font-size: 20px;">私有云</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/">github</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">I&#39;m a developer.</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/avatar.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">Home</a></li>
		        
					<li><a href="/archives">Archives</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Misswjy" title="github">github</a>
			        
						<a class="mail" target="_blank" href="/dockery@foxmail.com" title="mail">mail</a>
			        
						<a class="bilibili" target="_blank" href="https://space.bilibili.com/292671654" title="bilibili">bilibili</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-k8s学习日记day2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/05/19/k8s%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0day2/" class="article-date">
  	<time datetime="2022-05-19T02:52:13.000Z" itemprop="datePublished">2022-05-19</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      k8s学习日记day2
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li></ul>
	</div>

        

        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="kubernetes的资源管理"><a href="#kubernetes的资源管理" class="headerlink" title="kubernetes的资源管理"></a>kubernetes的资源管理<span id="more"></span></h1><h2 id="1-资源管理介绍"><a href="#1-资源管理介绍" class="headerlink" title="1 资源管理介绍"></a>1 资源管理介绍</h2><p>在Kubernetes中，所有的内容都抽象为资源，用户需要通过操作资源来管理Kubernetes。</p>
<p>Kubernetes的本质就是一个集群系统，用户可以在集群中部署各种服务。所谓的部署服务，其实就是在Kubernetes集群中运行一个个的容器，并将指定的程序跑在容器中。<br>Kubernetes的最小管理单元是Pod而不是容器，所以只能将容器放在Pod中，而Kubernetes一般也不会直接管理Pod，而是通过Pod控制器来管理Pod的。<br>Pod提供服务之后，就需要考虑如何访问Pod中的服务，Kubernetes提供了Service资源实现这个功能。<br>当然，如果Pod中程序的数据需要持久化，Kubernetes还提供了各种存储系统。</p>
<p><strong>学习kubernets的核心，就是学习如何对集群中的Pod、Pod控制器、Service、存储等各种资源进行操作。</strong></p>
<h2 id="2-YAML语法介绍"><a href="#2-YAML语法介绍" class="headerlink" title="2 YAML语法介绍"></a>2 YAML语法介绍</h2><h3 id="2-1-YAML语法介绍"><a href="#2-1-YAML语法介绍" class="headerlink" title="2.1 YAML语法介绍"></a>2.1 YAML语法介绍</h3><p>YAML是一个类似于XML、JSON的标记性语言。它强调的是以“数据”为中心，并不是以标记语言为重点。因而YAML本身的定义比较简单，号称是“一种人性化的数据格式语言”。</p>
<p>YAML的语法比较简单，主要有下面的几个：</p>
<p>○大小写敏感。</p>
<p>○使用缩进表示层级关系。</p>
<p>○缩进不允许使用tab，只允许空格（低版本限制）。</p>
<p>○缩进的空格数不重要，只要相同层级的元素左对齐即可。</p>
<p>○‘#’表示注释。</p>
<p>YAML支持以下几种数据类型：</p>
<p>○常量：单个的、不能再分的值。</p>
<p>○对象：键值对的集合，又称为映射&#x2F;哈希&#x2F;字典。</p>
<p>○数组：一组按次序排列的值，又称为序列&#x2F;列表。</p>
<h3 id="2-2-YAML语法示例"><a href="#2-2-YAML语法示例" class="headerlink" title="2.2 YAML语法示例"></a><strong>2.2 YAML语法示例</strong></h3><h4 id="2-2-1-YAML常量"><a href="#2-2-1-YAML常量" class="headerlink" title="2.2.1 YAML常量"></a><strong>2.2.1 YAML常量</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#常量，就是指的是一个简单的值，字符串、布尔值、整数、浮点数、NUll、时间、日期</span><br><span class="line"># 布尔类型 c1: true </span><br><span class="line"># 整型 c2: 123456 </span><br><span class="line"># 浮点类型 c3: 3.14 # null类型 c4: ~ </span><br><span class="line"># 使用~表示null </span><br><span class="line"># 日期类型 c5: 2019-11-11 </span><br><span class="line"># 日期类型必须使用ISO 8601格式，即yyyy-MM-dd </span><br><span class="line"># 时间类型 c6: 2019-11-11T15:02:31+08.00 </span><br><span class="line"># 时间类型使用ISO 8601格式，时间和日期之间使用T连接，最后使用+代表时区 </span><br><span class="line"># 字符串类型 c7: haha </span><br><span class="line"># 简单写法，直接写值，如果字符串中间有特殊符号，必须使用双引号或单引号包裹 c8: line1    line2 </span><br><span class="line"># 字符串过多的情况可以折成多行，每一行都会转换成一个空格</span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-对象"><a href="#2-2-2-对象" class="headerlink" title="2.2.2 对象"></a><strong>2.2.2 对象</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">\# 对象 </span><br><span class="line"># 形式一（推荐）： </span><br><span class="line">xudaxian:	 </span><br><span class="line">  name: wjy </span><br><span class="line">  age: 20</span><br><span class="line"># 形式二（了解）： </span><br><span class="line">xuxian: &#123; name: wjy, age: 20 &#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-3-数组"><a href="#2-2-3-数组" class="headerlink" title="2.2.3 数组"></a><strong>2.2.3 数组</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">\# 数组 </span><br><span class="line"># 形式一（推荐）： </span><br><span class="line">address: </span><br><span class="line">  - 江苏 </span><br><span class="line">  - 北京 </span><br><span class="line"># 形式二（了解）： </span><br><span class="line">address: [江苏,上海]</span><br></pre></td></tr></table></figure>

<h2 id="3-资源管理方式"><a href="#3-资源管理方式" class="headerlink" title="3 资源管理方式"></a><strong>3 资源管理方式</strong></h2><h3 id="3-1-资源管理方式"><a href="#3-1-资源管理方式" class="headerlink" title="3.1 资源管理方式"></a>3.1 资源管理方式</h3><p>命令式对象管理：直接使用命令去操作kubernetes的资源。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl run nginx3 --image=192.168.20.119/library/nginx:latest</span><br></pre></td></tr></table></figure>

<p>命令式对象配置：通过命令配置和配置文件去操作kubernetes的资源。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl create/patch -f nginx-pod.yaml</span><br></pre></td></tr></table></figure>

<p>声明式对象配置：通过apply命令和配置文件去操作kubernetes的资源。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl apply -f nginx-pod.yaml</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>类型</th>
<th>操作</th>
<th>适用场景</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>命令式对象管理</td>
<td>对象</td>
<td>测试</td>
<td>简单</td>
<td>只能操作活动对象，无法审计、跟踪</td>
</tr>
<tr>
<td>命令式对象配置</td>
<td>文件</td>
<td>开发</td>
<td>可以审计、跟踪</td>
<td>项目大的时候，配置文件多，操作麻烦</td>
</tr>
<tr>
<td>声明式对象配置</td>
<td>目录</td>
<td>开发</td>
<td>支持目录操作</td>
<td>意外情况下难以调试</td>
</tr>
</tbody></table>
<h3 id="3-2-命令式对象管理"><a href="#3-2-命令式对象管理" class="headerlink" title="3.2 命令式对象管理"></a><strong>3.2 命令式对象管理</strong></h3><h4 id="3-2-1-kubectl命令"><a href="#3-2-1-kubectl命令" class="headerlink" title="3.2.1 kubectl命令"></a><strong>3.2.1 kubectl命令</strong></h4><p>●kubectl是kubernetes集群的命令行工具，通过它能够对集群本身进行管理，并能够在集群上进行容器化应用的安装和部署。<br>●kubectl命令的语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl [command] [type] [name] [flags]</span><br></pre></td></tr></table></figure>

<p>●command：指定要对资源执行的操作，比如create、get、delete。<br>●type：指定资源的类型，比如deployment、pod、service。<br>●name：指定资源的名称，名称大小写敏感。<br>●flags：指定额外的可选参数。</p>
<p><strong>示例：查看所有的pod</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pods</span><br><span class="line">NAME                     READY   STATUS             RESTARTS   AGE</span><br><span class="line">nginx                    1/1     Running            0          15h</span><br><span class="line">nginx-674ff86d-6cjt9     0/1     ImagePullBackOff   0          15h</span><br><span class="line">nginx1-cc97d58b4-st5mx   1/1     Running            0          38h</span><br><span class="line">nginx3                   1/1     Running            0          5m15s</span><br></pre></td></tr></table></figure>

<p><strong>示例：查看某个pod</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pods nginx #加上pod名称</span><br><span class="line">NAME    READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx   1/1     Running   0          15h</span><br></pre></td></tr></table></figure>

<p><strong>示例：查看某个pod，以yaml格式展示结果</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pods nginx -o yaml</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-操作（command）"><a href="#3-2-2-操作（command）" class="headerlink" title="3.2.2 操作（command）"></a><strong>3.2.2 操作（command</strong>）</h4><p>kubernetes允许对资源进行多种操作，可以通过–help查看详细的操作命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl -h</span><br><span class="line">kubectl controls the Kubernetes cluster manager.</span><br><span class="line"> Find more information at: https://kubernetes.io/docs/reference/kubectl/overview/</span><br><span class="line">Basic Commands (Beginner):</span><br><span class="line">  create        Create a resource from a file or from stdin.</span><br><span class="line">  expose        使用 replication controller, service, deployment 或者 pod 并暴露它作为一个 新的 Kubernetes</span><br><span class="line">Service</span><br><span class="line">  run           在集群中运行一个指定的镜像</span><br><span class="line">  set           为 objects 设置一个指定的特征</span><br><span class="line">Basic Commands (Intermediate):</span><br><span class="line">  explain       查看资源的文档</span><br><span class="line">  get           显示一个或更多 resources</span><br><span class="line">  edit          在服务器上编辑一个资源</span><br><span class="line">  delete        Delete resources by filenames, stdin, resources and names, or by resources and label selector</span><br><span class="line">Deploy Commands:</span><br><span class="line">  rollout       Manage the rollout of a resource</span><br><span class="line">  scale         Set a new size for a Deployment, ReplicaSet or Replication Controller</span><br><span class="line">  autoscale     自动调整一个 Deployment, ReplicaSet, 或者 ReplicationController 的副本数量</span><br><span class="line">Cluster Management Commands:</span><br><span class="line">  certificate   修改 certificate 资源.</span><br><span class="line">  cluster-info  显示集群信息</span><br><span class="line">  top           Display Resource (CPU/Memory/Storage) usage.</span><br><span class="line">  cordon        标记 node 为 unschedulable</span><br><span class="line">  uncordon      标记 node 为 schedulable</span><br><span class="line">  drain         Drain node in preparation for maintenance</span><br><span class="line">  taint         更新一个或者多个 node 上的 taints</span><br><span class="line">Troubleshooting and Debugging Commands:</span><br><span class="line">  describe      显示一个指定 resource 或者 group 的 resources 详情</span><br><span class="line">  logs          输出容器在 pod 中的日志</span><br><span class="line">  attach        Attach 到一个运行中的 container</span><br><span class="line">  exec          在一个 container 中执行一个命令</span><br><span class="line">  port-forward  Forward one or more local ports to a pod</span><br><span class="line">  proxy         运行一个 proxy 到 Kubernetes API server</span><br><span class="line">  cp            复制 files 和 directories 到 containers 和从容器中复制 files 和 directories.</span><br><span class="line">  auth          Inspect authorization</span><br><span class="line">Advanced Commands:</span><br><span class="line">  diff          Diff live version against would-be applied version</span><br><span class="line">  apply         通过文件名或标准输入流(stdin)对资源进行配置</span><br><span class="line">  patch         使用 strategic merge patch 更新一个资源的 field(s)</span><br><span class="line">  replace       通过 filename 或者 stdin替换一个资源</span><br><span class="line">  wait          Experimental: Wait for a specific condition on one or many resources.</span><br><span class="line">  convert       在不同的 API versions 转换配置文件</span><br><span class="line">  kustomize     Build a kustomization target from a directory or a remote url.</span><br><span class="line">Settings Commands:</span><br><span class="line">  label         更新在这个资源上的 labels</span><br><span class="line">  annotate      更新一个资源的注解</span><br><span class="line">  completion    Output shell completion code for the specified shell (bash or zsh)</span><br><span class="line">Other Commands:</span><br><span class="line">  alpha         Commands for features in alpha</span><br><span class="line">  api-resources Print the supported API resources on the server</span><br><span class="line">  api-versions  Print the supported API versions on the server, in the form of &quot;group/version&quot;</span><br><span class="line">  config        修改 kubeconfig 文件</span><br><span class="line">  plugin        Provides utilities for interacting with plugins.</span><br><span class="line">  version       输出 client 和 server 的版本信息</span><br><span class="line">Usage:</span><br><span class="line">  kubectl [flags] [options]</span><br><span class="line">Use &quot;kubectl &lt;command&gt; --help&quot; for more information about a given command.</span><br><span class="line">Use &quot;kubectl options&quot; for a list of global command-line options (applies to all commands).</span><br></pre></td></tr></table></figure>


<p>经常使用的操作如下所示：</p>
<p>① 基本命令：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>翻译</th>
<th>命令作用</th>
</tr>
</thead>
<tbody><tr>
<td>create</td>
<td>创建</td>
<td>创建一个资源</td>
</tr>
<tr>
<td>edit</td>
<td>编辑</td>
<td>编辑一个资源</td>
</tr>
<tr>
<td>get</td>
<td>获取</td>
<td>获取一个资源</td>
</tr>
<tr>
<td>patch</td>
<td>更新</td>
<td>更新一个资源</td>
</tr>
<tr>
<td>delete</td>
<td>删除</td>
<td>删除一个资源</td>
</tr>
<tr>
<td>explain</td>
<td>解释</td>
<td>展示资源文档</td>
</tr>
</tbody></table>
<p>② 运行和调试：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>翻译</th>
<th>命令作用</th>
</tr>
</thead>
<tbody><tr>
<td>run</td>
<td>运行</td>
<td>在集群中运行一个指定的镜像</td>
</tr>
<tr>
<td>expose</td>
<td>暴露</td>
<td>暴露资源为Service</td>
</tr>
<tr>
<td>describe</td>
<td>描述</td>
<td>显示资源内部信息</td>
</tr>
<tr>
<td>logs</td>
<td>日志</td>
<td>输出容器在Pod中的日志</td>
</tr>
<tr>
<td>attach</td>
<td>缠绕</td>
<td>进入运行中的容器</td>
</tr>
<tr>
<td>exec</td>
<td>执行</td>
<td>执行容器中的一个命令</td>
</tr>
<tr>
<td>cp</td>
<td>复制</td>
<td>在Pod内外复制文件</td>
</tr>
<tr>
<td>rollout</td>
<td>首次展示</td>
<td>管理资源的发布</td>
</tr>
<tr>
<td>scale</td>
<td>规模</td>
<td>扩（缩）容Pod的数量</td>
</tr>
<tr>
<td>autoscale</td>
<td>自动调整</td>
<td>自动调整Pod的数量</td>
</tr>
</tbody></table>
<p>③ 高级命令：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>翻译</th>
<th>命令作用</th>
</tr>
</thead>
<tbody><tr>
<td>apply</td>
<td>应用</td>
<td>通过文件对资源进行配置</td>
</tr>
<tr>
<td>label</td>
<td>标签</td>
<td>更新资源上的标签</td>
</tr>
</tbody></table>
<p>④ 其他命令：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>翻译</th>
<th>命令作用</th>
</tr>
</thead>
<tbody><tr>
<td>cluster-info</td>
<td>集群信息</td>
<td>显示集群信息</td>
</tr>
<tr>
<td>version</td>
<td>版本</td>
<td>显示当前Client和Server的版本</td>
</tr>
</tbody></table>
<h4 id="3-2-3-资源类型（type）"><a href="#3-2-3-资源类型（type）" class="headerlink" title="3.2.3 资源类型（type）"></a><strong>3.2.3 资源类型（type）</strong></h4><p>kubernetes中所有的内容都抽象为资源，可以通过下面的命令进行查看：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl api-resources</span><br><span class="line">NAME                              SHORTNAMES   APIGROUP                       NAMESPACED   KIND</span><br><span class="line">bindings                                                                      true         Binding</span><br><span class="line">componentstatuses                 cs                                          false        ComponentStatus</span><br><span class="line">configmaps                        cm                                          true         ConfigMap</span><br><span class="line">endpoints                         ep                                          true         Endpoints</span><br><span class="line">events                            ev                                          true         Event</span><br><span class="line">limitranges                       limits                                      true         LimitRange</span><br><span class="line">namespaces                        ns                                          false        Namespace</span><br><span class="line">nodes                             no                                          false        Node</span><br><span class="line">persistentvolumeclaims            pvc                                         true         PersistentVolumeClaim</span><br><span class="line">persistentvolumes                 pv                                          false        PersistentVolume</span><br><span class="line">pods                              po                                          true         Pod</span><br><span class="line">podtemplates                                                                  true         PodTemplate</span><br><span class="line">replicationcontrollers            rc                                          true         ReplicationController</span><br><span class="line">resourcequotas                    quota                                       true         ResourceQuota</span><br><span class="line">secrets                                                                       true         Secret</span><br><span class="line">serviceaccounts                   sa                                          true         ServiceAccount</span><br><span class="line">services                          svc                                         true         Service</span><br><span class="line">mutatingwebhookconfigurations                  admissionregistration.k8s.io   false        MutatingWebhookConfiguration</span><br><span class="line">validatingwebhookconfigurations                admissionregistration.k8s.io   false        ValidatingWebhookConfiguration</span><br><span class="line">customresourcedefinitions         crd,crds     apiextensions.k8s.io           false        CustomResourceDefinition</span><br><span class="line">apiservices                                    apiregistration.k8s.io         false        APIService</span><br><span class="line">controllerrevisions                            apps                           true         ControllerRevision</span><br><span class="line">daemonsets                        ds           apps                           true         DaemonSet</span><br><span class="line">deployments                       deploy       apps                           true         Deployment</span><br><span class="line">replicasets                       rs           apps                           true         ReplicaSet</span><br><span class="line">statefulsets                      sts          apps                           true         StatefulSet</span><br><span class="line">tokenreviews                                   authentication.k8s.io          false        TokenReview</span><br><span class="line">localsubjectaccessreviews                      authorization.k8s.io           true         LocalSubjectAccessReview</span><br><span class="line">selfsubjectaccessreviews                       authorization.k8s.io           false        SelfSubjectAccessReview</span><br><span class="line">selfsubjectrulesreviews                        authorization.k8s.io           false        SelfSubjectRulesReview</span><br><span class="line">subjectaccessreviews                           authorization.k8s.io           false        SubjectAccessReview</span><br><span class="line">horizontalpodautoscalers          hpa          autoscaling                    true         HorizontalPodAutoscaler</span><br><span class="line">cronjobs                          cj           batch                          true         CronJob</span><br><span class="line">jobs                                           batch                          true         Job</span><br><span class="line">certificatesigningrequests        csr          certificates.k8s.io            false        CertificateSigningRequest</span><br><span class="line">leases                                         coordination.k8s.io            true         Lease</span><br><span class="line">endpointslices                                 discovery.k8s.io               true         EndpointSlice</span><br><span class="line">events                            ev           events.k8s.io                  true         Event</span><br><span class="line">ingresses                         ing          extensions                     true         Ingress</span><br><span class="line">ingressclasses                                 networking.k8s.io              false        IngressClass</span><br><span class="line">ingresses                         ing          networking.k8s.io              true         Ingress</span><br><span class="line">networkpolicies                   netpol       networking.k8s.io              true         NetworkPolicy</span><br><span class="line">runtimeclasses                                 node.k8s.io                    false        RuntimeClass</span><br><span class="line">poddisruptionbudgets              pdb          policy                         true         PodDisruptionBudget</span><br><span class="line">podsecuritypolicies               psp          policy                         false        PodSecurityPolicy</span><br><span class="line">clusterrolebindings                            rbac.authorization.k8s.io      false        ClusterRoleBinding</span><br><span class="line">clusterroles                                   rbac.authorization.k8s.io      false        ClusterRole</span><br><span class="line">rolebindings                                   rbac.authorization.k8s.io      true         RoleBinding</span><br><span class="line">roles                                          rbac.authorization.k8s.io      true         Role</span><br><span class="line">priorityclasses                   pc           scheduling.k8s.io              false        PriorityClass</span><br><span class="line">csidrivers                                     storage.k8s.io                 false        CSIDriver</span><br><span class="line">csinodes                                       storage.k8s.io                 false        CSINode</span><br><span class="line">storageclasses                    sc           storage.k8s.io                 false        StorageClass</span><br><span class="line">volumeattachments                              storage.k8s.io                 false        VolumeAttachment</span><br></pre></td></tr></table></figure>

<p>经常使用的资源如下所示：</p>
<p>① 集群级别资源：</p>
<table>
<thead>
<tr>
<th>资源名称</th>
<th>缩写</th>
<th>资源作用</th>
</tr>
</thead>
<tbody><tr>
<td>nodes</td>
<td>no</td>
<td>集群组成部分</td>
</tr>
<tr>
<td>namespaces</td>
<td>ns</td>
<td>隔离Pod</td>
</tr>
</tbody></table>
<p>② Pod资源：</p>
<table>
<thead>
<tr>
<th>资源名称</th>
<th>缩写</th>
<th>资源作用</th>
</tr>
</thead>
<tbody><tr>
<td>Pods</td>
<td>po</td>
<td>装载容器</td>
</tr>
</tbody></table>
<p>③ Pod资源控制器：</p>
<table>
<thead>
<tr>
<th>资源名称</th>
<th>缩写</th>
<th>资源作用</th>
</tr>
</thead>
<tbody><tr>
<td>replicationcontrollers</td>
<td>rc</td>
<td>控制Pod资源</td>
</tr>
<tr>
<td>replicasets</td>
<td>rs</td>
<td>控制Pod资源</td>
</tr>
<tr>
<td>deployments</td>
<td>deploy</td>
<td>控制Pod资源</td>
</tr>
<tr>
<td>daemonsets</td>
<td>ds</td>
<td>控制Pod资源</td>
</tr>
<tr>
<td>jobs</td>
<td></td>
<td>控制Pod资源</td>
</tr>
<tr>
<td>cronjobs</td>
<td>cj</td>
<td>控制Pod资源</td>
</tr>
<tr>
<td>horizontalpodautoscalers</td>
<td>hpa</td>
<td>控制Pod资源</td>
</tr>
<tr>
<td>statefulsets</td>
<td>sts</td>
<td>控制Pod资源</td>
</tr>
</tbody></table>
<p>④ 服务发现资源：</p>
<table>
<thead>
<tr>
<th>资源名称</th>
<th>缩写</th>
<th>资源作用</th>
</tr>
</thead>
<tbody><tr>
<td>services</td>
<td>svc</td>
<td>统一Pod对外接口</td>
</tr>
<tr>
<td>ingress</td>
<td>ing</td>
<td>统一Pod对外接口</td>
</tr>
</tbody></table>
<p>⑤ 存储资源：</p>
<table>
<thead>
<tr>
<th>资源名称</th>
<th>缩写</th>
<th>资源作用</th>
</tr>
</thead>
<tbody><tr>
<td>volumeattachments</td>
<td></td>
<td>存储</td>
</tr>
<tr>
<td>persistentvolumes</td>
<td>pv</td>
<td>存储</td>
</tr>
<tr>
<td>persistentvolumeclaims</td>
<td>pvc</td>
<td>存储</td>
</tr>
</tbody></table>
<p>⑥ 配置资源：</p>
<table>
<thead>
<tr>
<th>资源名称</th>
<th>缩写</th>
<th>资源作用</th>
</tr>
</thead>
<tbody><tr>
<td>configmaps</td>
<td>cm</td>
<td>配置</td>
</tr>
<tr>
<td>secrets</td>
<td></td>
<td>配置</td>
</tr>
</tbody></table>
<h4 id="3-2-4-应用示例"><a href="#3-2-4-应用示例" class="headerlink" title="3.2.4 应用示例"></a><strong>3.2.4 应用示例</strong></h4><p>示例：创建一个namespace</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl create ns test #ns为namespace简写</span><br><span class="line">namespace/test created</span><br></pre></td></tr></table></figure>

<p>示例：获取namespace</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get ns</span><br><span class="line">NAME                   STATUS   AGE</span><br><span class="line">default                Active   39h</span><br><span class="line">dev                    Active   15h</span><br><span class="line">kube-node-lease        Active   39h</span><br><span class="line">kube-public            Active   39h</span><br><span class="line">kube-system            Active   39h</span><br><span class="line">kubernetes-dashboard   Active   39h</span><br><span class="line">test                   Active   27s</span><br></pre></td></tr></table></figure>

<p>示例：在刚才创建的namespace下创建并运行一个Nginx的Pod</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl run nginx --image=192.168.20.119/library/nginx:latest -n test </span><br><span class="line">pod/nginx created</span><br></pre></td></tr></table></figure>

<p>示例：查看名为dev的namespace下的所有Pod，如果不加-n，默认就是default的namespace</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pods -n test</span><br><span class="line">NAME    READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx   1/1     Running   0          34s</span><br></pre></td></tr></table></figure>

<p>示例：删除指定namespace下的指定Pod</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl delete pod nginx -n test</span><br><span class="line">pod &quot;nginx&quot; deleted</span><br></pre></td></tr></table></figure>

<p>示例：删除指定的namespace</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl delete namespace test</span><br><span class="line">namespace &quot;test&quot; deleted</span><br></pre></td></tr></table></figure>

<h3 id="3-3-命令式对象配置"><a href="#3-3-命令式对象配置" class="headerlink" title="3.3 命令式对象配置"></a><strong>3.3 命令式对象配置</strong></h3><h4 id="3-3-1-概述"><a href="#3-3-1-概述" class="headerlink" title="3.3.1 概述"></a>3.3.1 概述</h4><p>命令式对象配置：通过命令配置和配置文件去操作kubernetes的资源。</p>
<h4 id="3-3-2-应用示例"><a href="#3-3-2-应用示例" class="headerlink" title="3.3.2 应用示例"></a>3.3.2 应用示例</h4><p>示例：<br>创建一个nginxpod.yaml，内容如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# cat nginxpod.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Namespace</span><br><span class="line">metadata:</span><br><span class="line">  name: test</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginxpod</span><br><span class="line">  namespace: dev</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">   - name: nginx-containers</span><br><span class="line">     image: 192.168.20.119/library/nginx:latest</span><br></pre></td></tr></table></figure>

<p>执行create命令，创建资源</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl create -f nginxpod.yaml </span><br><span class="line">namespace/test created</span><br><span class="line">pod/nginxpod created</span><br></pre></td></tr></table></figure>

<p> 执行get命令，查看资源：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get -f nginxpod.yaml </span><br><span class="line">NAME             STATUS   AGE</span><br><span class="line">namespace/test   Active   48s</span><br><span class="line"></span><br><span class="line">NAME           READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/nginxpod   1/1     Running   0          48s</span><br></pre></td></tr></table></figure>

<p>执行delete命令，删除资源：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl delete -f nginxpod.yaml </span><br><span class="line">namespace &quot;test&quot; deleted</span><br><span class="line">pod &quot;nginxpod&quot; deleted</span><br></pre></td></tr></table></figure>

<h4 id="3-3-3-总结"><a href="#3-3-3-总结" class="headerlink" title="3.3.3 总结"></a><strong>3.3.3 总结</strong></h4><p>命令式对象配置的方式操作资源，可以简单的认为：命令+yaml配置文件（里面是命令需要的各种参数）。</p>
<h3 id="3-4-声明式对象配置"><a href="#3-4-声明式对象配置" class="headerlink" title="3.4 声明式对象配置"></a><strong>3.4 声明式对象配置</strong></h3><h4 id="3-4-1-概述"><a href="#3-4-1-概述" class="headerlink" title="3.4.1 概述"></a><strong>3.4.1 概述</strong></h4><p>声明式对象配置：通过apply命令和配置文件去操作kubernetes的资源。<br>声明式对象配置和命令式对象配置类似，只不过它只有一个apply命令。<br>apply相当于create和patch。</p>
<h4 id="3-4-2-应用示例"><a href="#3-4-2-应用示例" class="headerlink" title="3.4.2 应用示例"></a><strong>3.4.2 应用示例</strong></h4><p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl apply -f nginxpod.yaml </span><br><span class="line">namespace/test created</span><br><span class="line">pod/nginxpod created</span><br></pre></td></tr></table></figure>

<h4 id="3-4-3-总结"><a href="#3-4-3-总结" class="headerlink" title="3.4.3 总结"></a>3.4.3 总结</h4><p>声明式对象配置就是使用apply描述一个资源的最终状态（在yaml中定义状态）。<br>使用apply操作资源：<br>如果资源不存在，就创建，相当于kubectl create。<br>如果资源存在，就更新，相当于kubectl patch。</p>
<h3 id="3-5-使用方式推荐"><a href="#3-5-使用方式推荐" class="headerlink" title="3.5 使用方式推荐"></a>3.5 使用方式推荐</h3><p>●创建和更新资源使用声明式对象配置：kubectl apply -f xxx.yaml。<br>●删除资源使用命令式对象配置：kubectl delete -f xxx.yaml。<br>●查询资源使用命令式对象管理：kubectl get(describe) 资源名称。</p>
<h3 id="3-6-扩展：kubectl可以在Node上运行"><a href="#3-6-扩展：kubectl可以在Node上运行" class="headerlink" title="3.6 扩展：kubectl可以在Node上运行"></a><strong>3.6 扩展：kubectl可以在Node上运行</strong></h3><p>kubectl的运行需要进行配置，它的配置文件是$HOME&#x2F;.kube，如果想要在Node节点上运行此命令，需要将Master节点的.kube文件夹复制到Node节点上，即在Master节点上执行下面的操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# scp -r /root/.kube/ root@node1:/root/</span><br></pre></td></tr></table></figure>

<h2 id="4-如何快速的编写yaml文件"><a href="#4-如何快速的编写yaml文件" class="headerlink" title="4 如何快速的编写yaml文件"></a><strong>4 如何快速的编写yaml文件</strong></h2><p>此种方式适用于没有真正部署资源。<br>使用kubectl create命令生成yaml文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl create deployment nginx --image=192.168.20.119/library/nginx:latest --dry-run=client -n dev -o yaml &gt; test.yaml</span><br><span class="line">[root@master ~]# cat test.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: null</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">  name: nginx</span><br><span class="line">  namespace: dev</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  strategy: &#123;&#125;</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      creationTimestamp: null</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - image: 192.168.20.119/library/nginx:latest</span><br><span class="line">        name: nginx</span><br><span class="line">        resources: &#123;&#125;</span><br><span class="line">status: &#123;&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/05/20/k8s%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0day3/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          k8s学习日记day3
        
      </div>
    </a>
  
  
    <a href="/2022/05/16/k8s%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0day1/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">k8s学习日记day1</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>






</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2023 Miss
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/preccrep/hexo-theme-jelly" target="_blank">Jelly</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




  </div>
</body>
</html>