<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>k8s学习日记day3 | Misswjy&#39;Blog</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="kubernetes的实战入门">
<meta property="og:type" content="article">
<meta property="og:title" content="k8s学习日记day3">
<meta property="og:url" content="http://example.com/2022/05/20/k8s%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0day3/index.html">
<meta property="og:site_name" content="Misswjy&#39;Blog">
<meta property="og:description" content="kubernetes的实战入门">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2022/05/20/k8s%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0day3/1609137223448-715c6ece-0158-4ee2-9efa-fcff15e143ed.png">
<meta property="og:image" content="http://example.com/2022/05/20/k8s%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0day3/1609137432883-b2ec0213-7c10-4efa-9689-066a4e239a74.png">
<meta property="og:image" content="http://example.com/2022/05/20/k8s%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0day3/1609137571725-a4754fdb-d0a1-4a49-a7a4-169fc6cc9703.png">
<meta property="article:published_time" content="2022-05-20T02:46:12.000Z">
<meta property="article:modified_time" content="2022-05-23T10:18:42.000Z">
<meta property="article:author" content="Miss">
<meta property="article:tag" content="k8s">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/05/20/k8s%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0day3/1609137223448-715c6ece-0158-4ee2-9efa-fcff15e143ed.png">
  
    <link rel="alternative" href="/atom.xml" title="Misswjy&#39;Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
<meta name="generator" content="Hexo 6.1.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
				<img lazy-src="/img/avatar.png" class="js-avatar">
			
		</a>

		<hgroup>
			<h1 class="header-author"><a href="/">Miss</a></h1>
		</hgroup>

		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">Home</a></li>
				        
							<li><a href="/archives">Archives</a></li>
				        
						</ul>
					</nav>
					<nav class="half-header-menu">
						<a class="hide">Home</a>
						<a>Tags</a>
						<a>Links</a>
						<a>About</a>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/Misswjy" title="github">github</a>
					        
								<a class="mail" target="_blank" href="/dockery@foxmail.com" title="mail">mail</a>
					        
								<a class="bilibili" target="_blank" href="https://space.bilibili.com/292671654" title="bilibili">bilibili</a>
					        
						</div>
						<!-- music -->
						
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/k8s/" style="font-size: 15px;">k8s</a> <a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 12.5px;">云计算</a> <a href="/tags/%E5%AE%B9%E5%99%A8%E4%BA%91/" style="font-size: 17.5px;">容器云</a> <a href="/tags/%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2%E5%92%8C%E8%BF%90%E7%BB%B4/" style="font-size: 10px;">应用部署和运维</a> <a href="/tags/%E7%A7%81%E6%9C%89%E4%BA%91/" style="font-size: 20px;">私有云</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/">github</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">I&#39;m a developer.</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/avatar.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">Home</a></li>
		        
					<li><a href="/archives">Archives</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Misswjy" title="github">github</a>
			        
						<a class="mail" target="_blank" href="/dockery@foxmail.com" title="mail">mail</a>
			        
						<a class="bilibili" target="_blank" href="https://space.bilibili.com/292671654" title="bilibili">bilibili</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-k8s学习日记day3" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/05/20/k8s%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0day3/" class="article-date">
  	<time datetime="2022-05-20T02:46:12.000Z" itemprop="datePublished">2022-05-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      k8s学习日记day3
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li></ul>
	</div>

        

        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="kubernetes的实战入门"><a href="#kubernetes的实战入门" class="headerlink" title="kubernetes的实战入门"></a>kubernetes的实战入门<span id="more"></span></h1><h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1 前言"></a>1 前言</h2><ul>
<li>介绍如何在kubernetes集群中部署一个Nginx服务，并且能够对其访问。</li>
</ul>
<h2 id="2-Namespace"><a href="#2-Namespace" class="headerlink" title="2 Namespace"></a>2 Namespace</h2><h3 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1 概述"></a>2.1 概述</h3><ul>
<li><p>Namespace是kubernetes系统中一种非常重要的资源，它的主要作用是用来实现<code>多套系统的资源隔离</code>或者<code>多租户的资源隔离</code>。</p>
</li>
<li><p>默认情况下，kubernetes集群中的所有Pod都是可以相互访问的。但是在实际中，可能不想让两个Pod之间进行互相的访问，那么此时就可以将两个Pod划分到不同的Namespace下。kubernetes通过将集群内部的资源分配到不同的Namespace中，可以形成逻辑上的“组”，以方便不同的组的资源进行隔离使用和管理。</p>
</li>
<li><p>可以通过kubernetes的授权机制，将不同的Namespace交给不同租户进行管理，这样就实现了多租户的资源隔离。此时还能结合kubernetes的资源配额机制，限定不同租户能占用的资源，例如CPU使用量、内存使用量等等，来实现租户可用资源的管理。</p>
</li>
</ul>
<p><strong>kubernetes在集群启动之后，会默认创建几个namespace。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get ns</span><br><span class="line">NAME                   STATUS   AGE</span><br><span class="line">default                Active   2d14h #自动创建</span><br><span class="line">dev                    Active   39h</span><br><span class="line">kube-node-lease        Active   2d14h #自动创建</span><br><span class="line">kube-public            Active   2d14h #自动创建</span><br><span class="line">kube-system            Active   2d14h #自动创建</span><br><span class="line">kubernetes-dashboard   Active   2d14h</span><br><span class="line">test                   Active   23h</span><br></pre></td></tr></table></figure>

<ul>
<li><p>default：所有未指定的Namespace的对象都会被分配在default命名空间。</p>
</li>
<li><p>kube-node-lease：集群节点之间的心跳维护，v1.13开始引入。</p>
</li>
<li><p>kube-public：此命名空间的资源可以被所有人访问（包括未认证用户）。</p>
</li>
<li><p>kube-system：所有由kubernetes系统创建的资源都处于这个命名空间。</p>
</li>
</ul>
<h3 id="2-2-应用示例"><a href="#2-2-应用示例" class="headerlink" title="2.2 应用示例"></a>2.2 应用示例</h3><ul>
<li>示例：查看所有的命名空间</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get ns</span><br><span class="line">NAME                   STATUS   AGE</span><br><span class="line">default                Active   2d14h</span><br><span class="line">dev                    Active   39h</span><br><span class="line">kube-node-lease        Active   2d14h</span><br><span class="line">kube-public            Active   2d14h</span><br><span class="line">kube-system            Active   2d14h</span><br><span class="line">kubernetes-dashboard   Active   2d14h</span><br><span class="line">test                   Active   23h</span><br></pre></td></tr></table></figure>

<ul>
<li>示例：查看指定的命名空间</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get ns default</span><br><span class="line">NAME      STATUS   AGE</span><br><span class="line">default   Active   2d14h</span><br></pre></td></tr></table></figure>

<ul>
<li>示例：指定命名空间的输出格式</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get ns default -o wide</span><br><span class="line">NAME      STATUS   AGE</span><br><span class="line">default   Active   2d14h</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get ns default -o json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;apiVersion&quot;: &quot;v1&quot;,</span><br><span class="line">    &quot;kind&quot;: &quot;Namespace&quot;,</span><br><span class="line">    &quot;metadata&quot;: &#123;</span><br><span class="line">        &quot;creationTimestamp&quot;: &quot;2022-05-18T05:17:51Z&quot;,</span><br><span class="line">        &quot;managedFields&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;apiVersion&quot;: &quot;v1&quot;,</span><br><span class="line">                &quot;fieldsType&quot;: &quot;FieldsV1&quot;,</span><br><span class="line">                &quot;fieldsV1&quot;: &#123;</span><br><span class="line">                    &quot;f:status&quot;: &#123;</span><br><span class="line">                        &quot;f:phase&quot;: &#123;&#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;manager&quot;: &quot;kube-apiserver&quot;,</span><br><span class="line">                &quot;operation&quot;: &quot;Update&quot;,</span><br><span class="line">                &quot;time&quot;: &quot;2022-05-18T05:17:51Z&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        &quot;name&quot;: &quot;default&quot;,</span><br><span class="line">        &quot;resourceVersion&quot;: &quot;152&quot;,</span><br><span class="line">        &quot;selfLink&quot;: &quot;/api/v1/namespaces/default&quot;,</span><br><span class="line">        &quot;uid&quot;: &quot;de6edb5b-6b5d-4f5a-a901-f840831bc796&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;spec&quot;: &#123;</span><br><span class="line">        &quot;finalizers&quot;: [</span><br><span class="line">            &quot;kubernetes&quot;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;status&quot;: &#123;</span><br><span class="line">        &quot;phase&quot;: &quot;Active&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get ns default -o yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Namespace</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: &quot;2022-05-18T05:17:51Z&quot;</span><br><span class="line">  managedFields:</span><br><span class="line"></span><br><span class="line">  - apiVersion: v1</span><br><span class="line">    fieldsType: FieldsV1</span><br><span class="line">    fieldsV1:</span><br><span class="line">      f:status:</span><br><span class="line">        f:phase: &#123;&#125;</span><br><span class="line">    manager: kube-apiserver</span><br><span class="line">    operation: Update</span><br><span class="line">    time: &quot;2022-05-18T05:17:51Z&quot;</span><br><span class="line">      name: default</span><br><span class="line">      resourceVersion: &quot;152&quot;</span><br><span class="line">      selfLink: /api/v1/namespaces/default</span><br><span class="line">      uid: de6edb5b-6b5d-4f5a-a901-f840831bc796</span><br><span class="line">    spec:</span><br><span class="line">      finalizers:</span><br><span class="line">  - kubernetes</span><br><span class="line">    status:</span><br><span class="line">      phase: Active</span><br></pre></td></tr></table></figure>

<ul>
<li>示例：查看命名空间的详情</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl describe ns default</span><br><span class="line">Name:         default</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line">Status:       Active #Active表示命名空间正在使用中，Terminating表示正在删除</span><br><span class="line"></span><br><span class="line">No resource quota.</span><br><span class="line"></span><br><span class="line">No LimitRange resource.</span><br></pre></td></tr></table></figure>

<ul>
<li>示例：创建命名空间</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl create ns dev</span><br><span class="line">namespace/dev created</span><br><span class="line">[root@master ~]# kubectl get ns </span><br><span class="line">NAME                   STATUS   AGE</span><br><span class="line">default                Active   2d14h</span><br><span class="line">dev                    Active   45s</span><br><span class="line">kube-node-lease        Active   2d14h</span><br><span class="line">kube-public            Active   2d14h</span><br><span class="line">kube-system            Active   2d14h</span><br><span class="line">kubernetes-dashboard   Active   2d14h</span><br></pre></td></tr></table></figure>

<ul>
<li>示例：删除命名空间</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get ns </span><br><span class="line">NAME                   STATUS   AGE</span><br><span class="line">default                Active   2d14h</span><br><span class="line">dev                    Active   45s</span><br><span class="line">kube-node-lease        Active   2d14h</span><br><span class="line">kube-public            Active   2d14h</span><br><span class="line">kube-system            Active   2d14h</span><br><span class="line">kubernetes-dashboard   Active   2d14h</span><br><span class="line">[root@master ~]# kubectl delete ns dev</span><br><span class="line">namespace &quot;dev&quot; deleted</span><br><span class="line">[root@master ~]# kubectl get ns</span><br><span class="line">NAME                   STATUS   AGE</span><br><span class="line">default                Active   2d15h</span><br><span class="line">kube-node-lease        Active   2d15h</span><br><span class="line">kube-public            Active   2d15h</span><br><span class="line">kube-system            Active   2d15h</span><br><span class="line">kubernetes-dashboard   Active   2d14h</span><br></pre></td></tr></table></figure>

<ul>
<li>示例：命令式对象配置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# cat ns-dev.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Namespace</span><br><span class="line">metadata:</span><br><span class="line">  name: dev</span><br><span class="line">[root@master ~]# kubectl create -f ns-dev.yaml </span><br><span class="line">namespace/dev created</span><br><span class="line">[root@master ~]# kubectl get ns</span><br><span class="line">NAME                   STATUS   AGE</span><br><span class="line">default                Active   2d15h</span><br><span class="line">dev                    Active   4s</span><br><span class="line">kube-node-lease        Active   2d15h</span><br><span class="line">kube-public            Active   2d15h</span><br><span class="line">kube-system            Active   2d15h</span><br><span class="line">kubernetes-dashboard   Active   2d14h</span><br><span class="line">[root@master ~]# kubectl delete -f ns-dev.yaml </span><br><span class="line">namespace &quot;dev&quot; deleted</span><br><span class="line">[root@master ~]# kubectl get ns</span><br><span class="line">NAME                   STATUS   AGE</span><br><span class="line">default                Active   2d15h</span><br><span class="line">kube-node-lease        Active   2d15h</span><br><span class="line">kube-public            Active   2d15h</span><br><span class="line">kube-system            Active   2d15h</span><br><span class="line">kubernetes-dashboard   Active   2d14h</span><br></pre></td></tr></table></figure>

<h2 id="3-Pod"><a href="#3-Pod" class="headerlink" title="3 Pod"></a>3 Pod</h2><h3 id="3-1-概述"><a href="#3-1-概述" class="headerlink" title="3.1 概述"></a>3.1 概述</h3><ul>
<li><p>Pod是kubernetes集群进行管理的最小单元，程序要运行必须部署在容器中，而容器必须存在于Pod中。</p>
</li>
<li><p>Pod可以认为是容器的封装，一个Pod中可以存在一个或多个容器。</p>
</li>
</ul>
<img src="/2022/05/20/k8s%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0day3/1609137223448-715c6ece-0158-4ee2-9efa-fcff15e143ed.png" class="" title="img">

<ul>
<li>kubernetes在集群启动之后，集群中的各个组件也是以Pod方式运行的，可以通过下面的命令查看：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pods -n kube-system</span><br><span class="line">NAME                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-6fcfc67db4-6tdxr         1/1     Running   0          2d15h</span><br><span class="line">coredns-6fcfc67db4-b6m9j         1/1     Running   0          2d15h</span><br><span class="line">etcd-master                      1/1     Running   0          2d15h</span><br><span class="line">kube-apiserver-master            1/1     Running   0          2d15h</span><br><span class="line">kube-controller-manager-master   1/1     Running   0          2d15h</span><br><span class="line">kube-flannel-ds-l4trs            1/1     Running   0          2d14h</span><br><span class="line">kube-flannel-ds-lbrnt            1/1     Running   1          2d14h</span><br><span class="line">kube-flannel-ds-xpdl2            1/1     Running   0          2d14h</span><br><span class="line">kube-proxy-d7vxn                 1/1     Running   0          2d15h</span><br><span class="line">kube-proxy-gfnq5                 1/1     Running   0          2d14h</span><br><span class="line">kube-proxy-x8qgm                 1/1     Running   0          2d14h</span><br><span class="line">kube-scheduler-master            1/1     Running   0          2d15h</span><br></pre></td></tr></table></figure>

<h3 id="3-2-语法及应用示例"><a href="#3-2-语法及应用示例" class="headerlink" title="3.2 语法及应用示例"></a>3.2 语法及应用示例</h3><ul>
<li>语法：创建并运行Pod</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl run (Pod的名称) [参数]</span><br><span class="line"># --image 指定Pod的镜像</span><br><span class="line"># --port 指定端口</span><br><span class="line"># --namespace 指定namespace</span><br></pre></td></tr></table></figure>

<ul>
<li>示例：在名称为dev的namespace下创建一个Nginx的Pod</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl run nginx --image=192.168.20.119/library/nginx:latest --port 80 -n dev</span><br><span class="line">pod/nginx created</span><br></pre></td></tr></table></figure>

<ul>
<li>语法： 查询所有Pod的基本信息</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pods -n dev</span><br><span class="line">NAME    READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx   1/1     Running   0          6s</span><br></pre></td></tr></table></figure>

<ul>
<li>语法：查看Pod的详细信息</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl describe pods -n dev</span><br><span class="line">Name:         nginx</span><br><span class="line">Namespace:    dev</span><br><span class="line">Priority:     0</span><br><span class="line">Node:         node2/192.168.20.124</span><br><span class="line">Start Time:   Fri, 20 May 2022 20:29:32 +0000</span><br><span class="line">Labels:       run=nginx</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line">Status:       Running</span><br><span class="line">IP:           10.244.2.13</span><br><span class="line">IPs:</span><br><span class="line">  IP:  10.244.2.13</span><br><span class="line">Containers:</span><br><span class="line">  nginx:</span><br><span class="line">    Container ID:   docker://a524a5ec4c57ed61996ef2e06580cafe19254aa2ed2ac079a07e5e0e1bfda589</span><br><span class="line">    Image:          192.168.20.119/library/nginx:latest</span><br><span class="line">    Image ID:       docker-pullable://192.168.20.119/library/nginx@sha256:416d511ffa63777489af47f250b70d1570e428b67666567085f2bece3571ad83</span><br><span class="line">    Port:           80/TCP</span><br><span class="line">    Host Port:      0/TCP</span><br><span class="line">    State:          Running</span><br><span class="line">      Started:      Fri, 20 May 2022 20:29:33 +0000</span><br><span class="line">    Ready:          True</span><br><span class="line">    Restart Count:  0</span><br><span class="line">    Environment:    &lt;none&gt;</span><br><span class="line">    Mounts:</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from default-token-chm54 (ro)</span><br><span class="line">Conditions:</span><br><span class="line">  Type              Status</span><br><span class="line">  Initialized       True </span><br><span class="line">  Ready             True </span><br><span class="line">  ContainersReady   True </span><br><span class="line">  PodScheduled      True </span><br><span class="line">Volumes:</span><br><span class="line">  default-token-chm54:</span><br><span class="line">    Type:        Secret (a volume populated by a Secret)</span><br><span class="line">    SecretName:  default-token-chm54</span><br><span class="line">    Optional:    false</span><br><span class="line">QoS Class:       BestEffort</span><br><span class="line">Node-Selectors:  &lt;none&gt;</span><br><span class="line">Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s</span><br><span class="line">                 node.kubernetes.io/unreachable:NoExecute for 300s</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason     Age   From               Message</span><br><span class="line"></span><br><span class="line">----    ------     ----  ----               -------</span><br><span class="line"></span><br><span class="line">  Normal  Scheduled  2m3s  default-scheduler  Successfully assigned dev/nginx to node2</span><br><span class="line">  Normal  Pulling    2m2s  kubelet, node2     Pulling image &quot;192.168.20.119/library/nginx:latest&quot;</span><br><span class="line">  Normal  Pulled     2m2s  kubelet, node2     Successfully pulled image &quot;192.168.20.119/library/nginx:latest&quot;</span><br><span class="line">  Normal  Created    2m2s  kubelet, node2     Created container nginx</span><br><span class="line">  Normal  Started    2m2s  kubelet, node2     Started container nginx</span><br></pre></td></tr></table></figure>

<ul>
<li>语法：Pod的访问</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pods -o wide -n dev</span><br><span class="line">NAME    READY   STATUS    RESTARTS   AGE     IP            NODE    NOMINATED NODE   READINESS GATES</span><br><span class="line">nginx   1/1     Running   0          3m18s   10.244.2.13   node2   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">[root@master ~]# curl 10.244.2.13:80</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>语法：删除指定的Pod</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl delete pods nginx -n dev</span><br><span class="line">pod &quot;nginx&quot; deleted</span><br><span class="line">[root@master ~]# kubectl get pods -n dev</span><br><span class="line">No resources found in dev namespace.</span><br></pre></td></tr></table></figure>

<ul>
<li>示例：命令式对象配置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# cat pod-nginx.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx</span><br><span class="line">  namespace: dev</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line"></span><br><span class="line">  - image: 192.168.20.119/library/nginx:latest</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    name: pod</span><br><span class="line">    ports: </span><br><span class="line">    - name: nginx-port</span><br><span class="line">      containerPort: 80</span><br><span class="line">      protocol: TCP</span><br><span class="line">[root@master ~]# kubectl create -f pod-nginx.yaml </span><br><span class="line">pod/nginx created</span><br><span class="line">[root@master ~]# kubectl get pods -n dev</span><br><span class="line">NAME    READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx   1/1     Running   0          6s</span><br><span class="line">[root@master ~]# kubectl delete -f pod-nginx.yaml </span><br><span class="line">pod &quot;nginx&quot; deleted</span><br><span class="line">[root@master ~]# kubectl get pods -n dev</span><br><span class="line">No resources found in dev namespace.</span><br></pre></td></tr></table></figure>

<h2 id="4-Label"><a href="#4-Label" class="headerlink" title="4 Label"></a>4 Label</h2><h3 id="4-1-概述"><a href="#4-1-概述" class="headerlink" title="4.1 概述"></a>4.1 概述</h3><ul>
<li><p>Label是kubernetes的一个重要概念。它的作用就是在资源上添加标识，用来对它们进行区分和选择。</p>
</li>
<li><p>Label的特点：</p>
</li>
<li><ul>
<li>一个Label会以key&#x2F;value键值对的形式附加到各种对象上，如Node、Pod、Service等。</li>
</ul>
</li>
<li><ul>
<li>一个资源对象可以定义任意数量的Label，同一个Label也可以被添加到任意数量的资源对象上去。</li>
</ul>
</li>
<li><ul>
<li>Label通常在资源对象定义时确定，当然也可以在对象创建后动态的添加或删除。</li>
</ul>
</li>
<li><p>可以通过Label实现资源的多纬度分组，以便灵活、方便地进行资源分配、调度、配置和部署等管理工作。</p>
</li>
</ul>
<p><strong>一些常用的Label标签示例如下：</strong></p>
<blockquote>
<ul>
<li><p>版本标签：“version”:”release”,”version”:”stable”。。。</p>
</li>
<li><p>环境标签：“environment”:”dev”,“environment”:”test”,“environment”:”pro”。。。</p>
</li>
<li><p>架构标签：“tier”:”frontend”,”tier”:”backend”。。。</p>
</li>
</ul>
</blockquote>
<ul>
<li><p>标签定义完毕之后，还要考虑到标签的选择，这就要用到Label Selector，即：</p>
</li>
<li><ul>
<li>Label用于给某个资源对象定义标识。</li>
</ul>
</li>
<li><ul>
<li>Label Selector用于查询和筛选拥有某些标签的资源对象。</li>
</ul>
</li>
<li><p>当前有两种Label Selector：</p>
</li>
<li><ul>
<li>基于等式的Label Selector。</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>name&#x3D;slave：选择所有包含Label中的key&#x3D;“name”并且value&#x3D;“slave”的对象。</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>env!&#x3D;production：选择所有包含Label中的key&#x3D;“env”并且value!&#x3D;“production”的对象。</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>基于集合的Label Selector。</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>name in (master,slave)：选择所有包含Label中的key&#x3D;“name”并且value&#x3D;“master”或value&#x3D;“slave”的对象。</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>name not in (master,slave)：选择所有包含Label中的key&#x3D;“name”并且value!&#x3D;“master”和value!&#x3D;“slave”的对象。</li>
</ul>
</li>
</ul>
</li>
<li><p>标签的选择条件可以使用多个，此时将多个Label Selector进行组合，使用逗号（,）进行分隔即可。</p>
</li>
<li><ul>
<li>name&#x3D;salve,env!&#x3D;production。</li>
</ul>
</li>
<li><ul>
<li>name not in (master,slave),env!&#x3D;production。</li>
</ul>
</li>
</ul>
<h3 id="4-2-语法及应用示例"><a href="#4-2-语法及应用示例" class="headerlink" title="4.2 语法及应用示例"></a>4.2 语法及应用示例</h3><ul>
<li>语法：为资源打标签</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl label pod nginx version=2.0 -n dev</span><br><span class="line">pod/nginx labeled</span><br><span class="line">[root@master ~]# kubectl get pods -n dev --show-labels</span><br><span class="line">NAME    READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">nginx   1/1     Running   0          13m   version=2.0</span><br></pre></td></tr></table></figure>

<ul>
<li>语法：更新资源的标签</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl label pod nginx version=3.0 -n dev --overwrite</span><br><span class="line">pod/nginx labeled</span><br><span class="line">[root@master ~]# kubectl get pods -n dev --show-labels</span><br><span class="line">NAME    READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">nginx   1/1     Running   0          15m   version=3.0</span><br></pre></td></tr></table></figure>

<ul>
<li>示例：显示Nginx的Pod的标签</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pods -n dev --show-labels</span><br><span class="line">NAME    READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">nginx   1/1     Running   0          15m   version=3.0</span><br></pre></td></tr></table></figure>

<ul>
<li>语法：筛选标签</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pods -l version=3.0 -n dev --show-labels</span><br><span class="line">NAME    READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">nginx   1/1     Running   0          16m   version=3.0</span><br></pre></td></tr></table></figure>

<ul>
<li>语法：删除标签</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl label pods nginx -n dev version-</span><br><span class="line">pod/nginx labeled</span><br><span class="line">[root@master ~]# kubectl get pods -n dev --show-labels</span><br><span class="line">NAME    READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">nginx   1/1     Running   0          18m   &lt;none&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>示例：命令式对象配置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# cat pod-nginx.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx</span><br><span class="line">  namespace: dev</span><br><span class="line">  labels:</span><br><span class="line">    version: &quot;3.0&quot;</span><br><span class="line">    env: &quot;test&quot;</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - image: 192.168.20.119/library/nginx:latest</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    name: pod</span><br><span class="line">    ports: </span><br><span class="line">    - name: nginx-port</span><br><span class="line">      containerPort: 80</span><br><span class="line">      protocol: TCP</span><br><span class="line">[root@master ~]# kubectl apply -f pod-nginx.yaml </span><br><span class="line">Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply</span><br><span class="line">pod/nginx configured</span><br><span class="line">[root@master ~]# kubectl get pods -n dev --show-labels</span><br><span class="line">NAME    READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">nginx   1/1     Running   0          20m   env=test,version=3.0</span><br></pre></td></tr></table></figure>

<h2 id="5-Deployment"><a href="#5-Deployment" class="headerlink" title="5 Deployment"></a>5 Deployment</h2><h3 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1 概述"></a>5.1 概述</h3><ul>
<li><p>在kubernetes中，Pod是最小的控制单元，但是kubernetes很少直接控制Pod，一般都是通过Pod控制器来完成的。</p>
</li>
<li><p>Pod控制器用于Pod的管理，确保Pod资源符合预期的状态，当Pod的资源出现故障的时候，会尝试进行重启或重建Pod。</p>
</li>
<li><p>在kubernetes中Pod控制器的种类有很多，本章节只介绍一种：Deployment。</p>
</li>
</ul>
<img src="/2022/05/20/k8s%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0day3/1609137432883-b2ec0213-7c10-4efa-9689-066a4e239a74.png" class="" title="img">

<h3 id="5-2-语法及应用示例"><a href="#5-2-语法及应用示例" class="headerlink" title="5.2 语法及应用示例"></a>5.2 语法及应用示例</h3><blockquote>
<p>特别注意：在v1.18版之后，kubectl run nginx –image&#x3D;nginx –replicas&#x3D;2 –port&#x3D;80，会反馈Flag –replicas has been deprecated, has no effect and will be removed in the future，并且只会创建一个Nginx容器实例。</p>
</blockquote>
<ul>
<li>示例：在名称为test的命名空间下创建名为nginx的deployment</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl create ns test</span><br><span class="line">namespace/test created</span><br><span class="line">[root@master ~]# kubectl create deploy nginx --image=192.168.20.119/library/nginx:latest -n test</span><br><span class="line">deployment.apps/nginx created</span><br><span class="line">[root@master ~]# kubectl get deploy -n test</span><br><span class="line">NAME    READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx   1/1     1            1           18s</span><br></pre></td></tr></table></figure>

<ul>
<li>示例：在名称为test的命名空间下根据名为nginx的deployment创建3个Pod</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl scale deploy nginx --replicas=3 -n test</span><br><span class="line">deployment.apps/nginx scaled</span><br><span class="line">[root@master ~]# kubectl get pods -n test</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-56669589d9-h67ng   1/1     Running   0          3s</span><br><span class="line">nginx-56669589d9-l2vb5   1/1     Running   0          3s</span><br><span class="line">nginx-56669589d9-lmp9k   1/1     Running   0          2m55s</span><br></pre></td></tr></table></figure>

<ul>
<li>语法：命令式对象配置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# cat deploy-nginx.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx</span><br><span class="line">  namespace: dev</span><br><span class="line">spec:</span><br><span class="line">  replicas: 3</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      run: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        run: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - image: 192.168.20.119/library/nginx:latest</span><br><span class="line">        name: nginx</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">          protocol: TCP</span><br><span class="line">[root@master ~]# kubectl create -f deploy-nginx.yaml </span><br><span class="line">deployment.apps/nginx created</span><br><span class="line">[root@master ~]# kubectl get pods -n dev</span><br><span class="line">NAME                   READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-85dbb646-fqft8   1/1     Running   0          3s</span><br><span class="line">nginx-85dbb646-lnhjp   1/1     Running   0          3s</span><br><span class="line">nginx-85dbb646-w4pjb   1/1     Running   0          3s</span><br><span class="line">[root@master ~]# kubectl get deploy -n dev</span><br><span class="line">NAME    READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx   3/3     3            3           46s</span><br></pre></td></tr></table></figure>

<ul>
<li>示例：查看名为dev的namespace下的名为nginx的deployment的详细信息</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl describe deploy nginx -n dev</span><br><span class="line">Name:                   nginx</span><br><span class="line">Namespace:              dev</span><br><span class="line">CreationTimestamp:      Fri, 20 May 2022 22:59:19 +0000</span><br><span class="line">Labels:                 &lt;none&gt;</span><br><span class="line">Annotations:            deployment.kubernetes.io/revision: 1</span><br><span class="line">Selector:               run=nginx</span><br><span class="line">Replicas:               3 desired | 3 updated | 3 total | 3 available | 0 unavailable</span><br><span class="line">StrategyType:           RollingUpdate</span><br><span class="line">MinReadySeconds:        0</span><br><span class="line">RollingUpdateStrategy:  25% max unavailable, 25% max surge</span><br><span class="line">Pod Template:</span><br><span class="line">  Labels:  run=nginx</span><br><span class="line">  Containers:</span><br><span class="line">   nginx:</span><br><span class="line">    Image:        192.168.20.119/library/nginx:latest</span><br><span class="line">    Port:         80/TCP</span><br><span class="line">    Host Port:    0/TCP</span><br><span class="line">    Environment:  &lt;none&gt;</span><br><span class="line">    Mounts:       &lt;none&gt;</span><br><span class="line">  Volumes:        &lt;none&gt;</span><br><span class="line">Conditions:</span><br><span class="line">  Type           Status  Reason</span><br><span class="line"></span><br><span class="line">----           ------  ------</span><br><span class="line"></span><br><span class="line">  Available      True    MinimumReplicasAvailable</span><br><span class="line">  Progressing    True    NewReplicaSetAvailable</span><br><span class="line">OldReplicaSets:  &lt;none&gt;</span><br><span class="line">NewReplicaSet:   nginx-85dbb646 (3/3 replicas created)</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason             Age    From                   Message</span><br><span class="line"></span><br><span class="line">----    ------             ----   ----                   -------</span><br><span class="line"></span><br><span class="line">  Normal  ScalingReplicaSet  2m17s  deployment-controller  Scaled up replica set nginx-85dbb646 to 3</span><br></pre></td></tr></table></figure>

<ul>
<li>示例：删除名为dev的namespace下的名为nginx的deployment</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl delete deploy nginx -n dev</span><br><span class="line">deployment.apps &quot;nginx&quot; deleted</span><br><span class="line">[root@master ~]# kubectl get pods -n dev</span><br><span class="line">No resources found in dev namespace.</span><br></pre></td></tr></table></figure>

<h2 id="6-Service"><a href="#6-Service" class="headerlink" title="6 Service"></a>6 Service</h2><h3 id="6-1-概述"><a href="#6-1-概述" class="headerlink" title="6.1 概述"></a>6.1 概述</h3><ul>
<li><p>我们已经能够利用Deployment来创建一组Pod来提供具有高可用性的服务，虽然每个Pod都会分配一个单独的Pod的IP地址，但是却存在如下的问题：</p>
</li>
<li><ul>
<li>Pod的IP会随着Pod的重建产生变化。</li>
</ul>
</li>
<li><ul>
<li>Pod的IP仅仅是集群内部可见的虚拟的IP，外部无法访问。</li>
</ul>
</li>
<li><p>这样对于访问这个服务带来了难度，因此，kubernetes设计了Service来解决这个问题。</p>
</li>
<li><p>Service可以看做是一组同类的Pod对外的访问接口，借助Service，应用可以方便的实现服务发现和负载均衡。</p>
</li>
</ul>
<img src="/2022/05/20/k8s%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0day3/1609137571725-a4754fdb-d0a1-4a49-a7a4-169fc6cc9703.png" class="" title="Service概述.png">

<h3 id="6-2-语法及应用示例"><a href="#6-2-语法及应用示例" class="headerlink" title="6.2 语法及应用示例"></a>6.2 语法及应用示例</h3><h4 id="6-2-1-创建集群内部可访问的Service"><a href="#6-2-1-创建集群内部可访问的Service" class="headerlink" title="6.2.1 创建集群内部可访问的Service"></a>6.2.1 创建集群内部可访问的Service</h4><ul>
<li>示例：暴露名为test的namespace下的名为nginx的deployment，并设置服务名为svc-nginx1</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl expose deploy nginx --name=svc-nginx1 --type=ClusterIP --port=80 --target-port=80 -n dev</span><br><span class="line">service/svc-nginx1 exposed</span><br></pre></td></tr></table></figure>

<ul>
<li>示例：查看名为test的命名空间的所有Service</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get svc -n dev -o wide</span><br><span class="line">NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE   SELECTOR</span><br><span class="line">svc-nginx1   ClusterIP   10.103.119.55   &lt;none&gt;        80/TCP    20s   run=nginx</span><br></pre></td></tr></table></figure>

<h4 id="6-2-2-创建集群外部可访问的Service"><a href="#6-2-2-创建集群外部可访问的Service" class="headerlink" title="6.2.2 创建集群外部可访问的Service"></a>6.2.2 创建集群外部可访问的Service</h4><ul>
<li>示例：暴露名为test的namespace下的名为nginx的deployment，并设置服务名为svc-nginx2</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl expose deploy nginx --name=svc-nginx2 --type=NodePort --port=80 --target-port=80 -n dev</span><br><span class="line">service/svc-nginx2 exposed</span><br></pre></td></tr></table></figure>

<ul>
<li>示例：查看名为test的命名空间的所有Service</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get svc -n dev</span><br><span class="line">NAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">svc-nginx1   ClusterIP   10.103.119.55    &lt;none&gt;        80/TCP         37m</span><br><span class="line">svc-nginx2   NodePort    10.105.235.109   &lt;none&gt;        80:30763/TCP   12s</span><br></pre></td></tr></table></figure>

<h4 id="6-2-3-删除服务"><a href="#6-2-3-删除服务" class="headerlink" title="6.2.3 删除服务"></a>6.2.3 删除服务</h4><ul>
<li>示例：删除服务</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl delete svc svc-nginx1 -n dev</span><br><span class="line">service &quot;svc-nginx1&quot; deleted</span><br><span class="line">[root@master ~]# kubectl get svc -n dev</span><br><span class="line">NAME         TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">svc-nginx2   NodePort   10.105.235.109   &lt;none&gt;        80:30763/TCP   3m35s</span><br></pre></td></tr></table></figure>

<h4 id="6-2-4-对象配置方式"><a href="#6-2-4-对象配置方式" class="headerlink" title="6.2.4 对象配置方式"></a>6.2.4 对象配置方式</h4><ul>
<li>示例：对象配置方式</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# cat svc-nginx.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: svc-nginx</span><br><span class="line">  namespace: dev</span><br><span class="line">spec:</span><br><span class="line">  clusterIP: 10.109.179.231</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 80</span><br><span class="line">  selector:</span><br><span class="line">    run: nginx</span><br><span class="line">  type: ClusterIP</span><br><span class="line">[root@master ~]# kubectl create -f svc-nginx.yaml </span><br><span class="line">service/svc-nginx created</span><br><span class="line">[root@master ~]# kubectl get svc -n dev</span><br><span class="line">    NAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">    svc-nginx    ClusterIP   10.109.179.231   &lt;none&gt;        80/TCP         12s</span><br><span class="line">    svc-nginx2   NodePort    10.105.235.109   &lt;none&gt;        80:30763/TCP   7m20s</span><br></pre></td></tr></table></figure>


      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/05/23/k8s%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0day4/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          k8s学习日记day4
        
      </div>
    </a>
  
  
    <a href="/2022/05/19/k8s%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0day2/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">k8s学习日记day2</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>






</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2023 Miss
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/preccrep/hexo-theme-jelly" target="_blank">Jelly</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




  </div>
</body>
</html>